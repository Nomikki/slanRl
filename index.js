(()=>{"use strict";var e={260:(e,t,a)=>{a.r(t),a.d(t,{default:()=>i});const i={colderGray:"#8cb2c6",coldGray:"#979ea1",darkBlue:"#1f273c",darkerBlue:"#495c67",darkerGreen:"#080",darkGreen:"#0a0",darkRed:"#a00",darkYellow:"#aa2",fuxian:"#f0f",gray:"#888",grayRed:"#a88",green:"#0a3",lightBlue:"#0cf",lighterLime:"#afa",lighterRed:"#f88",lighterYellow:"#ffa",lightestGray:"#ddd",lightGray:"#aaa",lightLime:"#8f8",lightOrange:"#fca",lightPastelRed:"#fa9",lightPurple:"#9ac",lightRed:"#f44",lightTeal:"#0fa",lightYellow:"#ddc275",lime:"#3f3",navyBlue:"#1a2032",orange:"#fa0",pastelRed:"#faa",red:"red",teal:"#0a9",turqoise:"aqua",white:"#fff",yellow:"#ff0",ui_allowed:"#fff",ui_background:"#1a2032",ui_disallowed:"#f88",ui_door:"#ddc275",ui_game_saved:"#0fa",ui_healed:"#8f8",ui_hp_10_percent:"#f44",ui_hp_25_percent:"#f44",ui_hp_50_percent:"#faa",ui_hp_95_percent:"#aaa",ui_hp_max:"#afa",ui_info:"#979ea1",ui_inventory_full:"red",ui_level_up:"#ff0",ui_map_background:"#1f273c",ui_menu_border:"#aaa",ui_menu_cursor:"#aaa",ui_picked_up:"#aaa",ui_tempImage:"#3f3",ui_text:"#8cb2c6",ui_version:"#495c67",ui_wall_dark:"#495c67",ui_wall:"#8cb2c6",pickup_armor_item:"#9ac",pickup_healthpotion:"#f0f",pickup_nutellabun:"#ddc275",pickup_scroll_of_confusion:"#ffa",pickup_scroll_of_fireball:"#fa0",pickup_scroll_of_lightning:"aqua",pickup_scroll_of_map:"#aa2",pickup_weapon_item:"#3f3",pickup_torch:"#fa0",actor_hero:"#fff",actor_stairs:"#fff",monster_bat:"#888",monster_ghoul:"#0a9",monster_giant_rat:"#888",monster_jackal:"#888",monster_kobold:"#a88",monster_lizard:"#0a3",monster_orc:"#0a0",monster_rat:"#888",monster_troll:"#080",log_dead_body:"#a00",log_default_text:"#aaa",log_defeat:"#a00",log_enemy_attack:"#aaa",log_hilight_text:"#fff",log_player_attack:"#ddd",log_background:"#1a1a27cc",default_item:"#f0f",default_monster:"#f0f"}},850:(e,t,a)=>{a.r(t)},886:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=[{name:"leather armor",ac:11,armorType:"light",weight:10},{name:"studded leather",ac:12,armorType:"light",weight:13},{name:"hide",ac:12,armorType:"medium",weight:12},{name:"chain shirt",ac:13,armorType:"medium",weight:20},{name:"scale mail",ac:14,armorType:"medium",weight:45},{name:"breastplate",ac:14,armorType:"medium",weight:20},{name:"half plate",ac:15,armorType:"medium",weight:40},{name:"ringmail",ac:14,armorType:"heavy",weight:40},{name:"chain mail",ac:16,armorType:"heavy",weight:55},{name:"splint",ac:17,armorType:"heavy",weight:60},{name:"plate",ac:18,armorType:"heavy",weight:65},{name:"shield",ac:2,armorType:"shield",weight:6}]},373:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=[{name:"bard",flavourText:"Whether poet, scholar, or scroundrel, a bard weaves magic through words and music to manipulate minds and heal wounds. The bard is a master of song, speech and the magic they contain.",healthAtStart:8,healthIncreasePerLevel:5,savingThrows:[{type:"dex"}],proficiencies:[{type:"light armor"},{type:"simple weapon"},{type:"hand crossbow"},{type:"longsword"},{type:"rapier"},{type:"shortsword"}]},{name:"cleric",flavourText:"Clerics are intermediaries between the mortal world and the distant of planes of the gods. As varied as the gods they serve, clerics strive to embody the handiwork of their deities and are imbued with magic.",healthAtStart:8,healthIncreasePerLevel:5,savingThrows:[{type:"wis"}],proficiencies:[{type:"light armor"},{type:"simple weapon"},{type:"medium armor"},{type:"shield"}]},{name:"fighter",flavourText:"Every fighter can pick up a weapon and wield it ably. Likewise, a fighter is adept with shields and every form of armor. Beyond that basic degree of familiarity, each fighter specializes in a certain style of combat. Some concentrate on archery, some on fighting with two weapons at once, and some on augmenting on their martial skills with magic.",healthAtStart:10,healthIncreasePerLevel:6,savingThrows:[{type:"con"},{type:"str"}],proficiencies:[{type:"light armor"},{type:"medium armor"},{type:"heavy armor"},{type:"shield"},{type:"simple weapons"},{type:"martial weapons"}]},{name:"rogue",flavourText:"Rogues rely on skill, stealth, and their foes' vulnarabilities to get the upper hand in any situation. They have a knack for finding the solution to just about any problem.",healthAtStart:8,healthIncreasePerLevel:5,savingThrows:[{type:"dex"},{type:"int"}],proficiencies:[{type:"light armor"},{type:"simple weapon"},{type:"hand crossbow"},{type:"longsword"},{type:"rapier"},{type:"shortsword"}]},{name:"wizard",flavourText:"Drawing on the subtle weave of magic that permeates the cosmos, wizards casts spells of explosive fire, arcing lightning, subtle deception and brute-force mind control.",healthAtStart:6,healthIncreasePerLevel:4,savingThrows:[{type:"wis"},{type:"int"}],proficiencies:[{type:"dagger"},{type:"dart"},{type:"sling"},{type:"quarterstaff"},{type:"light crossbow"}]}]},391:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(260));t.default=[{name:"health potion",message:"gulp gulp gulp...",ch:"!",color:s.default.pickup_healthpotion,weight:.1,selector:{type:"none",range:0},effect:{type:"health",amount:4}},{name:"nutella bun",message:"omnomnom...",ch:"@",color:s.default.pickup_nutellabun,weight:.1,selector:{type:"none",range:0},effect:{type:"health",amount:30}},{name:"scroll of fireball",message:"Everything burns.",ch:"#",color:s.default.pickup_scroll_of_fireball,weight:.05,selector:{type:"selected range",range:3},effect:{type:"health",amount:-12}},{name:"scroll of confusion",message:"Confused af.",ch:"#",color:s.default.pickup_scroll_of_confusion,weight:.05,selector:{type:"selected monster",range:5},effect:{type:"change ai",amount:10}},{name:"scroll of map",message:"All is clear!",ch:"#",color:s.default.pickup_scroll_of_map,weight:.05,selector:{type:"none",range:0},effect:{type:"map clear",amount:0}},{name:"scroll of lighting bolt",message:"A lighting bolt strikes!",ch:"#",color:s.default.pickup_scroll_of_lightning,weight:.05,selector:{type:"closest monster",range:5},effect:{type:"health",amount:-20}},{name:"torch",message:"A torch is a stick with combustible material at one end, which is ignited and used as a light source.",ch:"ì",color:s.default.pickup_torch,weight:.05,selector:{type:"none",range:5},effect:{type:"lighting",amount:10}}]},47:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(260));t.default=[{name:"bat","size:":"tiny",type:"beast",movingSpeed:2,ch:"b",color:s.default.monster_bat,hp:1,ac:12,xp:5,abilities:{str:2,dex:15,con:8,int:2,wis:12},attacks:[{name:"bite",damage:"1d1",damageType:"piercing"}]},{name:"jackal","size:":"small",type:"beast",ch:"j",color:s.default.monster_jackal,hp:3,ac:12,xp:10,movingSpeed:1,abilities:{str:8,dex:15,con:11,int:3,wis:12},attacks:[{name:"bite",damage:"1d4",damageType:"piercing"}]},{name:"lizard","size:":"tiny",type:"beast",movingSpeed:1,ch:"l",color:s.default.monster_lizard,hp:2,ac:10,xp:10,abilities:{str:2,dex:11,con:10,int:1,wis:8},attacks:[{name:"bite",damage:"1d1",damageType:"piercing"}]},{name:"kobold","size:":"small",type:"humanoid",movingSpeed:1,ch:"k",color:s.default.monster_kobold,hp:5,ac:12,xp:25,abilities:{str:7,dex:15,con:9,int:8,wis:7},attacks:[{name:"dagger",damage:"1d4",damageType:"piercing"},{name:"sling",damage:"1d4",damageType:"bludgeoning"}]},{name:"rat","size:":"tiny",type:"beast",movingSpeed:1.5,ch:"r",color:s.default.monster_rat,hp:1,ac:10,xp:5,abilities:{str:2,dex:11,con:9,int:2,wis:10},attacks:[{name:"bite",damage:"1d1",damageType:"piercing"}]},{name:"giant rat","size:":"small",type:"beast",movingSpeed:1.5,ch:"R",color:s.default.monster_giant_rat,hp:7,ac:12,xp:25,abilities:{str:7,dex:15,con:11,int:2,wis:10},attacks:[{name:"bite",damage:"1d4",damageType:"piercing"}]},{name:"ghoul",size:"medium",type:"undead",ch:"G",movingSpeed:.75,color:s.default.monster_ghoul,hp:22,ac:12,xp:200,abilities:{str:13,dex:15,con:10,int:7,wis:10},attacks:[{name:"bite",damage:"2d6",damageType:"piercing"},{name:"claws",damage:"2d4",damageType:"slashing"}]},{name:"orc",size:"medium",type:"humanoid",movingSpeed:.9,ch:"o",color:s.default.monster_orc,hp:15,ac:13,xp:100,abilities:{str:16,dex:12,con:16,int:7,wis:11},attacks:[{name:"greataxe",damage:"1d12",damageType:"slashing"},{name:"javelin",damage:"1d6",damageType:"piercing"}]},{name:"troll",size:"large",type:"giant",movingSpeed:.9,ch:"t",color:s.default.monster_troll,hp:84,ac:15,xp:1800,abilities:{str:18,dex:13,con:20,int:7,wis:9},attacks:[{name:"bite",damage:"1d16",damageType:"piercing"},{name:"claw",damage:"2d6",damageType:"slashing"}]}]},882:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=[{name:"dwarf",flavourText:"Kingdoms richs in ancient grandeur, halls carved into the roots of mountains, the echoing of picks and hammers in deep mines and blazing forges, and a commitment to clan and tradition – these common threads unite all dwarves.",toughnessIncrease:1,abilityIncrease:{str:2,dex:0,con:2,int:0,wis:0},resilience:"poison",proficiencies:[{type:"light armor"},{type:"medium armor"}]},{name:"elf",flavourText:"A people of otherworldy grace, elves dwell in places of ethereal beauty, in the midst of ancient forest or in spires glittering with fearie light, where soft music drifts through the air and gentle fragrances waft on the breeze.",toughnessIncrease:0,abilityIncrease:{str:0,dex:2,con:0,int:1,wis:1},resilience:"none",proficiencies:[{type:"longsword"},{type:"shortsword"},{type:"shortbow"},{type:"longbow"}]},{name:"halfling",flavourText:"The diminutive halflings survive in a world full of larger creatures by avoiding notice or, barring that, avoiding offense. Standing about 3 feet tall, they appear relatively harmless and so have managed to survive for centuries in the shadows of empires and on the edges of wars.",toughnessIncrease:0,abilityIncrease:{str:0,dex:2,con:1,int:0,wis:0},resilience:"poison",proficiencies:[]},{name:"human",flavourText:"Humans are the most adaptable and ambitious people among the common races. They have widely varying tastes, morals, and customs in different lands where they have settled. When they settle, though, they stay: they build cities to last for the ages.",toughnessIncrease:0,abilityIncrease:{str:1,dex:1,con:1,int:1,wis:1},resilience:"none",proficiencies:[]}]},686:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=[{name:"acid splash",effectValues:"1d6;2d6;3d6;4d6",amount:"1",effectValue_mod:"",effectType:"acid",effectShape:"",effectSize:1,range:5,target_saving_throw_type:"dex",if_target_saving_throw_success:"half_damage",if_target_saving_throw_fail:"full_damage",toCaster:"",turns:0},{name:"blur",effectValues:"aura",amount:"1",effectValue_mod:"",effectType:"illusion",effectShape:"",effectSize:1,range:0,target_saving_throw_type:"",if_target_saving_throw_success:"",if_target_saving_throw_fail:"",toCaster:"advantages",turns:20},{name:"burning hands",effectValues:"3d6;4d6;5d6;6d6",amount:"1",effectValue_mod:"",effectType:"fire",effectShape:"cone",effectSize:3,range:3,target_saving_throw_type:"dex",if_target_saving_throw_success:"half_damage",if_target_saving_throw_fail:"full_damage",toCaster:"",turns:0},{name:"cure wounds",effectType:"heal",effectValues:"1d8;2d8;3d8;4d8",amount:"1",effectValue_mod:"int",effectShape:"",effectSize:1,range:0,target_saving_throw_type:"",if_target_saving_throw_success:"",if_target_saving_throw_fail:"",toCaster:"",turns:0},{name:"detect magic",effectType:"aura;show_magic",effectValues:"",amount:"1",effectValue_mod:"",effectShape:"cube",effectSize:3,range:0,target_saving_throw_type:"",if_target_saving_throw_success:"",if_target_saving_throw_fail:"",toCaster:"",turns:600},{name:"fear",effectType:"aura",effectValues:"",amount:"1",effectValue_mod:"",effectShape:"cone",effectSize:1,range:5,target_saving_throw_type:"wis",if_target_saving_throw_success:"",if_target_saving_throw_fail:"escape",toCaster:"",turns:20},{name:"fireball",effectType:"fire",effectValues:"8d6;9d6;10d6",amount:"1",effectValue_mod:"",effectShape:"sphere",effectSize:2,range:7,target_saving_throw_type:"dex",if_target_saving_throw_success:"full_damage",if_target_saving_throw_fail:"half_damage",toCaster:"",turns:0},{name:"fire bolt",effectType:"fire",effectValues:"1d10;2d10;3d10;4d10",amount:"1",effectValue_mod:"",effectShape:"",effectSize:1,range:10,target_saving_throw_type:"",if_target_saving_throw_success:"",if_target_saving_throw_fail:"",toCaster:"",turns:0},{name:"guiding bolt",effectType:"lightning;disadvantage_next_turn",effectValues:"4d6;5d6;6d6;7d6",amount:"1",effectValue_mod:"",effectShape:"sphere",effectSize:1,range:10,target_saving_throw_type:"",if_target_saving_throw_success:"",if_target_saving_throw_fail:"",toCaster:"",turns:0},{name:"haste",effectType:"aura",effectValues:"",amount:"1",effectValue_mod:"",effectShape:"",effectSize:1,range:0,target_saving_throw_type:"",if_target_saving_throw_success:"",if_target_saving_throw_fail:"",toCaster:"ac_add_2;speed_double;advantages",turns:20},{name:"holding person",effectType:"enchament",effectValues:"",amount:"1",effectValue_mod:"",effectShape:"",effectSize:1,range:4,target_saving_throw_type:"wis",if_target_saving_throw_success:"remove_effect",if_target_saving_throw_fail:"paralyzed",toCaster:"",turns:20},{name:"inflict wounds",effectType:"necrotic",effectValues:"3d10;4d10;5d10;6d10",amount:"1",effectValue_mod:"",effectShape:"",effectSize:1,range:1,target_saving_throw_type:"",if_target_saving_throw_success:"",if_target_saving_throw_fail:"",toCaster:"",turns:0},{name:"lightning",effectType:"lightning",effectValues:"3d10;4d10;5d10;6d10",amount:"1",effectValue_mod:"",effectShape:"line",effectSize:1,range:10,target_saving_throw_type:"dex",if_target_saving_throw_success:"half_damage",if_target_saving_throw_fail:"full_damage",toCaster:"",turns:0},{name:"magic missile",effectType:"force",effectValues:"1d4+1",amount:"3;4;5;6",effectValue_mod:"",effectShape:"",effectSize:1,range:5,target_saving_throw_type:"",if_target_saving_throw_success:"",if_target_saving_throw_fail:"",toCaster:"",turns:0},{name:"misty step",effectType:"transmutation",effectValues:"",amount:"1",effectValue_mod:"",effectShape:"",effectSize:1,range:4,target_saving_throw_type:"",if_target_saving_throw_success:"",if_target_saving_throw_fail:"",toCaster:"teleport_to_selected_location",turns:0},{name:"poison spray",effectType:"poison",effectValues:"1d12;2d12;3d12;4d12",amount:"1",effectValue_mod:"",effectShape:"",effectSize:1,range:2,target_saving_throw_type:"con",if_target_saving_throw_success:"",if_target_saving_throw_fail:"full_damage",toCaster:"",turns:0},{name:"ray of frost",effectType:"cold;reduce_speed:5",effectValues:"1d8;2d8;3d8;4d8",amount:"1",effectValue_mod:"",effectShape:"",effectSize:1,range:5,target_saving_throw_type:"",if_target_saving_throw_success:"",if_target_saving_throw_fail:"",toCaster:"",turns:0},{name:"resistance",effectType:"aura",effectValues:"1d4",amount:"1",effectValue_mod:"",effectShape:"",effectSize:1,range:0,target_saving_throw_type:"",if_target_saving_throw_success:"",if_target_saving_throw_fail:"",toCaster:"add_value_to_saving_throws",turns:20},{name:"sacred flame",effectType:"radiant",effectValues:"1d8;2d8;3d8;4d8",amount:"1",effectValue_mod:"",effectShape:"",effectSize:1,range:5,target_saving_throw_type:"dex",if_target_saving_throw_success:"",if_target_saving_throw_fail:"full_damage",toCaster:"",turns:0},{name:"shatter",effectType:"lightning",effectValues:"3d8;4d8;5d8;6d8",amount:"1",effectValue_mod:"",effectShape:"sphere",effectSize:2,range:5,target_saving_throw_type:"con",if_target_saving_throw_success:"half_damage",if_target_saving_throw_fail:"full_damage",toCaster:"",turns:0},{name:"shield of faith",effectType:"aura",effectValues:"",amount:"1",effectValue_mod:"",effectShape:"",effectSize:1,range:0,target_saving_throw_type:"",if_target_saving_throw_success:"",if_target_saving_throw_fail:"",toCaster:"ac_add_2",turns:200},{name:"shocking grasp",effectType:"lightning;disadvantages:1",effectValues:"1d8;2d8;3d8;4d8",amount:"1",effectValue_mod:"",effectShape:"",effectSize:1,range:1,target_saving_throw_type:"",if_target_saving_throw_success:"",if_target_saving_throw_fail:"",toCaster:"",turns:0},{name:"thunderwave",effectType:"lightning",effectValues:"2d8;3d8;4d8;5d8",amount:"1",effectValue_mod:"",effectShape:"cube",effectSize:2,range:1,target_saving_throw_type:"con",if_target_saving_throw_success:"half_damage",if_target_saving_throw_fail:"full_damage;pushing_away",toCaster:"",turns:0},{name:"web",effectType:"",effectValues:"",amount:"1",effectValue_mod:"",effectShape:"",effectSize:2,range:11,target_saving_throw_type:"dex",if_target_saving_throw_success:"remove_effect",if_target_saving_throw_fail:"paralyzed",toCaster:"",turns:1200}]},204:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=[{name:"club",damage:"1d4",damageType:"bludgeoning",weight:2,rangeMax:1,wearableType:"one-handed",special:""},{name:"dagger",damage:"1d4",damageType:"piercing",weight:1,rangeMax:1,wearableType:"one-handed",special:""},{name:"greatclub",damage:"1d4",damageType:"bludgeoning",weight:10,rangeMax:1,wearableType:"two-handed",special:""},{name:"handaxe",damage:"1d6",damageType:"slashing",weight:2,rangeMax:1,wearableType:"one-handed",special:""},{name:"javelin",damage:"1d6",damageType:"piercing",weight:2,rangeMax:1,wearableType:"one-handed",special:""},{name:"light hammer",damage:"1d4",damageType:"bludgeoning",weight:2,rangeMax:1,wearableType:"one-handed",special:""},{name:"mace",damage:"1d6",damageType:"bludgeoning",weight:4,rangeMax:1,wearableType:"one-handed",special:""},{name:"quarterstaff",damage:"1d6",damageType:"bludgeoning",weight:4,rangeMax:1,wearableType:"one-handed",special:""},{name:"spear",damage:"1d6",damageType:"piercing",weight:3,rangeMax:1,wearableType:"one-handed",special:""},{name:"light crossbow",damage:"1d8",damageType:"piercing",weight:6,rangeMax:12,wearableType:"ranged",special:"loading"},{name:"dart",damage:"1d4",damageType:"piercing",weight:.25,rangeMax:6,wearableType:"ranged",special:""},{name:"shortbow",damage:"1d6",damageType:"piercing",weight:2,rangeMax:12,wearableType:"ranged",special:""},{name:"sling",damage:"1d4",damageType:"bludgeoning",weight:2,rangeMax:8,wearableType:"ranged",special:""}]},607:function(e,t,a){var i=this&&this.__awaiter||function(e,t,a,i){return new(a||(a=Promise))((function(s,o){function r(e){try{l(i.next(e))}catch(e){o(e)}}function n(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(r,n)}l((i=i.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.game=t.GameStatus=void 0,a(850);const o=s(a(801)),r=s(a(927)),n=a(382),l=s(a(423)),c=a(84),h=s(a(135)),d=a(557),u=s(a(529)),f=a(637),g=a(887),m=a(935),p=s(a(808)),v=a(792),_=a(107),y=a(928),w=a(409),T=s(a(5)),b=a(865);var x;!function(e){e[e.MAINMENU=0]="MAINMENU",e[e.NEWGAME=1]="NEWGAME",e[e.STARTUP=2]="STARTUP",e[e.IDLE=3]="IDLE",e[e.NEW_TURN=4]="NEW_TURN",e[e.VICTORY=5]="VICTORY",e[e.DEFEAT=6]="DEFEAT"}(x=t.GameStatus||(t.GameStatus={})),t.game=new class{constructor(){this.gameStatus=x.MAINMENU,this.fontSize=12,this.masterSeed=0,this.turns=0,this.mapx=80,this.mapy=80,this.canvas=(0,y.ensure)(document.querySelector("#screen")),this.ctx=(0,y.ensure)(this.canvas.getContext("2d")),this.setScale(12),this.ctx.textAlign="center",this.log=new T.default,this.lastKey="",this.depth=0,this.turns=0,this.width=80,this.height=57,this.actors=[],this.map=new l.default(this.mapx,this.mapy),this.camera=new c.Camera,this.camera.setCenter(this.width,this.height);const e=(0,y.ensure)(document.querySelector("#temp-image"));e.addEventListener("click",(()=>{e.classList.toggle("zoomed")})),window.addEventListener("resize",this.fitCanvasToScreen)}setScale(e){this.fontSize=(0,y.float2int)(e),this.ctx.canvas.width=80*e,this.ctx.canvas.height=60*e}handleZoomKeys(e){"+"===e?(this.fontSize++,this.setScale(this.fontSize)):"-"===e&&(this.fontSize--,this.setScale(this.fontSize))}fitCanvasToScreen(){const{width:e,height:a}=window.visualViewport,i=80/60,s=e/a,o=(0,y.float2int)(e/960*12),r=(0,y.float2int)(a/720*12);t.game.gameStatus===x.MAINMENU?(t.game.setScale(s<i?o:r),t.game.renderStartMenu()):t.game.gameStatus===x.NEWGAME||(t.game.setScale(s<i?o:r),t.game.render())}term(){return i(this,void 0,void 0,(function*(){this.log=new T.default,this.actors=[],this.map=new l.default(this.mapx,this.mapy),this.player=void 0,this.ctx=(0,y.ensure)(this.canvas.getContext("2d")),this.ctx.textAlign="center"}))}init(e,t=!0){var a,s,l,c,f,g,m,T,b,S,E,A,I;return i(this,void 0,void 0,(function*(){if((0,y.ensure)(this.map).generate(e,this.masterSeed,this.depth),e){let e=0;if(t){e=this.actors.push(new p.default(2,2,"@","placeholder hero",w.Colors.HERO))-1,this.player=this.actors[e],this.player.destructible=new _.PlayerDestructible(30,10,"your cadaver"),this.player.attacker=new u.default("1d4","1d1"),this.player.ai=new v.PlayerAI,this.player.abilities=new d.Abilities(18,15,10,8,12),this.player.container=new o.default(26),this.player.equipments=new r.default,this.player.fov=new h.default(this.mapx,this.mapy);const t=(0,n.createItem)({name:"leather armor",x:(0,y.ensure)(this.player).x,y:(0,y.ensure)(this.player).y}),i=(0,n.createItem)({name:"hide",x:(0,y.ensure)(this.player).x,y:(0,y.ensure)(this.player).y}),x=(0,n.createItem)({name:"handaxe",x:(0,y.ensure)(this.player).x,y:(0,y.ensure)(this.player).y}),I=(0,n.createItem)({name:"light crossbow",x:(0,y.ensure)(this.player).x,y:(0,y.ensure)(this.player).y}),C=(0,n.createItem)({name:"shortbow",x:(0,y.ensure)(this.player).x,y:(0,y.ensure)(this.player).y}),k=(0,n.createItem)({name:"club",x:(0,y.ensure)(this.player).x,y:(0,y.ensure)(this.player).y});null===(s=null===(a=this.player)||void 0===a?void 0:a.container)||void 0===s||s.add(t),null===(c=null===(l=this.player)||void 0===l?void 0:l.container)||void 0===c||c.add(i),null===(g=null===(f=this.player)||void 0===f?void 0:f.container)||void 0===g||g.add(x),null===(T=null===(m=this.player)||void 0===m?void 0:m.container)||void 0===T||T.add(I),null===(S=null===(b=this.player)||void 0===b?void 0:b.container)||void 0===S||S.add(C),null===(A=null===(E=this.player)||void 0===E?void 0:E.container)||void 0===A||A.add(k)}(0,y.ensure)(this.player).x=(0,y.ensure)(this.map).startX,(0,y.ensure)(this.player).y=(0,y.ensure)(this.map).startY,null===(I=(0,y.ensure)(this.player).fov)||void 0===I||I.fullClear(),e=this.actors.push(new p.default(0,0,">","stairs",w.Colors.STAIRS))-1,this.stairs=this.actors[e],this.stairs.blocks=!1,this.stairs.fovOnly=!1,this.stairs.x=(0,y.ensure)(this.map).stairsX,this.stairs.y=(0,y.ensure)(this.map).stairsY,this.sendToBack(this.stairs),this.log.add("Welcome stranger!"),this.log.add("Need help? Press '?'",w.Colors.HILIGHT_TEXT)}else this.log.add("Welcome back stranger!"),this.log.add("Need help? Press '?'",w.Colors.HILIGHT_TEXT);this.gameStatus=x.STARTUP}))}nextLevel(){return i(this,void 0,void 0,(function*(){this.depth++,this.log.add("You take steps down."),this.map=void 0,this.stairs=void 0;const e=this.player;this.actors=Array(),this.map=new l.default(this.mapx,this.mapy),this.init(!0,!1),this.actors.push(e),this.save()}))}newGame(){var e;return i(this,void 0,void 0,(function*(){if(t.game.gameStatus=x.NEWGAME,this.masterSeed=parseInt(void 0)||(0,y.float2int)(134217727*Math.random()),window.location.search){const e=new URLSearchParams(window.location.search);e.has("seed")&&(this.masterSeed=parseInt((0,y.ensure)(e.get("seed"))))}history.pushState({},"Slan Roguelike",`/slanRl/?seed=${this.masterSeed}`);const[a,i,s,o,r,n]=yield(0,f.prepareNewJourney)();this.turns=0,this.depth=1,yield this.term(),yield this.init(!0,!0);const l=(0,y.ensure)(this.player);l.abilities=(0,y.ensure)(a),l.race=(0,y.ensure)(i),l.class=(0,y.ensure)(s),l.getProfiencies();const c=(0,m.getRaceNameByIndex)(i),h=(0,g.getClassNameByIndex)(s);l.name=`${null===(e=this.player)||void 0===e?void 0:e.name} the ${c} ${h}`;const u=a.getBonus(d.ABILITIES.CON),p=(0,y.ensure)(l.destructible);p.maxHP=o+u,p.hp=p.maxHP,p.hpPerLevel=r,p.hpPerLevelBonuses=n,yield this.save()}))}continueGame(){return i(this,void 0,void 0,(function*(){if(null!==window.localStorage.getItem("seed")){null===window.localStorage.getItem("version")&&window.localStorage.setItem("version","v0.0.1.20c"),this.masterSeed=parseInt((0,y.ensure)(window.localStorage.getItem("seed"))),this.depth=parseInt((0,y.ensure)(window.localStorage.getItem("depth"))),this.turns=parseInt((0,y.ensure)(window.localStorage.getItem("turns"))),yield this.init(!1);const e=JSON.parse(window.localStorage.getItem("actors")||"[]");for(const t of e){const e=this.actors.push(new p.default(t.x,t.y,t.ch,t.name,t.color))-1;if(t.fov&&(this.actors[e].fov=new h.default(this.mapx,this.mapy),(0,y.ensure)(this.actors[e].fov).mapped=t.fov.mapped),t.container){this.actors[e].container=yield new o.default(26);for(const a of t.container.inventory){const t=(0,y.ensure)(this.actors[e].container).inventory.push(new p.default(a.x,a.y,a.ch,a.name,a.color))-1;(0,y.ensure)(this.actors[e].container).inventory[t]=(0,n.createItem)({name:a.name,x:a.x,y:a.y})}}if(t.equipments){this.actors[e].equipments=new r.default;for(const a of t.equipments.items)(0,y.ensure)(this.actors[e].equipments).add((0,n.createItem)({name:a.name,x:a.x,y:a.y}))}if(t.abilities){const a=t.abilities;this.actors[e].abilities=new d.Abilities(a.str,a.dex,a.con,a.int,a.wis)}if(t.attacker&&(this.actors[e].attacker=new u.default(t.attacker.power_melee,t.attacker.power_range),(0,y.ensure)(this.actors[e].attacker).rangeAttack_range=t.attacker.rangeAttack_range),t.pickable&&(t.armor||t.weapon?this.actors[e]=(0,n.createItem)({name:t.name,x:t.x,y:t.y}):this.actors[e].create(t)),"stairs"===t.name&&(this.stairs=this.actors[e],this.stairs.fovOnly=!1),"door"===t.name&&(this.actors[e].blocks=t.blocks,this.actors[e].fovOnly=t.fovOnly),t.destructible){if("player"===t.destructible.type){this.player=this.actors[e],this.actors[e].destructible=new _.PlayerDestructible(30,10,"player corpse"),this.actors[e].ai=new v.PlayerAI;const a=(0,y.ensure)(this.actors[e].destructible);a.xp=t.destructible.xp,a.hpPerLevel=t.destructible.hpPerLevel,a.hpPerLevelBonuses=t.destructible.hpPerLevelBonuses,a.hp=t.destructible.hp,a.maxHP=t.destructible.maxHP,a.defense=t.destructible.defense,a.corpseName=t.destructible.corpseName}if("monster"===t.destructible.type){this.actors[e].destructible=new _.MonsterDestructible(1,1,"monster corpse",0);const a=(0,y.ensure)(this.actors[e].destructible);a.xp=t.destructible.xp,a.hp=t.destructible.hp,a.maxHP=t.destructible.maxHP,a.defense=t.destructible.defense,a.corpseName=t.destructible.corpseName,t.destructible.hp<=0&&(this.actors[e].blocks=!1),this.actors[e].ai=new v.MonsterAI}}}}}))}renderStartMenu(){if(this.clear(),this.renderVersion(),this.menu){this.drawChar(">",this.width/2-12,10+this.menu.cursor,w.Colors.MENU_CURSOR);for(let e=0;e<this.menu.items.length;e++)this.drawText(this.menu.items[e].label,this.width/2-10,10+e)}}load(){return i(this,void 0,void 0,(function*(){"v0.0.1.20c"!==window.localStorage.getItem("version")&&window.localStorage.clear(),this.menu=new b.Menu,this.menu.clear(),window.localStorage.getItem("depth")&&this.menu.addItem(b.MenuItemCode.CONTINUE,"Continue"),this.menu.addItem(b.MenuItemCode.NEW_GAME,"New Game");let e=-1;for(;;){this.renderStartMenu();const t=yield this.getch();if("ArrowDown"===t&&this.menu.cursor++,"ArrowUp"===t&&this.menu.cursor--,"Enter"===t){e=this.menu.items[this.menu.cursor].code;break}this.handleZoomKeys(t),this.menu.cursor=this.menu.cursor%this.menu.items.length,this.menu.cursor<0&&(this.menu.cursor=this.menu.items.length-1)}-1!=e&&(e===b.MenuItemCode.NEW_GAME&&(yield this.newGame()),e===b.MenuItemCode.CONTINUE&&(yield this.continueGame()))}))}save(){return i(this,void 0,void 0,(function*(){const e=(0,y.ensure)(this.player);(0,y.ensure)(e.destructible).isDead()?window.localStorage.clear():((0,y.ensure)(this.map).save(),window.localStorage.setItem("playerID",this.actors.indexOf(e).toString()),window.localStorage.setItem("turns",this.turns.toString()),window.localStorage.setItem("actors",JSON.stringify(this.actors)),window.localStorage.setItem("version","v0.0.1.20c"))}))}clear(e=w.Colors.BACKGROUND){this.ctx.fillStyle=e,this.ctx.fillRect(0,0,this.width*this.fontSize,this.height*this.fontSize),this.ctx.fillRect(0,this.height*this.fontSize,this.width*this.fontSize,this.canvas.height-this.height*this.fontSize)}saveImage(){const e=this.width,t=this.height,a=this.camera.x,i=this.camera.y,s=this.fontSize;this.width=this.mapx,this.height=this.mapy,(0,y.ensure)(document.querySelector("#temp-image")).classList.remove("hidden");const o=(0,y.ensure)(document.querySelector("#temp-image-canvas"));this.canvas=o,this.ctx=(0,y.ensure)(this.canvas.getContext("2d")),this.setScale(12),this.ctx.canvas.width=this.mapx*this.fontSize,this.ctx.canvas.height=this.mapy*this.fontSize,this.camera.x=0,this.camera.y=0,this.clear(),(0,y.ensure)(this.map).render();for(let e=0;e<this.actors.length;e++)this.actors[e].render();this.renderLighting(),this.canvas=(0,y.ensure)(document.getElementById("screen")),this.ctx=(0,y.ensure)(this.canvas.getContext("2d")),this.width=e,this.height=t,this.camera.x=a,this.camera.y=i,this.setScale(s),this.render()}drawChar(e,t,a,i=w.Colors.BACKGROUND){t<0||a<0||t>this.width||a>this.height||(this.ctx.textAlign="center",this.ctx.fillStyle=w.Colors.BACKGROUND,this.ctx.fillRect(t*this.fontSize-this.fontSize/2,a*this.fontSize,this.fontSize,this.fontSize),this.ctx.fillStyle=i,this.ctx.fillText(e,t*this.fontSize,a*this.fontSize+this.fontSize))}drawRectangle(e,t,a=w.Colors.BACKGROUND,i){if(e<0||t<0||e>this.width||t>this.height)return;let s=i.toString(16);0===s.length&&(s="00"),s.length<2&&(s="0"+s),this.ctx.textAlign="center",this.ctx.fillStyle=a+s,this.ctx.fillRect(e*this.fontSize-this.fontSize/2,t*this.fontSize,this.fontSize,this.fontSize),this.ctx.fillStyle="#FFFFFFFF"}drawText(e,t,a,i=w.Colors.DEFAULT_TEXT,s="left"){this.ctx.textAlign=s,this.ctx.font=`${this.fontSize}px system-ui`,this.ctx.fillStyle=w.Colors.BACKGROUND,this.ctx.fillStyle=i,this.ctx.fillText(e,t*this.fontSize,a*this.fontSize+this.fontSize)}run(){return i(this,void 0,void 0,(function*(){for((0,y.debugInit)(),this.fitCanvasToScreen();;)for(yield this.load(),yield this.gameloop(),yield this.save(),this.log.add("Press Esc to restart"),this.render();"Escape"!==(yield this.getch()););}))}waitingKeypress(){return new Promise((e=>{document.addEventListener("keydown",(function a(i){i.preventDefault(),0!==i.keyCode&&(document.removeEventListener("keydown",a),t.game.lastKey=i.key,e())}))}))}getch(){return i(this,void 0,void 0,(function*(){yield this.waitingKeypress();const e=this.lastKey;return this.lastKey="",(0,y.ensure)(document.querySelector("#temp-image")).classList.remove("zoomed"),e}))}render(){this.clear(),(0,y.ensure)(this.map).render();for(let e=0;e<this.actors.length;e++)this.actors[e].render();this.renderLighting(),this.renderUI()}renderLighting(){var e,t,a,i,s,o,r;for(let n=0;n<this.mapy;n++)for(let l=0;l<this.mapx;l++){const c=l+this.camera.x,h=n+this.camera.y;if(c>0&&h>0&&c<this.width&&h<this.height&&2==(null===(t=null===(e=this.player)||void 0===e?void 0:e.fov)||void 0===t?void 0:t.getMapped(l,n))){const e=(0,y.ensure)(null===(i=null===(a=this.player)||void 0===a?void 0:a.fov)||void 0===i?void 0:i.getLight(l,n)),t=(0,y.rgbToHex)((0,y.float2int)(e.r),(0,y.float2int)(e.g),(0,y.float2int)(e.b)),d=(0,y.ensure)(null===(o=null===(s=this.player)||void 0===s?void 0:s.fov)||void 0===o?void 0:o.getAmbienceLight(l,n)),u=d>255?255:(0,y.float2int)(d);this.drawRectangle(c,h,t,64),this.drawRectangle(c,h,null===(r=this.map)||void 0===r?void 0:r.ambienceColor,(0,y.float2int)(.15*u))}}}renderUI(){var e,t,a,i,s,o,r,n,l,c;const h=(0,y.ensure)(this.player),u=(0,y.ensure)(null===(e=h.destructible)||void 0===e?void 0:e.hp),f=null===(t=h.destructible)||void 0===t?void 0:t.defense,g=null===(a=h.attacker)||void 0===a?void 0:a.power_melee,m=null===(i=h.attacker)||void 0===i?void 0:i.power_range,p=null===(s=h.attacker)||void 0===s?void 0:s.rangeAttack_range,v=(0,y.ensure)(null===(o=h.destructible)||void 0===o?void 0:o.maxHP),_=(0,y.ensure)(this.map).depth,T=(0,y.ensure)(this.turns),b=null===(r=h.destructible)||void 0===r?void 0:r.xp;this.drawText(`HP: ${u}/${v}`,1,this.height+1,u<v/100*10?w.Colors.HP_10_PERCENT:u<v/100*25?w.Colors.HP_25_PERCENT:u<v/100*50?w.Colors.HP_50_PERCENT:u<v/100*95?w.Colors.HP_95_PERCENT:w.Colors.HP_MAX),this.drawText(`AC: ${f}`,7,this.height+1),this.drawText(`ATT M: ${g}`,13,this.height+1),this.drawText(`ATT R: ${m}`,13,this.height+2),this.drawText(`Range: ${p}`,19,this.height+2),this.drawText(`Depth: ${_}`,this.width-6,this.height+1),this.drawText(`Turn: ${T}`,this.width-6,this.height+2),this.drawText(`EXP: ${b} / ${null===(n=h.ai)||void 0===n?void 0:n.getNextLevelXP()}`,1,this.height+2),this.drawText(`${(0,y.capitalize)(null===(l=(0,y.ensure)(this.player))||void 0===l?void 0:l.name)}`,60,this.height+1);const x=null===(c=this.player)||void 0===c?void 0:c.abilities;this.drawText(`STR: ${null==x?void 0:x.str} (${null==x?void 0:x.getBonusWithSign(d.ABILITIES.STR)})`,19,this.height+1),this.drawText(`DEX: ${null==x?void 0:x.dex} (${null==x?void 0:x.getBonusWithSign(d.ABILITIES.DEX)})`,27,this.height+1),this.drawText(`CON: ${null==x?void 0:x.con} (${null==x?void 0:x.getBonusWithSign(d.ABILITIES.CON)})`,35,this.height+1),this.drawText(`INT: ${null==x?void 0:x.int} (${null==x?void 0:x.getBonusWithSign(d.ABILITIES.INT)})`,43,this.height+1),this.drawText(`WIS: ${null==x?void 0:x.wis} (${null==x?void 0:x.getBonusWithSign(d.ABILITIES.WIS)})`,51,this.height+1),this.log.render(),this.renderVersion()}renderVersion(){this.drawText("Commit ID: 253513e | Version: v0.0.1.20c",78,this.ctx.canvas.height/this.fontSize-3,w.Colors.VERSION,"right")}gameloop(){var e,t,a,s,o,r,n,l,c;return i(this,void 0,void 0,(function*(){for(;;){if(this.gameStatus===x.STARTUP&&(null===(e=this.player)||void 0===e||e.computeFov(),this.camera.compute((0,y.ensure)(null===(t=this.player)||void 0===t?void 0:t.x),(0,y.ensure)(null===(a=this.player)||void 0===a?void 0:a.y)),this.render()),this.gameStatus=x.IDLE,yield null===(s=this.player)||void 0===s?void 0:s.update((0,y.ensure)(null===(o=this.player.ai)||void 0===o?void 0:o.movingSpeed)),this.gameStatus===x.NEW_TURN){for(const e of this.actors)e!==this.player&&(yield e.update((0,y.ensure)(null===(n=null===(r=this.player)||void 0===r?void 0:r.ai)||void 0===n?void 0:n.movingSpeed)));this.turns++}if(this.render(),this.gameStatus===x.DEFEAT){this.drawText("DEFEAT!",this.width/2-3,this.height/2,w.Colors.DEFEAT),this.log.add("DEFEAT",w.Colors.DEFEAT),null===(c=null===(l=this.player)||void 0===l?void 0:l.fov)||void 0===c||c.showAll(),this.saveImage(),setTimeout((()=>{(0,y.ensure)(document.querySelector("#temp-image")).classList.add("zoomed")}),1e3);break}}}))}removeActor(e){for(let t=0;t<this.actors.length;t++)if(this.actors[t]===e)return void this.actors.splice(t,1)}sendToBack(e){this.removeActor(e),this.actors.unshift(e)}getClosestMonster(e,t,a){let i=null,s=1e5;for(const o of this.actors)if(o!=this.player&&o.destructible&&!o.destructible.isDead()){const r=o.getDistance(e,t);r<s&&(r<=a||0==a)&&(s=r,i=o)}return i}getActor(e,t){for(const a of this.actors)if(a.x===e&&a.y===t&&a.destructible&&!a.destructible.isDead())return a;return null}getAnyActor(e,t){for(const a of this.actors)if(a.x===e&&a.y===t)return a;return null}getAllActors(e,t){const a=[];for(const i of this.actors)i.x===e&&i.y===t&&a.push(i);return a}getActorsInSphere(e,t,a,i){const s=[];for(const o of this.actors)o!==i&&o.destructible&&!o.destructible.isDead()&&o.getDistance(e,t)<=a&&s.push(o);return s}getActorsInCube(e,t,a,i){const s=[];for(const o of this.actors)o!==i&&o.destructible&&!o.destructible.isDead()&&o.x>=e-a&&o.x<=e+a&&o.y>=t-a&&o.y<=t+a&&s.push(o);return s}pickATile(e,t,a=0){var s,o;return i(this,void 0,void 0,(function*(){let i=e,r=t,n=!1;for(;;){this.render(),(null===(o=null===(s=this.player)||void 0===s?void 0:s.fov)||void 0===o?void 0:o.isInFov(i,r))&&(0==a||this.player.getDistance(i,r)<=a)?(this.drawChar("+",i+this.camera.x,r+this.camera.y,w.Colors.ALLOWED),n=!0):(this.drawChar("+",i+this.camera.x,r+this.camera.y,w.Colors.DISALLOWED),n=!1);const e=yield this.getch();if("ArrowLeft"===e&&i--,"ArrowRight"===e&&i++,"ArrowUp"===e&&r--,"ArrowDown"===e&&r++,"Escape"===e)break;if("Enter"===e&&n)return[!0,i,r]}return[!1,i,r]}))}renderMenuBackground({title:e,x:t,y:a,w:i,h:s}){for(let e=0;e<s;e++)for(let o=0;o<i;o++)(0===e||e===s-1)&&o>0&&o<i-1?this.drawChar("-",o+t,e+a,w.Colors.MENU_BORDER):(0===o||o===i-1)&&e>0&&e<s-1?this.drawChar("|",o+t,e+a,w.Colors.MENU_BORDER):0===e||0===o||e===s-1||o===i-1?this.drawChar("+",o+t,e+a,w.Colors.MENU_BORDER):this.drawChar(" ",o+t,e+a,w.Colors.MENU_BORDER);for(let s=0;s<e.length;s++)this.drawChar(e.charAt(s),t+i/2-e.length/2+s,a,w.Colors.DEFAULT_TEXT)}},t.game.run()},801:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=a(607),s=a(524),o=a(889),r=a(692),n=a(928);t.default=class{constructor(e){this.size=e,this.inventory=[]}add(e){return!(this.size>0&&this.inventory.length>=this.size||(this.inventory.push(e),0))}remove(e){for(let t=0;t<this.inventory.length;t++)if(this.inventory[t]===e)return void this.inventory.splice(t,1)}render(){var e,t,a,l;i.game.renderMenuBackground({title:"INVENTORY",x:15,y:4,w:45,h:30});let c="a",h=0;for(const d of this.inventory){i.game.drawText(`${c} ) ${(0,n.capitalize)(d.name)}`,16,6+h);const u=(0,n.ensure)(d.pickable).weight;i.game.drawText(`${u} lb`,54,6+h),c=String.fromCharCode(c.charCodeAt(0)+1);let f="";if(d.armor&&(d.armor.armorType===o.ArmorType.SHIELD&&(f=`AC: ${d.armor.armorClass}, shield`),d.armor.armorType===o.ArmorType.LIGHT_ARMOR&&(f=`AC: ${d.armor.armorClass}, light armor`),d.armor.armorType===o.ArmorType.MEDIUM_ARMOR&&(f=`AC: ${d.armor.armorClass}, medium armor`),d.armor.armorType===o.ArmorType.HEAVY_ARMOR&&(f=`AC: ${d.armor.armorClass}, heavy armor`)),d.weapon&&(d.weapon.damageType===r.DamageType.BLUDGEONING&&(f=`damage: ${d.weapon.damage}, bludgeoning`),d.weapon.damageType===r.DamageType.PIERCING&&(f=`damage: ${d.weapon.damage}, piercing`),d.weapon.damageType===r.DamageType.SLASHING&&(f=`damage: ${d.weapon.damage}, slashing`)),null===(e=d.pickable)||void 0===e?void 0:e.effect){let e="";"HealthEffect"===d.pickable.effectName&&(e=d.pickable.effect.amount>0?`healing: ${Math.abs(d.pickable.effect.amount)}`:`damage: ${Math.abs(d.pickable.effect.amount)}`),"AiChangeEffect"===d.pickable.effectName&&(e=`confused ${d.pickable.effect.newAi.nbTurns} turns`),"scroll of map"===d.name&&(e="Reveal current map"),f+=`${e}`,(null===(t=d.pickable)||void 0===t?void 0:t.selector)&&(f+=", ")}if(null===(a=d.pickable)||void 0===a?void 0:a.selector){let e="";const t=d.pickable.selector.range;d.pickable.selector.type===s.SelectorType.CLOSEST_MONSTER&&(e="closest enemy"),d.pickable.selector.type===s.SelectorType.SELECTED_MONSTER&&(e="selected monster"),d.pickable.selector.type===s.SelectorType.SELECTED_RANGE&&(e="selected range"),d.pickable.selector.type===s.SelectorType.WEARER_RANGE&&(e="wearer range"),f+=`${e}, range: ${t}`}(null===(l=d.pickable)||void 0===l?void 0:l.effect)&&"Wearable"===d.pickable.effectName&&(d.pickable.effect.type===s.WearableType.ONEHANDED_WEAPON&&(f+=", one-handed"),d.pickable.effect.type===s.WearableType.TWOHANDED_WEAPON&&(f+=", two-handed"),d.pickable.effect.type===s.WearableType.SHIELD&&(f+=", shield"),d.pickable.effect.type===s.WearableType.ARMOR&&(f+=", armor")),i.game.drawText(`${(0,n.capitalize)(f)}`,30,6+h),h++}}}},927:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=a(607),s=a(524),o=a(928);t.default=class{constructor(){this.items=[]}add(e){return this.items.push(e),!0}takeOff(e){var t,a;for(let i=0;i<this.items.length;i++)if((null===(t=this.items[i].pickable)||void 0===t?void 0:t.effect)&&(null===(a=this.items[i].pickable)||void 0===a?void 0:a.effect.type)===e)return this.items.splice(i,1)[0]}thisTypeIsWeared(e){var t,a;for(let i=0;i<this.items.length;i++)if((null===(t=this.items[i].pickable)||void 0===t?void 0:t.effect)&&(null===(a=this.items[i].pickable)||void 0===a?void 0:a.effect.type)===e)return this.items[i]}getRangeWeapon(){var e,t;for(let a=0;a<this.items.length;a++)if((null===(e=this.items[a].pickable)||void 0===e?void 0:e.effect)&&(null===(t=this.items[a].pickable)||void 0===t?void 0:t.effect.type)===s.WearableType.RANGED_WEAPON)return this.items[a]}getMeleeWeapon(){var e,t,a;for(let i=0;i<this.items.length;i++)if((null===(e=this.items[i].pickable)||void 0===e?void 0:e.effect)&&((null===(t=this.items[i].pickable)||void 0===t?void 0:t.effect.type)===s.WearableType.ONEHANDED_WEAPON||(null===(a=this.items[i].pickable)||void 0===a?void 0:a.effect.type)===s.WearableType.TWOHANDED_WEAPON))return this.items[i]}getAC(){let e=0;for(const t of this.items)t.armor&&(e+=t.armor.armorClass);return e}getMeleePower(){let e="1d3";for(const t of this.items)t.weapon&&t.pickable&&(t.pickable.effect.type===s.WearableType.ONEHANDED_WEAPON||t.pickable.effect.type===s.WearableType.TWOHANDED_WEAPON)&&(e=t.weapon.damage);return e}getRangePower(){let e="1d3";for(const t of this.items)t.weapon&&t.pickable&&t.pickable.effect.type===s.WearableType.RANGED_WEAPON&&(e=t.weapon.damage);return e}update(e){var t,a;e.destructible&&((0,o.ensure)(null==e?void 0:e.destructible).defense=this.getAC(),(0,o.ensure)(e.attacker).power_melee=this.getMeleePower(),(0,o.ensure)(e.attacker).power_range=this.getRangePower(),this.getRangeWeapon()&&((0,o.ensure)(e.attacker).rangeAttack_range=(0,o.ensure)(null===(a=null===(t=this.getRangeWeapon())||void 0===t?void 0:t.weapon)||void 0===a?void 0:a.rangeMax)))}render(){var e,t;i.game.renderMenuBackground({title:"EQUIPS",x:59,y:4,w:10,h:30});let a=0;if(i.game.player&&i.game.player.equipments&&(null===(e=i.game.player.equipments)||void 0===e?void 0:e.items.length)>0)for(const e of(0,o.ensure)(null===(t=i.game.player.equipments)||void 0===t?void 0:t.items))i.game.drawText((0,o.capitalize)(e.name),60,6+a),a++}}},382:function(e,t,a){var i=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[a]}})}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&i(t,e,a);return s(t,e),t},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createItem=t.items=t.weapons=t.armors=void 0;const n=r(a(260)),l=r(a(886)),c=r(a(391)),h=r(a(204)),d=o(a(524)),u=o(a(889)),f=o(a(692)),g=r(a(808)),m=a(792),p=a(928),v=a(409);t.armors=l.default,t.weapons=h.default,t.items=c.default,t.createItem=e=>{let a,i,s,o="?",r=n.default.default_item,l=!1,c=u.ArmorType.LIGHT_ARMOR;if((e=>!!t.weapons.find((t=>t.name===e)))(e.name)){const i=(0,p.ensure)((e=>t.weapons.find((t=>t.name===e)))(e.name));let n=f.DamageType.BLUDGEONING,c=d.WearableType.ONEHANDED_WEAPON;"bludgeoning"===i.damageType&&(n=f.DamageType.BLUDGEONING),"slashing"===i.damageType&&(n=f.DamageType.SLASHING),"piercing"===i.damageType&&(n=f.DamageType.PIERCING),"one-handed"===i.wearableType&&(c=d.WearableType.ONEHANDED_WEAPON,o="f"),"two-handed"===i.wearableType&&(c=d.WearableType.TWOHANDED_WEAPON,o="F"),"ranged"===i.wearableType&&(c=d.WearableType.RANGED_WEAPON,o="€"),s=new f.default({name:e.name,damage:null==i?void 0:i.damage,damageType:n,rangeMax:i.rangeMax,needReload:"loading"===i.special}),r=v.Colors.WEAPON_ITEM,l=!1,a=new d.default({selector:void 0,effect:new d.Wearable(c),weight:i.weight})}else if((e=>!!t.armors.find((t=>t.name===e)))(e.name)){const s=(0,p.ensure)((e=>t.armors.find((t=>t.name===e)))(e.name));"light"===s.armorType&&(c=u.ArmorType.LIGHT_ARMOR),"medium"===s.armorType&&(c=u.ArmorType.MEDIUM_ARMOR),"heavy"===s.armorType&&(c=u.ArmorType.HEAVY_ARMOR),"shield"===s.armorType&&(c=u.ArmorType.SHIELD),i=new u.default({name:e.name,ac:s.ac,armorClassAbilityType:c===u.ArmorType.HEAVY_ARMOR?"str":"dex",armorType:c,requirementStrenght:0}),o="L",r=v.Colors.ARMOR_ITEM,l=!1,a=new d.default({selector:void 0,effect:new d.Wearable(c===u.ArmorType.SHIELD?d.WearableType.SHIELD:d.WearableType.ARMOR),weight:s.weight})}else if((e=>!!t.items.find((t=>t.name===e)))(e.name)){const i=(0,p.ensure)((e=>t.items.find((t=>t.name===e)))(e.name));let s,n;o=i.ch,r=i.color,l=!1,"selected range"===i.selector.type&&(s=new d.TargetSelector(d.SelectorType.SELECTED_RANGE,i.selector.range)),"selected monster"===i.selector.type&&(s=new d.TargetSelector(d.SelectorType.SELECTED_MONSTER,i.selector.range)),"closest monster"===i.selector.type&&(s=new d.TargetSelector(d.SelectorType.CLOSEST_MONSTER,i.selector.range)),"health"===i.effect.type&&(n=new d.HealthEffect(i.effect.amount,i.message)),"map clear"===i.effect.type&&(n=new d.MapClearEffect(i.message)),"change ai"===i.effect.type&&(n=new d.AiChangeEffect(new m.ConfusedMonsterAi(i.effect.amount),i.message)),a=new d.default({selector:s,effect:n,weight:i.weight})}else console.error(`${name} not found.`);const h=new g.default(e.x,e.y,o,e.name,r);return h.blocks=l,h.pickable=a,h.armor=i,h.weapon=s,h}},524:function(e,t,a){var i=this&&this.__awaiter||function(e,t,a,i){return new(a||(a=Promise))((function(s,o){function r(e){try{l(i.next(e))}catch(e){o(e)}}function n(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(r,n)}l((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.AiChangeEffect=t.HealthEffect=t.Wearable=t.WearableType=t.MapClearEffect=t.TargetSelector=t.SelectorType=void 0;const s=a(607),o=a(928),r=a(409);var n,l;!function(e){e[e.NONE=0]="NONE",e[e.CLOSEST_MONSTER=1]="CLOSEST_MONSTER",e[e.SELECTED_MONSTER=2]="SELECTED_MONSTER",e[e.WEARER_RANGE=3]="WEARER_RANGE",e[e.SELECTED_RANGE=4]="SELECTED_RANGE"}(n=t.SelectorType||(t.SelectorType={})),t.TargetSelector=class{constructor(e,t){this.type=e,this.range=t}selectTargets(e,t){return i(this,void 0,void 0,(function*(){const a=()=>i(this,void 0,void 0,(function*(){const[a,i,o]=yield s.game.pickATile(e.x,e.y);if(void 0===a||!1===a)return;const r=s.game.getActor(i,o);r&&r.destructible&&!r.destructible.isDead()&&r.getDistance(i,o)<=this.range&&t.push(r)})),o=()=>{const a=s.game.getClosestMonster(e.x,e.y,this.range);a&&t.push(a)},r=()=>i(this,void 0,void 0,(function*(){const[a,i,o]=yield s.game.pickATile(e.x,e.y);if(!1===a)return;const r=s.game.getActor(i,o);r&&t.push(r)})),l=()=>{for(const a of s.game.actors)a!=e&&a.destructible&&!a.destructible.isDead()&&a.getDistance(e.x,e.y)<=this.range&&t.push(a)};switch(this.type){case n.CLOSEST_MONSTER:o();break;case n.SELECTED_MONSTER:yield r();break;case n.WEARER_RANGE:l();break;case n.SELECTED_RANGE:yield a();break;default:console.error(`Error with selectorType: ${this.type}`)}0===t.length&&s.game.log.add("No enemy is close enough.")}))}},t.MapClearEffect=class{constructor(e){this.message=e}applyTo(e){var t,a,i;return(0,o.ensure)(e),null===(a=null===(t=s.game.player)||void 0===t?void 0:t.fov)||void 0===a||a.showAll(),null===(i=s.game.player)||void 0===i||i.computeFov(),!0}},(l=t.WearableType||(t.WearableType={}))[l.ARMOR=0]="ARMOR",l[l.SHIELD=1]="SHIELD",l[l.ONEHANDED_WEAPON=2]="ONEHANDED_WEAPON",l[l.TWOHANDED_WEAPON=3]="TWOHANDED_WEAPON",l[l.RANGED_WEAPON=4]="RANGED_WEAPON",t.Wearable=class{constructor(e){this.type=e}applyTo(e){return(0,o.ensure)(e),console.log("apply to:"+e.name),!1}},t.HealthEffect=class{constructor(e,t){this.amount=0,this.amount=e,this.message=t}applyTo(e){if(!e||!e.destructible)return!1;if(this.amount>0){if(e.destructible.heal(this.amount)>0)return this.message&&s.game.log.add(this.message,r.Colors.HEALED),!0}else if(this.message&&-this.amount-e.destructible.defense>0&&s.game.log.add(this.message),e.destructible.takeDamage(e,-this.amount)>0)return!0;return!1}},t.AiChangeEffect=class{constructor(e,t){this.message=t,this.newAi=e}applyTo(e){return this.newAi.applyTo(e),this.message&&s.game.log.add(this.message),!0}},t.default=class{constructor(e){this.selector=null==e?void 0:e.selector,this.effect=null==e?void 0:e.effect,this.weight=null==e?void 0:e.weight,void 0!==this.selector&&(this.selectorName=this.selector.constructor.name),void 0!==this.effect&&(this.effectName=this.effect.constructor.name)}pick(e,t){return!(!t.container||!t.container.add(e)||(s.game.removeActor(e),0))}use(e,t){var a;return i(this,void 0,void 0,(function*(){s.game.log.add(`You use a ${e.name}.`);const i=Array();this.selector?yield this.selector.selectTargets(t,i):i.push(t);let o=!1;for(const e of i)console.log("actor:",e),(null===(a=this.effect)||void 0===a?void 0:a.applyTo(e))&&(o=!0);return o&&t.container&&t.container.remove(e),o}))}drop(e,t){t.container&&(t.container.remove(e),s.game.actors.push(e),s.game.sendToBack(e),e.x=t.x,e.y=t.y,s.game.log.add(`${t.name} drops a ${e.name}.`))}wear(e,t){if((e.armor||e.weapon)&&t.container&&t.equipments&&e.pickable){t.container.remove(e);const a=t.equipments.takeOff(e.pickable.effect.type);t.container&&a&&(s.game.log.add(`${t.name} removes a ${a.name}.`),t.container.add(a)),t.equipments.add(e),s.game.log.add(`${t.name} wears a ${e.name}.`),t.equipments.update(t)}}}},10:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(705)),o=a(928),r=i(a(451)),n=i(a(357)),l=new r.default;t.default=class{constructor(e,t,a,i,s=5){this.maxLevel=s,this.rootContainer=new n.default(e+1,t+1,a-2,i-2),this.rows=i,this.cols=a,this.map=[],this.doorPlaces=[],this.tempRooms=[];for(let e=0;e<this.rows;e++)for(let t=0;t<this.cols;t++){const a=this.cols*e+t;this.map[a]=1}this.tree=this.Devide(this.rootContainer,0),this.rooms=this.tree.GetLeafs(),this.CreateRooms(),this.ConnectRooms(this.tree)}RandomSplit(e){let t,a,i=!l.getInt(0,1);if(i=e.w>e.h&&e.w/e.h>=.05,i){const i=l.getInt(.3*e.w,.6*e.w);t=new n.default(e.x,e.y,i,e.h),a=new n.default(e.x+i,e.y,e.w-i,e.h)}else{const i=l.getInt(.3*e.h,.6*e.h);t=new n.default(e.x,e.y,e.w,i),a=new n.default(e.x,e.y+i,e.w,e.h-i)}return[t,a]}Devide(e,t){const a=new s.default(e);if(t<this.maxLevel){const i=this.RandomSplit(e);a.A=this.Devide(i[0],t+1),a.B=this.Devide(i[1],t+1)}return a}CreateRooms(){for(const e of this.rooms){const t=l.getInt(.5*e.w,.9*e.w),a=l.getInt(.5*e.h,.9*e.h),i=l.getInt(e.x,e.x+e.w-t),s=l.getInt(e.y,e.y+e.h-a),o=new n.default(i,s,i+t,s+a);this.tempRooms.push(o);for(let e=s;e<s+a;e++)for(let a=i;a<i+t;a++){const t=this.cols*e+a;this.map[t]=0}}}IsThereRoom(e,t){for(const a of this.tempRooms)if(e>=a.x&&t>=a.y&&e<=a.w&&t<=a.h)return!0;return!1}ConnectRooms(e){if(!e.A||!e.B)return!1;const t=(0,o.float2int)(e.A.leaf.GetCenterX()),a=(0,o.float2int)(e.A.leaf.GetCenterY()),i=(0,o.float2int)(e.B.leaf.GetCenterX()),s=(0,o.float2int)(e.B.leaf.GetCenterY());let r=!1,l=!1;for(let e=Math.min(t,i);e<=Math.max(t,i);e++){const t=this.cols*Math.max(a,s)+e;if(this.map[t]=0,r||!0!==this.IsThereRoom(e,Math.max(a,s))){if(!r&&!1===this.IsThereRoom(e,Math.max(a,s))&&!0===l){r=!0;const t=new n.default(e,Math.max(a,s),0,0);this.doorPlaces.push(t)}}else l=!0}r=!1;for(let e=Math.min(a,s);e<=Math.max(a,s);e++){const a=this.cols*e+Math.max(t,i);if(this.map[a]=0,r||!0!==this.IsThereRoom(Math.max(t,i),e)){if(!r&&!1===this.IsThereRoom(Math.max(t,i),e)&&!0===l){r=!0;const a=new n.default(Math.max(t,i),e,0,0);this.doorPlaces.push(a)}}else l=!0}this.ConnectRooms((0,o.ensure)(e.A)),this.ConnectRooms((0,o.ensure)(e.B))}}},705:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(a(357));class o extends s.default{constructor(e){super(e.x,e.y,e.w,e.h),this.A=void 0,this.B=void 0,this.leaf=e}GetLeafs(){return this.A&&this.B?[...this.A.GetLeafs(),...this.B.GetLeafs()]:[this.leaf]}}t.default=o},84:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Camera=void 0,t.Camera=class{constructor(){this.centerX=0,this.centerY=0,this.x=0,this.y=0}setCenter(e,t){this.centerX=e/2,this.centerY=t/2}compute(e,t){this.x=this.centerX-e,this.y=this.centerY-t}}},135:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LightingColor=void 0;const i=a(607),s=a(928);class o{constructor(e,t,a){this.r=0,this.g=0,this.b=0,this.r=e,this.g=t,this.b=a}}t.LightingColor=o,t.default=class{constructor(e,t){this.lightColor=[],this.width=e,this.height=t,this.mapped=new Array(this.width*this.height).fill(0),this.light=new Array(this.width*this.height).fill(0);for(let e=0;e<this.width*this.height;e++)this.lightColor.push(new o(0,0,0));this.lightPositions=[]}clear(){for(let e=0;e<this.width*this.height;e++)2===this.mapped[e]&&(this.mapped[e]=1,this.light[e]=128)}fullClear(){this.mapped=new Array(this.width*this.height).fill(0),this.light=new Array(this.width*this.height).fill(0)}showAll(){var e,t,a,o,r,n,l,c,h;this.mapped=new Array(this.width*this.height).fill(2);for(let d=1;d<this.height-1;d++)for(let u=1;u<this.width-1;u++)if(1==(null===(e=i.game.map)||void 0===e?void 0:e.isWall(u,d))){let e=0;if((null===(t=i.game.map)||void 0===t?void 0:t.isWall(u-1,d))&&e++,(null===(a=i.game.map)||void 0===a?void 0:a.isWall(u+1,d))&&e++,(null===(o=i.game.map)||void 0===o?void 0:o.isWall(u,d-1))&&e++,(null===(r=i.game.map)||void 0===r?void 0:r.isWall(u,d+1))&&e++,(null===(n=i.game.map)||void 0===n?void 0:n.isWall(u-1,d+1))&&e++,(null===(l=i.game.map)||void 0===l?void 0:l.isWall(u+1,d+1))&&e++,(null===(c=i.game.map)||void 0===c?void 0:c.isWall(u-1,d-1))&&e++,(null===(h=i.game.map)||void 0===h?void 0:h.isWall(u+1,d-1))&&e++,e>=8){const e=(0,s.float2int)(u)+(0,s.float2int)(d)*this.width;this.mapped[e]=0}}}computeLightSource(e){var t;let a=0,o=0,r=0,n=0;if(this.lightColor)for(let l=0;l<360;l++){a=Math.sin(l/3.1415*180),o=Math.cos(l/3.1415*180),r=e.x+.5,n=e.y+.5;const c=8;for(let e=1;e<c&&!(r<=0||r>=this.width||n<=0||n>=this.height);e++){const l=(0,s.float2int)((0,s.float2int)(r)+(0,s.float2int)(n)*this.width),c=1/(e+1);if(this.lightColor[l].r+=255*c*.02,this.lightColor[l].g+=200*c*.02,this.lightColor[l].b+=128*c*.02,this.lightColor[l].r>255&&(this.lightColor[l].r=255),this.lightColor[l].g>255&&(this.lightColor[l].g=255),this.lightColor[l].b>255&&(this.lightColor[l].b=255),this.lightColor[l].r>255&&(this.lightColor[l].r=255),this.lightColor[l].g>255&&(this.lightColor[l].g=255),this.lightColor[l].b>255&&(this.lightColor[l].b=255),null===(t=i.game.map)||void 0===t?void 0:t.isWall((0,s.float2int)(r),(0,s.float2int)(n))){this.lightColor[l].r=0,this.lightColor[l].g=0,this.lightColor[l].b=0;break}r+=a,n+=o}}}computeLights(){var e;let t=0;for(const e of i.game.actors)"torch"===e.name&&t++;let a=!1;if(t!==this.lightPositions.length){this.lightPositions=[],a=!0;for(const e of i.game.actors)if("torch"===e.name){const t={x:e.x,y:e.y};this.lightPositions.push(t)}}let o=0;for(let e=0;e<i.game.actors.length;e++)if("torch"===i.game.actors[e].name){if(i.game.actors[e].x!==this.lightPositions[o].x||i.game.actors[e].y!==this.lightPositions[o].y){a=!0;break}o++}if(a){const[t,a,o]=(0,s.hexToRGB)((0,s.ensure)(null===(e=i.game.map)||void 0===e?void 0:e.ambienceColor));for(const e of this.lightColor)e.r=(0,s.float2int)(.1*t),e.g=(0,s.float2int)(.1*a),e.b=(0,s.float2int)(.1*o);for(const e of this.lightPositions)this.computeLightSource(e)}}compute(e,t,a){var o;this.clear();let r=0,n=0,l=0,c=0;this.mapped[e+t*this.width]=2,this.light[e+t*this.width]=0;for(let h=0;h<360;h++){r=Math.sin(h/3.1415*180),n=Math.cos(h/3.1415*180),l=e+.5,c=t+.5;let d=a/2;for(let e=0;e<a&&(l+=r,c+=n,!(l<=0||l>=this.width||c<=0||c>=this.height));e++){const t=(0,s.float2int)(l)+(0,s.float2int)(c)*this.width;if(this.mapped[t]=2,this.light[t]=(0,s.float2int)(e*(128/a)),this.light[t]<0&&(this.light[t]=0),this.light[t]>512&&(this.light[t]=512),!(null===(o=i.game.map)||void 0===o?void 0:o.canWalk((0,s.float2int)(l),(0,s.float2int)(c))))break;d=this.getLightValue((0,s.float2int)(l),(0,s.float2int)(c))/255,d<.1&&e>a/2&&(this.mapped[t]=0)}}}getMapped(e,t){return e>=0&&t>=0&&e<this.width&&t<this.height?this.mapped[e+t*this.width]:2}getAmbienceLight(e,t){return e>=0&&t>=0&&e<this.width&&t<this.height?this.light[e+t*this.width]:0}getLight(e,t){return e>=0&&t>=0&&e<this.width&&t<this.height?this.lightColor[e+t*this.width]:{r:0,g:0,b:0}}getLightValue(e,t){if(e>=0&&t>=0&&e<this.width&&t<this.height){const a=this.lightColor[e+t*this.width].r,i=this.lightColor[e+t*this.width].g,o=this.lightColor[e+t*this.width].b;return(0,s.float2int)((a+i+o)/3)}return 0}isInFov(e,t){return e>=0&&t>=0&&e<this.width&&t<this.height&&this.mapped[e+t*this.width]>1}}},423:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.random=void 0;const s=a(607),o=a(382),r=i(a(10)),n=a(127),l=i(a(808)),c=a(928),h=a(409),d=i(a(451)),u=i(a(357));t.random=new d.default;class f{constructor(){this.canWalk=!1,this.explored=!1}}t.default=class{constructor(e,t){this.startX=0,this.startY=0,this.stairsX=0,this.stairsY=0,this.levelSeed=0,this.depth=0,this.ROOM_MAX_SIZE=5,this.ROOM_MIN_SIZE=4,this.MAX_ROOM_MONSTERS=3,this.MAX_ROOM_ITEMS=2,this.width=e,this.height=t,this.templateDoors=[],this.tiles=new Array(this.width*this.height).fill(!1),this.ambienceColor="#AAAAAA"}save(){window.localStorage.setItem("seed",this.levelSeed.toString()),window.localStorage.setItem("depth",this.depth.toString())}isWall(e,t){if(e>=0&&e<=this.width&&t>=0&&t<=this.height){const a=e+t*this.width;return!this.tiles[a].canWalk}return!1}setWall(e,t){this.tiles[e+t*this.width].canWalk=!1}canWalk(e,t){if(this.isWall(e,t))return!1;for(const a of s.game.actors)if(a.x===e&&a.y===t&&a.blocks)return!1;return!0}addMonster(e,a){if(1===this.depth){const i=["bat","rat","jackal","lizard","kobold","giant rat"],o=["giant rat","orc","ghoul"];if(t.random.getInt(0,100)>5){const o=t.random.getInt(0,i.length);s.game.actors.push((0,n.createMonster)(i[o],e,a))}else{const i=t.random.getInt(0,o.length);s.game.actors.push((0,n.createMonster)(o[i],e,a))}}else if(2===this.depth){const i=["rat","jackal","lizard","kobold","kobold","giant rat"],o=["giant rat","orc","ghoul","troll"];if(t.random.getInt(0,100)>5){const o=t.random.getInt(0,i.length);s.game.actors.push((0,n.createMonster)(i[o],e,a))}else{const i=t.random.getInt(0,o.length);s.game.actors.push((0,n.createMonster)(o[i],e,a))}}else if(this.depth>=3){const i=["giant rat","jackal","kobold"],o=["giant rat","orc","ghoul","troll"];if(t.random.getInt(0,100)>15){const o=t.random.getInt(0,i.length);s.game.actors.push((0,n.createMonster)(i[o],e,a))}else{const i=t.random.getInt(0,o.length);s.game.actors.push((0,n.createMonster)(o[i],e,a))}}}pushTo(e,t,a,i){const o=[];for(const a of s.game.actors)a.x===e&&a.y===t&&(a.pickable||a.destructible&&a.destructible.isDead())&&o.push(a);for(const e of o){if(!this.canWalk(e.x+a,e.y+i)){s.game.log.add("Can't push");break}e.x+=a,e.y+=i}return o.length>0}pullTo(e,t,a,i){if(!this.canWalk(e+a,t+i))return s.game.log.add("Can't pull"),!1;const o=[];for(const r of s.game.actors)r.x===e-a&&r.y===t-i&&(r.pickable||r.destructible&&r.destructible.isDead())&&o.push(r);for(const e of o)e.x+=a,e.y+=i;return o.length,!0}findDoor(e,t){const a=s.game.getAllActors(e,t);let i;if(a)for(const e of a)if(e&&"door"===e.name)i=e;else if(e)return void s.game.log.add("There's something and it's blocking!");return i}openCloseDoor(e,t){const a=this.findDoor(e,t);return!!a&&(a.doorOpenOrClose(),!0)}isThereSecretDoor(e){for(const t of s.game.actors)if(t.x>=e.x&&t.x<=e.x+e.w+2&&t.y>=e.y&&t.y<=e.y+e.h+2&&"#"===t.ch&&"door"===t.name)return!0;return!1}addDoor(e,a,i){const o=new l.default(e,a,i?"D":"+","door",h.Colors.DOOR);o.blocks=!0,o.fovOnly=!1;let r=!1;1==this.isWall(e-1,a)&&1==this.isWall(e+1,a)&&(r=!0),1==this.isWall(e,a-1)&&1==this.isWall(e,a+1)&&(r=!0),r&&(s.game.actors.push(o),s.game.sendToBack(o),t.random.getInt(0,100)<20&&(o.ch="#",o.color=h.Colors.WALL))}addItemWithName(e,t,a){const i=(0,o.createItem)({name:e,x:t,y:a});if(i)return s.game.actors.push(i),i}additem(e,a){const i=t.random.getInt(0,100);let r;i<70?t.random.getInt(0,100)<95?r=(0,o.createItem)({name:"health potion",x:e,y:a}):(r=(0,o.createItem)({name:"nutella bun",x:e,y:a}),console.log("There is a faint smell of nutella in the air!")):r=i<80?(0,o.createItem)({name:"scroll of lighting bolt",x:e,y:a}):i<90?(0,o.createItem)({name:"scroll of fireball",x:e,y:a}):i<95?(0,o.createItem)({name:"scroll of confusion",x:e,y:a}):(0,o.createItem)({name:"scroll of map",x:e,y:a}),r&&(s.game.actors.push(r),s.game.sendToBack(r))}dig(e,t,a,i,s){if(e=(0,c.float2int)(e),a=(0,c.float2int)(a),t=(0,c.float2int)(t),a<e){const t=a;a=e,e=t}if((i=(0,c.float2int)(i))<t){const e=i;i=t,t=e}let o=!1;for(let r=e;r<=a;r++)for(let n=t;n<=i;n++){const l=r+n*this.width;0!=this.tiles[l].canWalk||!0!==o||e!==a&&t!==i||s&&r!==this.stairsX&&n!==this.stairsY&&this.templateDoors.push(new u.default(r,n,0,0)),o=this.tiles[l].canWalk,this.tiles[l].canWalk=!0}}addActors(e){let a=t.random.getInt(0,this.MAX_ROOM_MONSTERS),i=t.random.getInt(0,this.MAX_ROOM_ITEMS);const s=e.x,o=e.x+e.w,r=e.y,n=e.y+e.h;for(;a>0;){const e=t.random.getInt(s,o),i=t.random.getInt(r,n);this.canWalk(e,i)&&this.addMonster(e,i),a--}for(;i>0;){const e=t.random.getInt(s,o),a=t.random.getInt(r,n);this.canWalk(e,a)&&this.additem(e,a),i--}}createRoom(e,t,a,i,s){this.dig(e,t,a,i,s)}howManyWalls(e,t){if(e>0&&t>0&&e<this.width-1&&t<this.height-1){let a=0;return this.isWall(e-1,t)&&a++,this.isWall(e+1,t)&&a++,this.isWall(e,t-1)&&a++,this.isWall(e,t+1)&&a++,a}return 0}generate(e,a,i){this.levelSeed=a,this.depth=i,t.random.setSeed(this.levelSeed+25*i);const s=t.random.getInt(4,8);console.log("seed: "+this.levelSeed),console.log("depth: "+this.depth),console.log("split level:"+s),this.ambienceColor=h.Colors.AMBIENCE_COLOR[t.random.getInt(0,h.Colors.AMBIENCE_COLOR.length)],this.tiles=new Array(this.width*this.height).fill(!1);const o=[];for(let e=0;e<this.width*this.height;e++)this.tiles[e]=new f;const n=new r.default(0,0,this.width,this.height,s),l=t.random.getInt(0,100)>70?1:2;let d=0,g=0,m=0,p=0,v=0,_=0;const y=t.random.getInt(0,n.rooms.length-1),w=t.random.getInt(0,n.rooms.length-1);for(let a=0;a<n.rooms.length;a++){const i=n.rooms[a],s=a===y;1===l&&(v=i.w,_=i.h,m=i.x+1,p=i.y+1,v<=0&&(v=1),_<=0&&(_=1),m<=0&&(m=1),p<=0&&(p=1),this.createRoom(m,p,m+v-2,p+_-2,e),s||o.push(new u.default(m,p,v-2,_-2))),2===l&&(v=t.random.getInt(this.ROOM_MIN_SIZE,i.w-2),_=t.random.getInt(this.ROOM_MIN_SIZE,i.h-2),m=t.random.getInt(i.x,i.x+i.w-v-0)+1,p=t.random.getInt(i.y,i.y+i.h-_-0)+1,v<=0&&(v=1),_<=0&&(_=1),m<=0&&(m=1),p<=0&&(p=1),this.createRoom(m,p,m+v-2,p+_-2,e),s||o.push(new u.default(m,p,v-2,_-2))),a===y&&(this.startX=m+(0,c.float2int)(v/2),this.startY=p+(0,c.float2int)(_/2)),a===w&&(this.stairsX=(0,c.float2int)(m+v/2),this.stairsY=(0,c.float2int)(p+_/2)),1!==l&&2!==l||(a>0&&(this.dig(d,g,m+v/2,g,e),this.dig(m+v/2,g,m+v/2,p+_/2,e)),d=m+v/2,g=p+_/2)}if(e){for(const e of o)this.addActors(e);for(const e of this.templateDoors)this.addDoor(e.x,e.y,!0);for(const e of o)if(e.w>=3||e.h>=3){const a=[];this.howManyWalls(e.x,e.y)>1&&a.push(this.addItemWithName("torch",e.x,e.y)),this.howManyWalls(e.x+e.w,e.y)>1&&a.push(this.addItemWithName("torch",e.x+e.w,e.y)),this.howManyWalls(e.x,e.y+e.h)>1&&a.push(this.addItemWithName("torch",e.x,e.y+e.h)),this.howManyWalls(e.x+e.w,e.y+e.h)>1&&a.push(this.addItemWithName("torch",e.x+e.w,e.y+e.h)),a.length>0&&this.isThereSecretDoor(e)&&((0,c.ensure)(a[t.random.getInt(0,a.length-1)]).ch="í",console.log("prup!"))}}}render(){var e,t;for(let a=0;a<this.height;a++)for(let i=0;i<this.width;i++){const o=null===(t=null===(e=s.game.player)||void 0===e?void 0:e.fov)||void 0===t?void 0:t.getMapped(i,a),r=i+s.game.camera.x,n=a+s.game.camera.y;2!==o&&1!==o||(2===o?s.game.drawChar(this.isWall(i,a)?"#":".",r,n,h.Colors.WALL):s.game.drawChar(this.isWall(i,a)?"#":".",r,n,h.Colors.WALL_DARK))}}}},557:(e,t)=>{var a;Object.defineProperty(t,"__esModule",{value:!0}),t.Abilities=t.ABILITIES=void 0,function(e){e[e.STR=0]="STR",e[e.DEX=1]="DEX",e[e.CON=2]="CON",e[e.INT=3]="INT",e[e.WIS=4]="WIS"}(a=t.ABILITIES||(t.ABILITIES={})),t.Abilities=class{constructor(e,t,a,i,s){this.str=0,this.dex=0,this.con=0,this.int=0,this.wis=0,this.str=e,this.dex=t,this.con=a,this.int=i,this.wis=s}getBonus(e){let t=0;switch(e){case a.STR:t=this.str;break;case a.DEX:t=this.dex;break;case a.CON:t=this.con;break;case a.INT:t=this.int;break;case a.WIS:t=this.wis}return Math.floor((t-10)/2)}getBonusWithSign(e){const t=this.getBonus(e);return(t>=0?"+":"")+t.toString()}inRange(e){return e>0&&e<=18}}},889:(e,t)=>{var a;Object.defineProperty(t,"__esModule",{value:!0}),t.ArmorType=void 0,(a=t.ArmorType||(t.ArmorType={}))[a.LIGHT_ARMOR=0]="LIGHT_ARMOR",a[a.MEDIUM_ARMOR=1]="MEDIUM_ARMOR",a[a.HEAVY_ARMOR=2]="HEAVY_ARMOR",a[a.SHIELD=3]="SHIELD",t.default=class{constructor(e){this.name=e.name,this.armorClass=e.ac,this.armorClassAbilityType=e.armorClassAbilityType,this.armorType=e.armorType,this.armorRequirementStrenght=null==e?void 0:e.requirementStrenght}}},529:function(e,t,a){var i=this&&this.__awaiter||function(e,t,a,i){return new(a||(a=Promise))((function(s,o){function r(e){try{l(i.next(e))}catch(e){o(e)}}function n(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(r,n)}l((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const s=a(607),o=a(557),r=a(692),n=a(792),l=a(928),c=a(409);t.default=class{constructor(e,t){this.power_melee=e,this.power_range=t,this.rangeAttack_range=0}attack(e,t){return i(this,void 0,void 0,(function*(){this.meleeAttack(e,t)}))}attackPhase(e,t,a,i,o){var h;if(t.destructible&&!t.destructible.isDead()){const d=n.random.dice(1,20,0),u=(0,l.ensure)(e.abilities).getBonus(a);let f=!1;if(1===d)return void s.game.log.add(`${e.name} attacks ${t.name} and misses.`);if(20===d&&(f=!0,s.game.log.add(`${e.name} makes critical attack to ${t.name}!`,c.Colors.HILIGHT_TEXT)),d>=t.destructible.defense){const[a,d]=i.split("d");let g=1;const m=n.random.dice(g=!0===f?2*parseInt(a):parseInt(a),parseInt(d),0),p=d;s.game.log.add(`${e.name} attacks ${t.name} for ${m} hit points (${g}d${p}${u>0?"+":"-"}${Math.abs(u)}).`,e===s.game.player?c.Colors.PLAYER_ATTACK:c.Colors.ENEMY_ATTACK);let v=m+u;if(v<0&&(v=0),t.destructible.takeDamage(t,v),o===r.DamageType.BLUDGEONING&&!0===f){const a=e.getDistance(t.x,t.y),i=(0,l.float2int)((t.x-e.x)/a),o=(0,l.float2int)((t.y-e.y)/a);(null===(h=s.game.map)||void 0===h?void 0:h.canWalk(t.x+i,t.y+o))&&(t.x+=i,t.y+=o)}}else s.game.log.add(`${e.name} attacks ${t.name} and misses.`)}}rangeAttack(e,t,a){var r,n,h,d,u;return i(this,void 0,void 0,(function*(){const i=s.game.getActor(t,a),f=(0,l.float2int)(e.getDistance(t,a)),g=(t-e.x)/f,m=(a-e.y)/f;let p=e.x,v=e.y,_="-";Math.abs(g)<Math.abs(m)&&(_="|");for(let e=0;e<f+1;e++)yield(0,l.sleep)(100),p+=g,v+=m,s.game.render(),s.game.drawChar(_,(0,l.float2int)(p)+s.game.camera.x,(0,l.float2int)(v)+s.game.camera.y,c.Colors.HILIGHT_TEXT);s.game.render();const y=null===(h=null===(n=null===(r=e.equipments)||void 0===r?void 0:r.getRangeWeapon())||void 0===n?void 0:n.weapon)||void 0===h?void 0:h.damageType;i&&(null===(u=null===(d=s.game.player)||void 0===d?void 0:d.fov)||void 0===u?void 0:u.isInFov(t,a))&&this.attackPhase(e,i,o.ABILITIES.DEX,this.power_range,y)}))}meleeAttack(e,t){var a,i,s;if(t.destructible&&!t.destructible.isDead()){const n=null===(s=null===(i=null===(a=e.equipments)||void 0===a?void 0:a.getMeleeWeapon())||void 0===i?void 0:i.weapon)||void 0===s?void 0:s.damageType;this.attackPhase(e,t,o.ABILITIES.STR,this.power_melee,void 0===n?r.DamageType.BLUDGEONING:n)}}}},637:function(e,t,a){var i=this&&this.__awaiter||function(e,t,a,i){return new(a||(a=Promise))((function(s,o){function r(e){try{l(i.next(e))}catch(e){o(e)}}function n(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(r,n)}l((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.prepareNewJourney=void 0;const s=a(607),o=a(557),r=a(887),n=a(935),l=a(928),c=a(409);var h;!function(e){e[e.choose_race=0]="choose_race",e[e.choose_class=1]="choose_class",e[e.choose_abilities=2]="choose_abilities",e[e.phases_max=3]="phases_max"}(h||(h={})),t.prepareNewJourney=()=>i(void 0,void 0,void 0,(function*(){var e,t,a,i,d,u,f;let g,m=h.choose_race,p=0,v=0,_=0,y=0,w=14,T=0,b=0,x=0;const S=(0,n.createListOfRaces)(),E=(0,r.createListOfClasses)(),A=new o.Abilities(10,10,10,10,10),I=new o.Abilities(10,10,10,10,10),C=(e,t,a)=>{s.game.clear(),s.game.renderVersion(),s.game.drawText("New game",10,1,c.Colors.HILIGHT_TEXT);for(let e=0;e<3;e++){const t=m===e?c.Colors.HILIGHT_TEXT:c.Colors.DEFAULT_TEXT;0==e&&s.game.drawText("Choose race",10,10,t),1==e&&s.game.drawText("Choose class",20,10,t),2==e&&s.game.drawText("Set abilities",30,10,t)}s.game.drawText("Enter) Next   Backspace) Back   Use arrow keys to navigate",11,s.game.height,c.Colors.DEFAULT_TEXT),s.game.drawChar(">",8,12+p,c.Colors.DEFAULT_TEXT);for(let e=0;e<S.length;e++)s.game.drawText(S[e],10,12+e);s.game.drawChar(">",18,12+v,c.Colors.DEFAULT_TEXT);for(let e=0;e<E.length;e++)s.game.drawText(E[e],20,12+e);s.game.drawText(x>0?`Hp increase: ${x} per level`:"",10,18,c.Colors.DEFAULT_TEXT),s.game.drawText("none"!==e?`Resiliences: ${e}`:"",10,19,c.Colors.DEFAULT_TEXT),m===h.choose_abilities&&(g=[],g.push("Use left and right arrows to change ability scores."),g.push(""),0===_&&g.push("Strength: Measuring physical power."),1===_&&g.push("Dexterity: Measuring agility."),2===_&&g.push("Constitution: Measuring endurance."),3===_&&g.push("Intelligence: Measuring reasoning and memory."),4===_&&g.push("Wisdom: Measuring perception and insight.")),s.game.drawChar(">",28,12+_,c.Colors.DEFAULT_TEXT),s.game.drawText("Strength",30,12),s.game.drawText("Dexterity",30,13),s.game.drawText("Constitution",30,14),s.game.drawText("Intelligence",30,15),s.game.drawText("Wisdom",30,16),s.game.drawText("Unused points",30,17),s.game.drawText(`${A.str}`,37,12),s.game.drawText(`${A.dex}`,37,13),s.game.drawText(`${A.con}`,37,14),s.game.drawText(`${A.int}`,37,15),s.game.drawText(`${A.wis}`,37,16),s.game.drawText(`${w}`,37,17),s.game.drawText(0!==a.str?`+${a.str.toString()}`:"",39,12),s.game.drawText(0!==a.dex?`+${a.dex.toString()}`:"",39,13),s.game.drawText(0!==a.con?`+${a.con.toString()}`:"",39,14),s.game.drawText(0!==a.int?`+${a.int.toString()}`:"",39,15),s.game.drawText(0!==a.wis?`+${a.wis.toString()}`:"",39,16),s.game.drawText(`= ${I.str.toString()} (${I.getBonusWithSign(o.ABILITIES.STR)})`,41,12),s.game.drawText(`= ${I.dex.toString()} (${I.getBonusWithSign(o.ABILITIES.DEX)})`,41,13),s.game.drawText(`= ${I.con.toString()} (${I.getBonusWithSign(o.ABILITIES.CON)})`,41,14),s.game.drawText(`= ${I.int.toString()} (${I.getBonusWithSign(o.ABILITIES.INT)})`,41,15),s.game.drawText(`= ${I.wis.toString()} (${I.getBonusWithSign(o.ABILITIES.WIS)})`,41,16);for(let e=0;e<g.length;e++)s.game.drawText(g[e],10,21+e,c.Colors.DEFAULT_TEXT);if(s.game.drawText("Profiencies: ",55,20),t.length>0)for(let e=0;e<t.length;e++)s.game.drawText(t[e],55,22+e);const i=I.getBonus(o.ABILITIES.CON),r=T+i,n=b+i;s.game.drawText(`Health at start: ${T} + ${i} (CON) = ${r}`,50,12),s.game.drawText(`Health increase per level +${b} + ${i} (CON) = ${n}`,50,13)},k=e=>{w-e>=0&&(0===_&&(A.inRange(A.str+e)?A.str+=e:e=0),1===_&&(A.inRange(A.dex+e)?A.dex+=e:e=0),2===_&&(A.inRange(A.con+e)?A.con+=e:e=0),3===_&&(A.inRange(A.int+e)?A.int+=e:e=0),4===_&&(A.inRange(A.wis+e)?A.wis+=e:e=0),w-=e)};for(;;){x=(0,l.ensure)(null===(e=(0,n.getRace)(S[p]))||void 0===e?void 0:e.toughnessIncrease);const o=(0,l.ensure)(null===(t=(0,n.getRace)(S[p]))||void 0===t?void 0:t.resilience),c=(0,l.createListOfProficiencies)(S[p],E[v]);if(m===h.choose_race){const e=(0,l.ensure)(null===(a=(0,n.getRace)(S[p]))||void 0===a?void 0:a.flavourText);g=(0,l.ensure)((0,l.wordWrap)(e,48))}else if(m===h.choose_class){const e=(0,l.ensure)(null===(i=(0,r.getClass)(E[v]))||void 0===i?void 0:i.flavourText);g=(0,l.ensure)((0,l.wordWrap)(e,48))}const w=(0,l.ensure)(null===(d=(0,n.getRace)(S[p]))||void 0===d?void 0:d.abilityIncrease);I.str=A.str+w.str,I.dex=A.dex+w.dex,I.con=A.con+w.con,I.int=A.int+w.int,I.wis=A.wis+w.wis,T=(0,l.ensure)(null===(u=(0,r.getClass)(E[v]))||void 0===u?void 0:u.healthAtStart),b=(0,l.ensure)(null===(f=(0,r.getClass)(E[v]))||void 0===f?void 0:f.healthIncreasePerLevel),C(o,c,w),y=0;const O=yield s.game.getch();let N=!1;switch(O){default:break;case"Enter":m++,m>=h.phases_max&&(N=!0);break;case"Backspace":m--,m<0&&(m=0);break;case"ArrowUp":y=-1;break;case"ArrowDown":y=1;break;case"ArrowLeft":m===h.choose_abilities&&k(-1);break;case"ArrowRight":m===h.choose_abilities&&k(1)}if(s.game.handleZoomKeys(O),N)break;m===h.choose_race&&(p+=y,p<0&&(p=S.length-1),p>S.length-1&&(p=0)),m===h.choose_class&&(v+=y,v<0&&(v=E.length-1),v>E.length-1&&(v=0)),m===h.choose_abilities&&(_+=y,_<0&&(_=4),_>4&&(_=0))}return[I,p,v,T,b,x]}))},887:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getClassNameByIndex=t.createListOfProficiencies_byClass=t.createListOfClasses=t.getClass=void 0;const s=i(a(373)),o=a(928),r=s.default,n=e=>r.find((t=>t.name===e));t.getClass=e=>{if((e=>{for(const t of r)if(t.name===e)return!0;return!1})(e))return(0,o.ensure)(n(e))},t.createListOfClasses=()=>{const e=[];for(const t of s.default)e.push(t.name);return e},t.createListOfProficiencies_byClass=e=>{const t=(0,o.ensure)(n(e)),a=[];for(const e of t.proficiencies)a.push(e.type);return a},t.getClassNameByIndex=e=>r[e].name},127:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createMonster=t.monsters=void 0;const s=i(a(260)),o=i(a(47)),r=a(557),n=i(a(529)),l=i(a(808)),c=a(792),h=a(107),d=a(928);t.monsters=o.default,t.createMonster=(e,a,i)=>{let o="1d4",u=0,f=1,g=0,m="?",p=s.default.default_monster,v=1,_=new r.Abilities(2,2,2,2,2);if((e=>{for(const a of t.monsters)if(a.name===e)return!0;return!1})(e)){const a=(0,d.ensure)((e=>t.monsters.find((t=>t.name===e)))(e));m=a.ch,p=a.color,o=a.attacks[0].damage,g=a.ac,f=a.hp,u=a.xp,_=new r.Abilities(a.abilities.str,a.abilities.dex,a.abilities.con,a.abilities.int,a.abilities.wis),v=a.movingSpeed}const y=new l.default(a,i,m,e,p);return y.destructible=new h.MonsterDestructible(f,g,`dead ${e}`,u),y.attacker=new n.default(o,"1d1"),y.ai=new c.MonsterAI,y.abilities=_,y.ai.movingSpeed=v,y}},935:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getRaceNameByIndex=t.createListOfProficiencies_byRace=t.createListOfRaces=t.getRace=void 0;const s=i(a(882)),o=a(928),r=s.default,n=e=>r.find((t=>t.name===e));t.getRace=e=>{if((e=>{for(const t of r)if(t.name===e)return!0;return!1})(e))return(0,o.ensure)(n(e))},t.createListOfRaces=()=>{const e=[];for(const t of s.default)e.push(t.name);return e},t.createListOfProficiencies_byRace=e=>{const t=(0,o.ensure)(n(e)),a=[];for(const e of t.proficiencies)a.push(e.type);return a},t.getRaceNameByIndex=e=>r[e].name},190:function(e,t,a){var i=this&&this.__awaiter||function(e,t,a,i){return new(a||(a=Promise))((function(s,o){function r(e){try{l(i.next(e))}catch(e){o(e)}}function n(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(r,n)}l((i=i.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createSpell=t.getSpell=t.spells=void 0;const o=s(a(686)),r=a(607),n=a(557),l=a(792),c=a(928),h=a(409);t.spells=o.default,t.getSpell=e=>{if((e=>!!t.spells.find((t=>t.name===e)))(e)){const a=(0,c.ensure)((e=>t.spells.find((t=>t.name===e)))(e));return a}console.error(`There is no spell called ${e}`)},t.createSpell=(e,t,a)=>i(void 0,void 0,void 0,(function*(){var i,s;console.log("caster",t),console.log(`spell level: ${a}`),console.log(JSON.stringify(e,null,2));const o=e.amount.split(";"),n=parseInt(o[a-1]);let l=0,c=0;for(let o=0;o<n;o++){let o=[];if(e.range>0){const[a,i,s]=yield r.game.pickATile(t.x,t.y,e.range);if(l=i,c=s,a)if("cube"===e.effectShape){const a=r.game.getActorsInCube(i,s,e.effectSize,t);a&&(o=a)}else if("cone"===e.effectShape);else if("sphere"===e.effectShape){const a=r.game.getActorsInSphere(i,s,e.effectSize,t);a&&(o=a)}else{const e=r.game.getActor(i,s);e&&o.push(e)}}else l=t.x,c=t.y,o.push(t);for(const s of o)f(s,t,e,a,l,c),null===(i=r.game.player)||void 0===i||i.computeFov(),r.game.render();0===o.length&&(f(void 0,t,e,a,l,c),null===(s=r.game.player)||void 0===s||s.computeFov(),r.game.render())}}));const d=(e,t)=>{var a,i,s,o,r;if(e.length>0){if("str"===e)return(0,c.ensure)(null===(a=t.abilities)||void 0===a?void 0:a.getBonus(n.ABILITIES.STR));if("dex"===e)return(0,c.ensure)(null===(i=t.abilities)||void 0===i?void 0:i.getBonus(n.ABILITIES.DEX));if("con"===e)return(0,c.ensure)(null===(s=t.abilities)||void 0===s?void 0:s.getBonus(n.ABILITIES.CON));if("int"===e)return(0,c.ensure)(null===(o=t.abilities)||void 0===o?void 0:o.getBonus(n.ABILITIES.INT));if("win"===e)return(0,c.ensure)(null===(r=t.abilities)||void 0===r?void 0:r.getBonus(n.ABILITIES.WIS))}return 0},u=e=>"force"===e||"acid"===e||"lightning"===e||"fire"===e||"cold"===e||"radiant"===e||"necrotic"===e||"poison"===e,f=(e,t,a,i,s,o)=>{var f,g,m,p,v,_,y,w,T,b,x,S,E,A,I;const C=a.effectValues.split(";")[i-1];if(e){const i=a.effectType.split(";");for(const S of i){const[i,E,A]=l.random.parseDice(C),I=d(a.effectValue_mod,t);let k=!1,O=0;"str"===a.target_saving_throw_type&&(O=(0,c.ensure)(null===(f=e.abilities)||void 0===f?void 0:f.getBonus(n.ABILITIES.STR))),"dex"===a.target_saving_throw_type&&(O=(0,c.ensure)(null===(g=e.abilities)||void 0===g?void 0:g.getBonus(n.ABILITIES.DEX))),"con"===a.target_saving_throw_type&&(O=(0,c.ensure)(null===(m=e.abilities)||void 0===m?void 0:m.getBonus(n.ABILITIES.CON))),"int"===a.target_saving_throw_type&&(O=(0,c.ensure)(null===(p=e.abilities)||void 0===p?void 0:p.getBonus(n.ABILITIES.INT))),"wis"===a.target_saving_throw_type&&(O=(0,c.ensure)(null===(v=e.abilities)||void 0===v?void 0:v.getBonus(n.ABILITIES.WIS)));const N=l.random.dice(1,20,O),M=l.random.dice(1,20,null===(_=t.abilities)||void 0===_?void 0:_.getBonus(n.ABILITIES.INT));""!==a.target_saving_throw_type&&(r.game.log.add(`Attack roll ${M} (1d20 ${null===(y=t.abilities)||void 0===y?void 0:y.getBonusWithSign(n.ABILITIES.INT)}) against ${N} (${a.target_saving_throw_type} 1d20 ${O>0?"+"+O:O})`),N>=M&&(k=!0));const R=l.random.dice(i,E,A)+I,D=I>0?`+${I}`:`${I}`,L=C+(a.effectValue_mod.length>0?` with ${a.effectValue_mod.toUpperCase()} ${D}`:"");if("heal"===S)r.game.log.add(`${t.name} cast a ${a.name} and heals for ${R} hit points (${L}).`),null===(w=e.destructible)||void 0===w||w.heal(R);else if(u(S))if(""!==a.target_saving_throw_type){const i=a.if_target_saving_throw_success.split(";");if(!0===k)for(const s of i)"half_damage"===s?(r.game.log.add(`${t.name} cast a ${a.name} to ${e.name} for ${(0,c.float2int)(R/2)} hit points (${L} / 2).`),null===(T=e.destructible)||void 0===T||T.takeDamage(e,(0,c.float2int)(R/2))):""===s&&r.game.log.add(`${e.name} dodged the spell!`);else{const i=a.if_target_saving_throw_fail.split(";");for(const n of i)"full_damage"===n&&(r.game.log.add(`${t.name} cast a ${a.name} to ${e.name} for ${(0,c.float2int)(R)} hit points (${L}).`),null===(b=e.destructible)||void 0===b||b.takeDamage(e,(0,c.float2int)(R))),"pushing_away"===n&&e.pushAwayFrom(s,o,2)}}else r.game.log.add(`${t.name} cast a ${a.name} to ${e.name} for ${R} hit points (${L}).`),null===(x=e.destructible)||void 0===x||x.takeDamage(e,R);else r.game.log.add(`unkow effect type ${S}`,h.Colors.DISALLOWED)}}else{const e=a.effectType.split(";");for(const i of e)if("transmutation"===i){const e=a.toCaster.split(";");for(const a of e)"teleport_to_selected_location"===a&&((null===(S=r.game.map)||void 0===S?void 0:S.canWalk(s,o))?(t.x=s,t.y=o,r.game.log.add(`${t.name} teleported!`),null===(E=r.game.player)||void 0===E||E.computeFov(),r.game.camera.compute((0,c.ensure)(null===(A=r.game.player)||void 0===A?void 0:A.x),(0,c.ensure)(null===(I=r.game.player)||void 0===I?void 0:I.y))):r.game.log.add("Can't teleport there."))}}}},692:(e,t)=>{var a;Object.defineProperty(t,"__esModule",{value:!0}),t.DamageType=void 0,(a=t.DamageType||(t.DamageType={}))[a.BLUDGEONING=0]="BLUDGEONING",a[a.PIERCING=1]="PIERCING",a[a.SLASHING=2]="SLASHING",t.default=class{constructor(e){this.name=e.name,this.damage=e.damage,this.damageType=e.damageType,this.rangeMax=e.rangeMax,this.needReload=e.needReload,this.isReloaded=!1}}},808:function(e,t,a){var i=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[a]}})}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&i(t,e,a);return s(t,e),t},r=this&&this.__awaiter||function(e,t,a,i){return new(a||(a=Promise))((function(s,o){function r(e){try{l(i.next(e))}catch(e){o(e)}}function n(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(r,n)}l((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=a(607),l=o(a(524)),c=a(887),h=a(935),d=a(792),u=a(928),f=a(409);t.default=class{constructor(e,t,a,i,s){this.fovOnly=!0,this.blocks=!0,this.x=(0,u.float2int)(e),this.y=(0,u.float2int)(t),this.ch=a,this.color=s,this.name=i,this.race=0,this.class=0,this.fovLen=10}create(e){var t,a,i,s,o,r,n;let c;this.blocks=!1,"Wearable"===(null===(t=e.pickable)||void 0===t?void 0:t.effectName)&&(c=new l.Wearable(e.pickable.effect.type)),"AiChangeEffect"===(null===(a=e.pickable)||void 0===a?void 0:a.effectName)&&(c=new l.AiChangeEffect(new d.ConfusedMonsterAi(parseInt(e.pickable.effect.newAi.nbTurns)),e.pickable.effect.message)),"MapClearEffect"===(null===(i=e.pickable)||void 0===i?void 0:i.effectName)&&(c=new l.MapClearEffect(e.pickable.effect.message)),"HealthEffect"===(null===(s=null==e?void 0:e.pickable)||void 0===s?void 0:s.effectName)&&(c=new l.HealthEffect(null===(o=e.pickable)||void 0===o?void 0:o.effect.amount,void 0)),(null===(r=null==e?void 0:e.pickable)||void 0===r?void 0:r.selectorName)?this.pickable=new l.default({selector:new l.TargetSelector((0,u.ensure)(e.pickable.selector).type,(0,u.ensure)(e.pickable.selector).range),effect:c,weight:e.pickable.weight}):this.pickable=new l.default({selector:void 0,effect:c,weight:(0,u.ensure)(null===(n=e.pickable)||void 0===n?void 0:n.weight)})}render(){var e,t;const a=null===(t=null===(e=n.game.player)||void 0===e?void 0:e.fov)||void 0===t?void 0:t.getMapped(this.x,this.y);(2===a||!this.fovOnly&&0!==a)&&n.game.drawChar(this.ch,this.x+n.game.camera.x,this.y+n.game.camera.y,2===a?this.color:f.Colors.WALL_DARK)}update(e){return r(this,void 0,void 0,(function*(){this.ai&&(yield this.ai.update(this,e))}))}computeFov(){this.fov&&(this.fov.computeLights(),this.fov.compute(this.x,this.y,10))}getDistance(e,t){const a=this.x-e,i=this.y-t;return Math.sqrt(a*a+i*i)}getProfiencies(){const e=(0,h.createListOfRaces)(),t=(0,c.createListOfClasses)();this.proficiencies=(0,u.createListOfProficiencies)(e[this.race],t[this.class])}pushAwayFrom(e,t,a){var i;const s=this.getDistance(e,t),o=(0,u.float2int)((this.x-e)/s),r=(0,u.float2int)((this.y-t)/s);for(let e=0;e<a;e++)(null===(i=n.game.map)||void 0===i?void 0:i.canWalk(this.x+o,this.y+r))&&(this.x+=o,this.y+=r)}doorOpenOrClose(){this.blocks=!this.blocks,this.blocks?(this.ch="D",n.game.log.add("A door is closed.")):"#"===this.ch?(this.color=f.Colors.DOOR,this.ch="+",n.game.log.add("A secret door is opened!",f.Colors.HILIGHT_TEXT)):(this.ch="+",n.game.log.add("A door is opened."))}}},792:function(e,t,a){var i=this&&this.__awaiter||function(e,t,a,i){return new(a||(a=Promise))((function(s,o){function r(e){try{l(i.next(e))}catch(e){o(e)}}function n(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(r,n)}l((i=i.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ConfusedMonsterAi=t.TemporaryAI=t.ConfusedAI=t.MonsterAI=t.PlayerAI=t.random=void 0;const o=a(607),r=a(190),n=a(928),l=a(409),c=s(a(451));t.random=new c.default;class h{constructor(){this.movingSpeed=1}}t.default=h,t.PlayerAI=class extends h{constructor(){super(),this.xpLevel=1,super.movingSpeed=1}getNextLevelXP(){return 200+150*this.xpLevel}pickDirection(){return i(this,void 0,void 0,(function*(){const e=yield o.game.getch();return"ArrowLeft"===e?[-1,0]:"ArrowRight"===e?[1,0]:"ArrowUp"===e?[0,-1]:"ArrowDown"===e?[0,1]:[0,0]}))}update(e){var t,a,s;return i(this,void 0,void 0,(function*(){const i=this.getNextLevelXP();if((0,n.ensure)(e.destructible).xp>=i&&(this.xpLevel++,(0,n.ensure)(e.destructible).xp-=i,o.game.log.add(`Your battle skills grow stronger! You reached level ${this.xpLevel}`,l.Colors.LEVEL_UP),o.game.render()),e.destructible&&e.destructible.isDead())return;let r=0,c=0;const h=yield o.game.getch();switch(h){case"ArrowLeft":r--;break;case"ArrowRight":r++;break;case"ArrowUp":c--;break;case"ArrowDown":c++;break;default:yield this.handleActionKey(e,h)}0===r&&0===c||(o.game.gameStatus=o.GameStatus.NEW_TURN,(yield this.moveOrAttack(e,e.x+r,e.y+c))&&(null===(t=o.game.player)||void 0===t||t.computeFov(),o.game.camera.compute((0,n.ensure)(null===(a=o.game.player)||void 0===a?void 0:a.x),(0,n.ensure)(null===(s=o.game.player)||void 0===s?void 0:s.y))))}))}handleActionKey(e,t){return i(this,void 0,void 0,(function*(){const a=t=>i(this,void 0,void 0,(function*(){var a,i,s,r,n,l;const c=[],h=null===(a=o.game.map)||void 0===a?void 0:a.findDoor(e.x-1,e.y),d=null===(i=o.game.map)||void 0===i?void 0:i.findDoor(e.x+1,e.y),u=null===(s=o.game.map)||void 0===s?void 0:s.findDoor(e.x,e.y-1),f=null===(r=o.game.map)||void 0===r?void 0:r.findDoor(e.x,e.y+1);if(h&&c.push(h),d&&c.push(d),u&&c.push(u),f&&c.push(f),1===c.length&&!1===t)c[0].doorOpenOrClose();else if(c.length>0){o.game.log.add("Which direction?"),o.game.render();const[t,a]=yield this.pickDirection();(null===(n=null===o.game||void 0===o.game?void 0:o.game.map)||void 0===n?void 0:n.openCloseDoor(e.x+t,e.y+a))||o.game.log.add("There is no any door.")}null===(l=o.game.player)||void 0===l||l.computeFov(),o.game.gameStatus=o.GameStatus.NEW_TURN})),s=()=>i(this,void 0,void 0,(function*(){o.game.save(),o.game.log.add("Game saved.",l.Colors.GAME_SAVED)})),c=()=>i(this,void 0,void 0,(function*(){o.game.log.add("Use item");const t=yield this.choseFromInventory(e);t?(yield(0,n.ensure)(t.pickable).use(t,e),o.game.gameStatus=o.GameStatus.NEW_TURN):o.game.log.add("Nevermind...")})),h=()=>i(this,void 0,void 0,(function*(){const t=yield this.choseFromInventory(e);t?(yield(0,n.ensure)(t.pickable).drop(t,e),o.game.gameStatus=o.GameStatus.NEW_TURN):o.game.log.add("Nevermind...")})),d=()=>i(this,void 0,void 0,(function*(){const t=yield this.choseFromInventory(e);t?(yield(0,n.ensure)(t.pickable).wear(t,e),o.game.gameStatus=o.GameStatus.NEW_TURN):o.game.log.add("Nevermind...")})),u=()=>i(this,void 0,void 0,(function*(){var t,a,i,s;if(o.game.getClosestMonster(e.x,e.y,2))return void o.game.log.add("Can't shoot in melee combat.");const r=null===(t=e.equipments)||void 0===t?void 0:t.getRangeWeapon();if(r){if((null===(a=r.weapon)||void 0===a?void 0:a.needReload)&&!r.weapon.isReloaded)return r.weapon.isReloaded=!0,o.game.log.add(`Reloading ${r.name}...`),void(o.game.gameStatus=o.GameStatus.NEW_TURN);const[t,l,c]=yield o.game.pickATile(e.x,e.y,null===(i=r.weapon)||void 0===i?void 0:i.rangeMax);(0,n.ensure)(r.weapon).isReloaded=!1,t&&(yield null===(s=e.attacker)||void 0===s?void 0:s.rangeAttack(e,l,c),o.game.gameStatus=o.GameStatus.NEW_TURN)}else o.game.log.add("Shooting requires a ranged weapon.")})),f=()=>i(this,void 0,void 0,(function*(){o.game.renderMenuBackground({title:"HELP",x:15,y:4,w:45,h:30}),o.game.drawText("Use arrow keys to move and attack",17,6,l.Colors.DEFAULT_TEXT),o.game.drawText("a: Aim",17,7,l.Colors.DEFAULT_TEXT),o.game.drawText("s: Spell",17,8,l.Colors.DEFAULT_TEXT),o.game.drawText("g: Pick up an item.",17,9,l.Colors.DEFAULT_TEXT),o.game.drawText("i: Use item",17,10,l.Colors.DEFAULT_TEXT),o.game.drawText("d: Drop item from inventory",17,11,l.Colors.DEFAULT_TEXT),o.game.drawText(">: Use stairs",17,12,l.Colors.DEFAULT_TEXT),o.game.drawText("o/O: Open or close door.",17,13,l.Colors.DEFAULT_TEXT),o.game.drawText("w: Wear/equip",17,14,l.Colors.DEFAULT_TEXT),o.game.drawText("P/p: Pull/push",17,15,l.Colors.DEFAULT_TEXT),o.game.drawText(".: rest / skip turn",17,16,l.Colors.DEFAULT_TEXT),yield o.game.getch()})),g=()=>i(this,void 0,void 0,(function*(){var t,a,i,s;o.game.log.add("Which direction to push?"),o.game.render();const[r,l]=yield this.pickDirection();(null===(t=null===o.game||void 0===o.game?void 0:o.game.map)||void 0===t?void 0:t.pushTo(e.x+r,e.y+l,r,l))||o.game.log.add("There's nothing to push."),null===(a=o.game.player)||void 0===a||a.computeFov(),o.game.camera.compute((0,n.ensure)(null===(i=o.game.player)||void 0===i?void 0:i.x),(0,n.ensure)(null===(s=o.game.player)||void 0===s?void 0:s.y)),o.game.gameStatus=o.GameStatus.NEW_TURN})),m=()=>i(this,void 0,void 0,(function*(){var t,a,i,s;o.game.log.add("Which direction to pull?"),o.game.render();const[r,l]=yield this.pickDirection();(null===(t=null===o.game||void 0===o.game?void 0:o.game.map)||void 0===t?void 0:t.pullTo(e.x,e.y,r,l))?(e.x+=r,e.y+=l):o.game.log.add("There's nothing to pull."),null===(a=o.game.player)||void 0===a||a.computeFov(),o.game.camera.compute((0,n.ensure)(null===(i=o.game.player)||void 0===i?void 0:i.x),(0,n.ensure)(null===(s=o.game.player)||void 0===s?void 0:s.y)),o.game.gameStatus=o.GameStatus.NEW_TURN})),p=()=>i(this,void 0,void 0,(function*(){const t=["acid splash","cure wounds","magic missile","fire bolt","poison spray","thunderwave","fireball","sacred flame","shatter","misty step"];o.game.renderMenuBackground({title:"test spells",x:20,y:4,w:20,h:4+t.length});let a="a";for(let e=0;e<t.length;e++)o.game.drawText(`${a}) ${t[e]}`,22,6+e,l.Colors.DEFAULT_TEXT),a=String.fromCharCode(a.charCodeAt(0)+1);const i=(yield o.game.getch()).charCodeAt(0)-97;if(i<0||i>=t.length)o.game.log.add("Nevermind");else{o.game.log.add(`Selected spell: ${t[i]}`);const a=(0,r.getSpell)(t[i]);a&&(yield(0,r.createSpell)(a,e,1))}})),v=e=>{const t=o.game.fontSize+e;t>5&&(o.game.setScale(t),o.game.render())};switch(t){case"S":s();break;case">":(null===(_=o.game.stairs)||void 0===_?void 0:_.x)===e.x&&(null===(y=o.game.stairs)||void 0===y?void 0:y.y)===e.y?o.game.nextLevel():o.game.log.add("There are no stairs here.");break;case"g":(()=>{o.game.gameStatus=o.GameStatus.NEW_TURN;let t=!1;for(const a of o.game.actors)if(a.pickable&&a.x===e.x&&a.y===e.y){if(a.pickable.pick(a,e)){t=!0,o.game.log.add(`You pick up the ${a.name}`,l.Colors.PICKED_UP);break}t||(t=!0,o.game.log.add("Your inventory is full.",l.Colors.INVENTORY_FULL))}t||o.game.log.add("There's nothing here that you can pick up.")})();break;case"i":yield c();break;case"d":yield h();break;case"o":yield a(!1);break;case"O":yield a(!0);break;case"w":yield d();break;case"a":yield u();break;case"?":yield f();break;case"p":yield g();break;case"P":yield m();break;case"s":yield p();break;case"-":v(-1);break;case"+":v(1);break;case".":o.game.gameStatus=o.GameStatus.NEW_TURN}var _,y}))}moveOrAttack(e,t,a){var s;return i(this,void 0,void 0,(function*(){if(null===(s=o.game.map)||void 0===s?void 0:s.isWall(t,a))return!1;let i=!1;for(const i of o.game.actors)if(i.destructible&&!i.destructible.isDead()&&i.x===t&&i.y===a)return yield(0,n.ensure)(e.attacker).attack(e,i),!1;for(const e of o.game.actors)(e.destructible&&e.destructible.isDead||e.pickable||"door"===e.name&&"D"===e.ch)&&e.x===t&&e.y===a&&o.game.log.add(`There is a ${e.name} here`),"door"===e.name&&e.blocks&&e.x===t&&e.y===a&&(i=!0);return!i&&(e.x=t,e.y=a,!0)}))}choseFromInventory(e){var t;return i(this,void 0,void 0,(function*(){o.game.clear(),o.game.render(),e.container&&e.equipments&&(e.container.render(),null===(t=e.equipments)||void 0===t||t.render());const a=(yield o.game.getch()).charCodeAt(0)-97;return a>=0&&a<(0,n.ensure)(e.container).inventory.length?(0,n.ensure)(e.container).inventory[a]:null}))}},t.MonsterAI=class extends h{constructor(){super(),this.TRACKING_TURNS=3,this.moveCount=0,this.actionPoints=0,this.movingSpeed=1.5}update(e,t){var a,s;return i(this,void 0,void 0,(function*(){for(this.actionPoints+=1/t*this.movingSpeed;this.actionPoints>=1;){const t=o.game.player;if(e.destructible&&e.destructible.isDead()||!t)return;(null===(s=null===(a=o.game.player)||void 0===a?void 0:a.fov)||void 0===s?void 0:s.isInFov(e.x,e.y))?this.moveCount=this.TRACKING_TURNS:this.moveCount--,this.moveCount>0&&this.moveOrAttack(e,t.x,t.y),this.actionPoints-=1}}))}moveOrAttack(e,t,a){var i,s,r,l;let c=t-e.x,h=a-e.y;const d=c>0?1:-1,u=h>0?1:-1,f=Math.sqrt(c*c+h*h);f>=2?(c=Math.round(c/f),h=Math.round(h/f),(null===(i=o.game.map)||void 0===i?void 0:i.canWalk(e.x+c,e.y+h))?(e.x+=(0,n.float2int)(c),e.y+=(0,n.float2int)(h)):(null===(s=o.game.map)||void 0===s?void 0:s.canWalk(e.x+d,e.y))?e.x+=(0,n.float2int)(d):(null===(r=o.game.map)||void 0===r?void 0:r.canWalk(e.x,e.y+u))&&(e.y+=(0,n.float2int)(u))):null===(l=null==e?void 0:e.attacker)||void 0===l||l.attack(e,(0,n.ensure)(o.game.player))}},t.ConfusedAI=class extends h{constructor(e,t){super(),this.nbTurns=e,this.oldAi=t}update(e){var a,s;return i(this,void 0,void 0,(function*(){const i=t.random.getInt(-1,1),r=t.random.getInt(-1,1);if(0!==i||0!==r){const t=e.x+i,n=e.y+r;if(null===(a=o.game.map)||void 0===a?void 0:a.canWalk(t,n))e.x=t,e.y=n;else{const a=o.game.getActor(t,n);a&&(null===(s=null==e?void 0:e.attacker)||void 0===s||s.attack(e,a))}}this.nbTurns--,this.nbTurns<=0&&(e.ai=this.oldAi)}))}};class d extends h{constructor(e){super(),this.nbTurns=e}update(e){return i(this,void 0,void 0,(function*(){this.nbTurns--,0===this.nbTurns&&(e.ai=this.oldAi)}))}applyTo(e){this.oldAi=e.ai,e.ai=this}}t.TemporaryAI=d,t.ConfusedMonsterAi=class extends d{constructor(e){super(e)}update(e){const a=Object.create(null,{update:{get:()=>super.update}});var s,r;return i(this,void 0,void 0,(function*(){const i=t.random.getInt(-1,1),n=t.random.getInt(-1,1);if(0!=i||0!=n){const t=e.x+i,a=e.y+n;if(null===(s=o.game.map)||void 0===s?void 0:s.canWalk(t,a))e.x=t,e.y=a;else{const i=o.game.getActor(t,a);i&&(null===(r=null==e?void 0:e.attacker)||void 0===r||r.attack(e,i))}}a.update.call(this,e)}))}}},107:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PlayerDestructible=t.MonsterDestructible=void 0;const i=a(607),s=a(928),o=a(409);class r{constructor(e,t,a,i,s){this.maxHP=e,this.hp=this.maxHP,this.defense=t,this.corpseName=a,this.type=i,this.xp=s,this.hpPerLevel=0,this.hpPerLevelBonuses=0}isDead(){return this.hp<=0}heal(e){return this.hp+=e,this.hp>this.maxHP&&(e-=this.hp-this.maxHP,this.hp=this.maxHP),e}takeDamage(e,t){return this.hp-=t,this.hp<=0&&this.die(e),t}die(e){e.color=o.Colors.DEAD_BODY,e.name=this.corpseName,e.blocks=!1,i.game.sendToBack(e)}}t.default=r,t.MonsterDestructible=class extends r{constructor(e,t,a,i){super(e,t,a,"monster",i),this.xp=i}die(e){var t;i.game.log.add(`${e.name} is dead. You gain ${this.xp} xp.`),(0,s.ensure)(null===(t=i.game.player)||void 0===t?void 0:t.destructible).xp+=this.xp,super.die(e)}},t.PlayerDestructible=class extends r{constructor(e,t,a){super(e,t,a,"player",0)}die(e){i.game.log.add("You died.",o.Colors.DEFEAT),super.die(e),i.game.gameStatus=i.GameStatus.DEFEAT}}},409:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Colors=void 0;const s=i(a(260));t.Colors={BACKGROUND:s.default.ui_map_background,WALL:s.default.ui_wall,WALL_DARK:s.default.ui_wall_dark,DOOR:s.default.ui_door,HEALTHPOTION:s.default.pickup_healthpotion,NUTELLABUN:s.default.pickup_nutellabun,SCROLL_OF_LIGHTING:s.default.pickup_scroll_of_lightning,SCROLL_OF_FIREBALL:s.default.pickup_scroll_of_fireball,SCROLL_OF_CONFUSION:s.default.pickup_scroll_of_confusion,SCROLL_OF_MAP:s.default.pickup_scroll_of_map,TORCH:s.default.pickup_torch,ARMOR_ITEM:s.default.pickup_armor_item,WEAPON_ITEM:s.default.pickup_weapon_item,LEVEL_UP:s.default.ui_level_up,HEALED:s.default.ui_healed,MENU_CURSOR:s.default.ui_menu_cursor,GAME_SAVED:s.default.ui_game_saved,PICKED_UP:s.default.ui_picked_up,INVENTORY_FULL:s.default.ui_inventory_full,MENU_BORDER:s.default.ui_menu_border,ALLOWED:s.default.ui_allowed,DISALLOWED:s.default.ui_disallowed,HP_10_PERCENT:s.default.ui_hp_10_percent,HP_25_PERCENT:s.default.ui_hp_25_percent,HP_50_PERCENT:s.default.ui_hp_50_percent,HP_95_PERCENT:s.default.ui_hp_95_percent,HP_MAX:s.default.ui_hp_max,HERO:s.default.actor_hero,STAIRS:s.default.actor_stairs,PLAYER_ATTACK:s.default.log_player_attack,ENEMY_ATTACK:s.default.log_enemy_attack,DEAD_BODY:s.default.log_dead_body,DEFAULT_TEXT:s.default.log_default_text,HILIGHT_TEXT:s.default.log_hilight_text,LOG_BACKGROUND:s.default.log_background,DEFEAT:s.default.log_defeat,AMBIENCE_COLOR:["#0088FF","#CCAAFF","#000000","#CCCCCC","#33AA33","#AAFFAA","#CC00CC","#FFFF00","#33AACC","#FF0000"],VERSION:s.default.ui_version}},928:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.capitalize=t.sleep=t.createListOfProficiencies=t.wordWrap=t.dimmerColor=t.rgbToHex=t.hexToRGB=t.ensure=t.float2int=t.debugInit=t.printVersionContainer=t.populateVersion=t.paddedLogObject=void 0;const i=a(887),s=a(935);t.paddedLogObject=e=>{const t=Object.keys(e).reduce(((e,t)=>t.length+3>e?t.length+3:e),0);console.log(Object.keys(e).map((a=>`${a.padEnd(t," ")}: ${e[a]}`)).join("\n"))},t.populateVersion=()=>"Commit ID: <span>253513e</span> | Version: <span>v0.0.1.20c</span>",t.printVersionContainer=()=>{(0,t.ensure)(document.querySelector("#version")).innerHTML=(0,t.populateVersion)()},t.debugInit=()=>{(0,t.paddedLogObject)({BUILD_DATE:"2021-11-20",BUILD_TIME:"10:05:25",BUILD_DATETIME:"2021-11-20T10:05:25.434Z",COMMIT_HASH:"253513e",VERSION:"v0.0.1.20c"})},t.float2int=e=>e>>0,t.ensure=(e,t="This value was promised to be there.")=>{if(null==e)throw new TypeError(t);return e},t.hexToRGB=e=>{let t=0,a=0,i=0;return 4==e.length?(t=parseInt(`0x${e[1]}${e[1]}`,16),a=parseInt(`0x${e[2]}${e[2]}`,16),i=parseInt(`0x${e[3]}${e[3]}`,16)):7==e.length&&(t=parseInt(`0x${e[1]}${e[2]}`,16),a=parseInt(`0x${e[3]}${e[4]}`,16),i=parseInt(`0x${e[5]}${e[6]}`,16)),[t,a,i]},t.rgbToHex=(e,t,a)=>"#"+((1<<24)+(e<<16)+(t<<8)+a).toString(16).slice(1),t.dimmerColor=(e,a)=>{let[i,s,o]=(0,t.hexToRGB)(e);return i*=a,s*=a,o*=a,i<0&&(i=0),s<0&&(s=0),o<0&&(o=0),i>255&&(i=255),s>255&&(s=255),o>255&&(o=255),i=(0,t.float2int)(i),s=(0,t.float2int)(s),o=(0,t.float2int)(o),(0,t.rgbToHex)(i,s,o)},t.wordWrap=(e,t)=>{let a=0;const i=[];let s=0,o=0;for(let r=0;r<e.length;r++)" "===e.charAt(r)&&(a=r),s++,s>=t&&(i.push(e.substring(o,a)),s=0,o=a+1);return i.push(e.substring(o,e.length)),i},t.createListOfProficiencies=(e,t)=>{const a=(0,s.createListOfProficiencies_byRace)(e),o=(0,i.createListOfProficiencies_byClass)(t),r=new Set,n=[];for(const e of a)r.add(e);for(const e of o)r.add(e);for(const e of r)n.push(e);return n},t.sleep=e=>new Promise((t=>setTimeout(t,e))),t.capitalize=e=>e.charAt(0).toUpperCase()+e.slice(1)},5:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=a(607),s=a(928),o=a(409);class r{constructor(e,t){this.text=e,this.color=t}}t.default=class{constructor(){this.SIZE_OF_LOG=100,this.texts=[]}render(){let e=this.texts.length;e>10&&(e=10),i.game.ctx.fillStyle=o.Colors.LOG_BACKGROUND;let t=this.texts.length;t>10&&(t=10),i.game.ctx.fillRect(.5*i.game.fontSize,(i.game.height-t)*i.game.fontSize,28*i.game.fontSize,(.5+t)*i.game.fontSize);for(let t=this.texts.length-10;t<this.texts.length;t++)t>=0&&(i.game.drawText(this.texts[t].text,1,i.game.height-e,(0,s.dimmerColor)(this.texts[t].color,.05*(20-e))),e--)}add(e,t=o.Colors.DEFAULT_TEXT){const a=(0,s.wordWrap)(e,64);for(const e of a)this.texts.push(new r((0,s.capitalize)(e),t)),this.texts.length>this.SIZE_OF_LOG&&this.texts.splice(0,1)}}},865:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Menu=t.MenuItemCode=t.MenuItem=void 0;class a{constructor(){this.code=0,this.label=""}}var i;t.MenuItem=a,(i=t.MenuItemCode||(t.MenuItemCode={}))[i.NONE=0]="NONE",i[i.NEW_GAME=1]="NEW_GAME",i[i.CONTINUE=2]="CONTINUE",i[i.EXIT=3]="EXIT",i[i.CONSTITUTION=4]="CONSTITUTION",i[i.STRENGTH=5]="STRENGTH",i[i.AGILITY=6]="AGILITY",t.Menu=class{constructor(){this.items=[],this.cursor=0}clear(){this.items&&this.items.length>0&&(this.items=[])}addItem(e,t){const i=new a;i.code=e,i.label=t,this.items.push(i)}}},451:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=a(928);let s=0;t.default=class{constructor(){this.rnd=0}setSeed(e){s=e}calc(){s=(9301*s+49297)%233280,this.rnd=s/233280}getInt(e,t){return t=t||1,e=e||0,this.calc(),Math.floor(e+this.rnd*(t-e))}dice(e,t,a=0){let i=0;t++;for(let a=0;a<e;a++)i+=Number(this.getInt(1,t));return i+=+a,i<e&&(i=e),i}parseDice(e){const t=e.includes("+")?parseInt((0,i.ensure)(e.split("+").at(1))):0,[a,s]=e.split("d");return[parseInt(a),parseInt(s),t]}}},357:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e,t,a,i){this.x=e,this.y=t,this.w=a,this.h=i}GetHalfDimensionX(){return this.w/2}GetHalfDimensionY(){return this.h/2}GetCenterX(){return this.x+this.GetHalfDimensionX()}GetCenterY(){return this.y+this.GetHalfDimensionY()}}}},t={};function a(i){var s=t[i];if(void 0!==s)return s.exports;var o=t[i]={exports:{}};return e[i].call(o.exports,o,o.exports,a),o.exports}a.d=(e,t)=>{for(var i in t)a.o(t,i)&&!a.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a(607)})();