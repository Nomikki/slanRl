(()=>{var e={3063:(e,t)=>{function s(e){if(e)return function(e){for(var t in s.prototype)e[t]=s.prototype[t];return e}(e)}t.Emitter=s,s.prototype.on=s.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},s.prototype.once=function(e,t){function s(){this.off(e,s),t.apply(this,arguments)}return s.fn=t,this.on(e,s),this},s.prototype.off=s.prototype.removeListener=s.prototype.removeAllListeners=s.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var s,i=this._callbacks["$"+e];if(!i)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var o=0;o<i.length;o++)if((s=i[o])===t||s.fn===t){i.splice(o,1);break}return 0===i.length&&delete this._callbacks["$"+e],this},s.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),s=this._callbacks["$"+e],i=1;i<arguments.length;i++)t[i-1]=arguments[i];if(s){i=0;for(var o=(s=s.slice(0)).length;i<o;++i)s[i].apply(this,t)}return this},s.prototype.emitReserved=s.prototype.emit,s.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},s.prototype.hasListeners=function(e){return!!this.listeners(e).length}},9669:(e,t,s)=>{e.exports=s(1609)},5448:(e,t,s)=>{"use strict";var i=s(4867),o=s(6026),n=s(4372),r=s(5327),a=s(4097),c=s(4109),l=s(7985),h=s(5061),d=s(5655),u=s(5263);e.exports=function(e){return new Promise((function(t,s){var f,p=e.data,g=e.headers,m=e.responseType;function y(){e.cancelToken&&e.cancelToken.unsubscribe(f),e.signal&&e.signal.removeEventListener("abort",f)}i.isFormData(p)&&delete g["Content-Type"];var v=new XMLHttpRequest;if(e.auth){var _=e.auth.username||"",w=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";g.Authorization="Basic "+btoa(_+":"+w)}var b=a(e.baseURL,e.url);function T(){if(v){var i="getAllResponseHeaders"in v?c(v.getAllResponseHeaders()):null,n={data:m&&"text"!==m&&"json"!==m?v.response:v.responseText,status:v.status,statusText:v.statusText,headers:i,config:e,request:v};o((function(e){t(e),y()}),(function(e){s(e),y()}),n),v=null}}if(v.open(e.method.toUpperCase(),r(b,e.params,e.paramsSerializer),!0),v.timeout=e.timeout,"onloadend"in v?v.onloadend=T:v.onreadystatechange=function(){v&&4===v.readyState&&(0!==v.status||v.responseURL&&0===v.responseURL.indexOf("file:"))&&setTimeout(T)},v.onabort=function(){v&&(s(h("Request aborted",e,"ECONNABORTED",v)),v=null)},v.onerror=function(){s(h("Network Error",e,null,v)),v=null},v.ontimeout=function(){var t=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",i=e.transitional||d.transitional;e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),s(h(t,e,i.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",v)),v=null},i.isStandardBrowserEnv()){var E=(e.withCredentials||l(b))&&e.xsrfCookieName?n.read(e.xsrfCookieName):void 0;E&&(g[e.xsrfHeaderName]=E)}"setRequestHeader"in v&&i.forEach(g,(function(e,t){void 0===p&&"content-type"===t.toLowerCase()?delete g[t]:v.setRequestHeader(t,e)})),i.isUndefined(e.withCredentials)||(v.withCredentials=!!e.withCredentials),m&&"json"!==m&&(v.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&v.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&v.upload&&v.upload.addEventListener("progress",e.onUploadProgress),(e.cancelToken||e.signal)&&(f=function(e){v&&(s(!e||e&&e.type?new u("canceled"):e),v.abort(),v=null)},e.cancelToken&&e.cancelToken.subscribe(f),e.signal&&(e.signal.aborted?f():e.signal.addEventListener("abort",f))),p||(p=null),v.send(p)}))}},1609:(e,t,s)=>{"use strict";var i=s(4867),o=s(1849),n=s(321),r=s(7185),a=function e(t){var s=new n(t),a=o(n.prototype.request,s);return i.extend(a,n.prototype,s),i.extend(a,s),a.create=function(s){return e(r(t,s))},a}(s(5655));a.Axios=n,a.Cancel=s(5263),a.CancelToken=s(4972),a.isCancel=s(6502),a.VERSION=s(7288).version,a.all=function(e){return Promise.all(e)},a.spread=s(8713),a.isAxiosError=s(6268),e.exports=a,e.exports.default=a},5263:e=>{"use strict";function t(e){this.message=e}t.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},t.prototype.__CANCEL__=!0,e.exports=t},4972:(e,t,s)=>{"use strict";var i=s(5263);function o(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var s=this;this.promise.then((function(e){if(s._listeners){var t,i=s._listeners.length;for(t=0;t<i;t++)s._listeners[t](e);s._listeners=null}})),this.promise.then=function(e){var t,i=new Promise((function(e){s.subscribe(e),t=e})).then(e);return i.cancel=function(){s.unsubscribe(t)},i},e((function(e){s.reason||(s.reason=new i(e),t(s.reason))}))}o.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},o.prototype.subscribe=function(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]},o.prototype.unsubscribe=function(e){if(this._listeners){var t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}},o.source=function(){var e;return{token:new o((function(t){e=t})),cancel:e}},e.exports=o},6502:e=>{"use strict";e.exports=function(e){return!(!e||!e.__CANCEL__)}},321:(e,t,s)=>{"use strict";var i=s(4867),o=s(5327),n=s(782),r=s(3572),a=s(7185),c=s(4875),l=c.validators;function h(e){this.defaults=e,this.interceptors={request:new n,response:new n}}h.prototype.request=function(e){"string"==typeof e?(e=arguments[1]||{}).url=arguments[0]:e=e||{},(e=a(this.defaults,e)).method?e.method=e.method.toLowerCase():this.defaults.method?e.method=this.defaults.method.toLowerCase():e.method="get";var t=e.transitional;void 0!==t&&c.assertOptions(t,{silentJSONParsing:l.transitional(l.boolean),forcedJSONParsing:l.transitional(l.boolean),clarifyTimeoutError:l.transitional(l.boolean)},!1);var s=[],i=!0;this.interceptors.request.forEach((function(t){"function"==typeof t.runWhen&&!1===t.runWhen(e)||(i=i&&t.synchronous,s.unshift(t.fulfilled,t.rejected))}));var o,n=[];if(this.interceptors.response.forEach((function(e){n.push(e.fulfilled,e.rejected)})),!i){var h=[r,void 0];for(Array.prototype.unshift.apply(h,s),h=h.concat(n),o=Promise.resolve(e);h.length;)o=o.then(h.shift(),h.shift());return o}for(var d=e;s.length;){var u=s.shift(),f=s.shift();try{d=u(d)}catch(e){f(e);break}}try{o=r(d)}catch(e){return Promise.reject(e)}for(;n.length;)o=o.then(n.shift(),n.shift());return o},h.prototype.getUri=function(e){return e=a(this.defaults,e),o(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},i.forEach(["delete","get","head","options"],(function(e){h.prototype[e]=function(t,s){return this.request(a(s||{},{method:e,url:t,data:(s||{}).data}))}})),i.forEach(["post","put","patch"],(function(e){h.prototype[e]=function(t,s,i){return this.request(a(i||{},{method:e,url:t,data:s}))}})),e.exports=h},782:(e,t,s)=>{"use strict";var i=s(4867);function o(){this.handlers=[]}o.prototype.use=function(e,t,s){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!s&&s.synchronous,runWhen:s?s.runWhen:null}),this.handlers.length-1},o.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},o.prototype.forEach=function(e){i.forEach(this.handlers,(function(t){null!==t&&e(t)}))},e.exports=o},4097:(e,t,s)=>{"use strict";var i=s(1793),o=s(7303);e.exports=function(e,t){return e&&!i(t)?o(e,t):t}},5061:(e,t,s)=>{"use strict";var i=s(481);e.exports=function(e,t,s,o,n){var r=new Error(e);return i(r,t,s,o,n)}},3572:(e,t,s)=>{"use strict";var i=s(4867),o=s(8527),n=s(6502),r=s(5655),a=s(5263);function c(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new a("canceled")}e.exports=function(e){return c(e),e.headers=e.headers||{},e.data=o.call(e,e.data,e.headers,e.transformRequest),e.headers=i.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),i.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||r.adapter)(e).then((function(t){return c(e),t.data=o.call(e,t.data,t.headers,e.transformResponse),t}),(function(t){return n(t)||(c(e),t&&t.response&&(t.response.data=o.call(e,t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))}},481:e=>{"use strict";e.exports=function(e,t,s,i,o){return e.config=t,s&&(e.code=s),e.request=i,e.response=o,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},e}},7185:(e,t,s)=>{"use strict";var i=s(4867);e.exports=function(e,t){t=t||{};var s={};function o(e,t){return i.isPlainObject(e)&&i.isPlainObject(t)?i.merge(e,t):i.isPlainObject(t)?i.merge({},t):i.isArray(t)?t.slice():t}function n(s){return i.isUndefined(t[s])?i.isUndefined(e[s])?void 0:o(void 0,e[s]):o(e[s],t[s])}function r(e){if(!i.isUndefined(t[e]))return o(void 0,t[e])}function a(s){return i.isUndefined(t[s])?i.isUndefined(e[s])?void 0:o(void 0,e[s]):o(void 0,t[s])}function c(s){return s in t?o(e[s],t[s]):s in e?o(void 0,e[s]):void 0}var l={url:r,method:r,data:r,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:c};return i.forEach(Object.keys(e).concat(Object.keys(t)),(function(e){var t=l[e]||n,o=t(e);i.isUndefined(o)&&t!==c||(s[e]=o)})),s}},6026:(e,t,s)=>{"use strict";var i=s(5061);e.exports=function(e,t,s){var o=s.config.validateStatus;s.status&&o&&!o(s.status)?t(i("Request failed with status code "+s.status,s.config,null,s.request,s)):e(s)}},8527:(e,t,s)=>{"use strict";var i=s(4867),o=s(5655);e.exports=function(e,t,s){var n=this||o;return i.forEach(s,(function(s){e=s.call(n,e,t)})),e}},5655:(e,t,s)=>{"use strict";var i=s(4867),o=s(6016),n=s(481),r={"Content-Type":"application/x-www-form-urlencoded"};function a(e,t){!i.isUndefined(e)&&i.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var c,l={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:(("undefined"!=typeof XMLHttpRequest||"undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process))&&(c=s(5448)),c),transformRequest:[function(e,t){return o(t,"Accept"),o(t,"Content-Type"),i.isFormData(e)||i.isArrayBuffer(e)||i.isBuffer(e)||i.isStream(e)||i.isFile(e)||i.isBlob(e)?e:i.isArrayBufferView(e)?e.buffer:i.isURLSearchParams(e)?(a(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):i.isObject(e)||t&&"application/json"===t["Content-Type"]?(a(t,"application/json"),function(e,t,s){if(i.isString(e))try{return(0,JSON.parse)(e),i.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(0,JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){var t=this.transitional||l.transitional,s=t&&t.silentJSONParsing,o=t&&t.forcedJSONParsing,r=!s&&"json"===this.responseType;if(r||o&&i.isString(e)&&e.length)try{return JSON.parse(e)}catch(e){if(r){if("SyntaxError"===e.name)throw n(e,this,"E_JSON_PARSE");throw e}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};i.forEach(["delete","get","head"],(function(e){l.headers[e]={}})),i.forEach(["post","put","patch"],(function(e){l.headers[e]=i.merge(r)})),e.exports=l},7288:e=>{e.exports={version:"0.24.0"}},1849:e=>{"use strict";e.exports=function(e,t){return function(){for(var s=new Array(arguments.length),i=0;i<s.length;i++)s[i]=arguments[i];return e.apply(t,s)}}},5327:(e,t,s)=>{"use strict";var i=s(4867);function o(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}e.exports=function(e,t,s){if(!t)return e;var n;if(s)n=s(t);else if(i.isURLSearchParams(t))n=t.toString();else{var r=[];i.forEach(t,(function(e,t){null!=e&&(i.isArray(e)?t+="[]":e=[e],i.forEach(e,(function(e){i.isDate(e)?e=e.toISOString():i.isObject(e)&&(e=JSON.stringify(e)),r.push(o(t)+"="+o(e))})))})),n=r.join("&")}if(n){var a=e.indexOf("#");-1!==a&&(e=e.slice(0,a)),e+=(-1===e.indexOf("?")?"?":"&")+n}return e}},7303:e=>{"use strict";e.exports=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}},4372:(e,t,s)=>{"use strict";var i=s(4867);e.exports=i.isStandardBrowserEnv()?{write:function(e,t,s,o,n,r){var a=[];a.push(e+"="+encodeURIComponent(t)),i.isNumber(s)&&a.push("expires="+new Date(s).toGMTString()),i.isString(o)&&a.push("path="+o),i.isString(n)&&a.push("domain="+n),!0===r&&a.push("secure"),document.cookie=a.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},1793:e=>{"use strict";e.exports=function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}},6268:e=>{"use strict";e.exports=function(e){return"object"==typeof e&&!0===e.isAxiosError}},7985:(e,t,s)=>{"use strict";var i=s(4867);e.exports=i.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),s=document.createElement("a");function o(e){var i=e;return t&&(s.setAttribute("href",i),i=s.href),s.setAttribute("href",i),{href:s.href,protocol:s.protocol?s.protocol.replace(/:$/,""):"",host:s.host,search:s.search?s.search.replace(/^\?/,""):"",hash:s.hash?s.hash.replace(/^#/,""):"",hostname:s.hostname,port:s.port,pathname:"/"===s.pathname.charAt(0)?s.pathname:"/"+s.pathname}}return e=o(window.location.href),function(t){var s=i.isString(t)?o(t):t;return s.protocol===e.protocol&&s.host===e.host}}():function(){return!0}},6016:(e,t,s)=>{"use strict";var i=s(4867);e.exports=function(e,t){i.forEach(e,(function(s,i){i!==t&&i.toUpperCase()===t.toUpperCase()&&(e[t]=s,delete e[i])}))}},4109:(e,t,s)=>{"use strict";var i=s(4867),o=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];e.exports=function(e){var t,s,n,r={};return e?(i.forEach(e.split("\n"),(function(e){if(n=e.indexOf(":"),t=i.trim(e.substr(0,n)).toLowerCase(),s=i.trim(e.substr(n+1)),t){if(r[t]&&o.indexOf(t)>=0)return;r[t]="set-cookie"===t?(r[t]?r[t]:[]).concat([s]):r[t]?r[t]+", "+s:s}})),r):r}},8713:e=>{"use strict";e.exports=function(e){return function(t){return e.apply(null,t)}}},4875:(e,t,s)=>{"use strict";var i=s(7288).version,o={};["object","boolean","number","function","string","symbol"].forEach((function(e,t){o[e]=function(s){return typeof s===e||"a"+(t<1?"n ":" ")+e}}));var n={};o.transitional=function(e,t,s){function o(e,t){return"[Axios v"+i+"] Transitional option '"+e+"'"+t+(s?". "+s:"")}return function(s,i,r){if(!1===e)throw new Error(o(i," has been removed"+(t?" in "+t:"")));return t&&!n[i]&&(n[i]=!0,console.warn(o(i," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(s,i,r)}},e.exports={assertOptions:function(e,t,s){if("object"!=typeof e)throw new TypeError("options must be an object");for(var i=Object.keys(e),o=i.length;o-- >0;){var n=i[o],r=t[n];if(r){var a=e[n],c=void 0===a||r(a,n,e);if(!0!==c)throw new TypeError("option "+n+" must be "+c)}else if(!0!==s)throw Error("Unknown option "+n)}},validators:o}},4867:(e,t,s)=>{"use strict";var i=s(1849),o=Object.prototype.toString;function n(e){return"[object Array]"===o.call(e)}function r(e){return void 0===e}function a(e){return null!==e&&"object"==typeof e}function c(e){if("[object Object]"!==o.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function l(e){return"[object Function]"===o.call(e)}function h(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),n(e))for(var s=0,i=e.length;s<i;s++)t.call(null,e[s],s,e);else for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.call(null,e[o],o,e)}e.exports={isArray:n,isArrayBuffer:function(e){return"[object ArrayBuffer]"===o.call(e)},isBuffer:function(e){return null!==e&&!r(e)&&null!==e.constructor&&!r(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:a,isPlainObject:c,isUndefined:r,isDate:function(e){return"[object Date]"===o.call(e)},isFile:function(e){return"[object File]"===o.call(e)},isBlob:function(e){return"[object Blob]"===o.call(e)},isFunction:l,isStream:function(e){return a(e)&&l(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:h,merge:function e(){var t={};function s(s,i){c(t[i])&&c(s)?t[i]=e(t[i],s):c(s)?t[i]=e({},s):n(s)?t[i]=s.slice():t[i]=s}for(var i=0,o=arguments.length;i<o;i++)h(arguments[i],s);return t},extend:function(e,t,s){return h(t,(function(t,o){e[o]=s&&"function"==typeof t?i(t,s):t})),e},trim:function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},stripBOM:function(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e}}},3010:e=>{function t(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}e.exports=t,t.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),s=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-s:e+s}return 0|Math.min(e,this.max)},t.prototype.reset=function(){this.attempts=0},t.prototype.setMin=function(e){this.ms=e},t.prototype.setMax=function(e){this.max=e},t.prototype.setJitter=function(e){this.jitter=e}},8247:(e,t,s)=>{"use strict";s.r(t),s.d(t,{decode:()=>a,encode:()=>r});for(var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o="undefined"==typeof Uint8Array?[]:new Uint8Array(256),n=0;n<i.length;n++)o[i.charCodeAt(n)]=n;var r=function(e){var t,s=new Uint8Array(e),o=s.length,n="";for(t=0;t<o;t+=3)n+=i[s[t]>>2],n+=i[(3&s[t])<<4|s[t+1]>>4],n+=i[(15&s[t+1])<<2|s[t+2]>>6],n+=i[63&s[t+2]];return o%3==2?n=n.substring(0,n.length-1)+"=":o%3==1&&(n=n.substring(0,n.length-2)+"=="),n},a=function(e){var t,s,i,n,r,a=.75*e.length,c=e.length,l=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);var h=new ArrayBuffer(a),d=new Uint8Array(h);for(t=0;t<c;t+=4)s=o[e.charCodeAt(t)],i=o[e.charCodeAt(t+1)],n=o[e.charCodeAt(t+2)],r=o[e.charCodeAt(t+3)],d[l++]=s<<2|i>>4,d[l++]=(15&i)<<4|n>>2,d[l++]=(3&n)<<6|63&r;return h}},9435:e=>{var t=1e3,s=60*t,i=60*s,o=24*i;function n(e,t,s,i){var o=t>=1.5*s;return Math.round(e/s)+" "+i+(o?"s":"")}e.exports=function(e,r){r=r||{};var a,c,l=typeof e;if("string"===l&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var n=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(n){var r=parseFloat(n[1]);switch((n[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*r;case"weeks":case"week":case"w":return 6048e5*r;case"days":case"day":case"d":return r*o;case"hours":case"hour":case"hrs":case"hr":case"h":return r*i;case"minutes":case"minute":case"mins":case"min":case"m":return r*s;case"seconds":case"second":case"secs":case"sec":case"s":return r*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}(e);if("number"===l&&isFinite(e))return r.long?(a=e,(c=Math.abs(a))>=o?n(a,c,o,"day"):c>=i?n(a,c,i,"hour"):c>=s?n(a,c,s,"minute"):c>=t?n(a,c,t,"second"):a+" ms"):function(e){var n=Math.abs(e);return n>=o?Math.round(e/o)+"d":n>=i?Math.round(e/i)+"h":n>=s?Math.round(e/s)+"m":n>=t?Math.round(e/t)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},1227:(e,t,s)=>{t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const s="color: "+this.color;t.splice(1,0,s,"color: inherit");let i=0,o=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(i++,"%c"===e&&(o=i))})),t.splice(o,0,s)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=s(2447)(t);const{formatters:i}=e.exports;i.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},2447:(e,t,s)=>{e.exports=function(e){function t(e){let s,o,n,r=null;function a(...e){if(!a.enabled)return;const i=a,o=Number(new Date),n=o-(s||o);i.diff=n,i.prev=s,i.curr=o,s=o,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let r=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((s,o)=>{if("%%"===s)return"%";r++;const n=t.formatters[o];if("function"==typeof n){const t=e[r];s=n.call(i,t),e.splice(r,1),r--}return s})),t.formatArgs.call(i,e),(i.log||t.log).apply(i,e)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=i,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==r?r:(o!==t.namespaces&&(o=t.namespaces,n=t.enabled(e)),n),set:e=>{r=e}}),"function"==typeof t.init&&t.init(a),a}function i(e,s){const i=t(this.namespace+(void 0===s?":":s)+e);return i.log=this.log,i}function o(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){const e=[...t.names.map(o),...t.skips.map(o).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let s;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const i=("string"==typeof e?e:"").split(/[\s,]+/),o=i.length;for(s=0;s<o;s++)i[s]&&("-"===(e=i[s].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let s,i;for(s=0,i=t.skips.length;s<i;s++)if(t.skips[s].test(e))return!1;for(s=0,i=t.names.length;s<i;s++)if(t.names[s].test(e))return!0;return!1},t.humanize=s(9435),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((s=>{t[s]=e[s]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let s=0;for(let t=0;t<e.length;t++)s=(s<<5)-s+e.charCodeAt(t),s|=0;return t.colors[Math.abs(s)%t.colors.length]},t.enable(t.load()),t}},8058:e=>{try{e.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(t){e.exports=!1}},8260:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>i});const i={colderGray:"#8cb2c6",coldGray:"#979ea1",darkBlue:"#1f273c",darkerBlue:"#495c67",darkerGreen:"#080",darkGreen:"#0a0",darkRed:"#a00",darkYellow:"#aa2",fuxian:"#f0f",gray:"#888",grayRed:"#a88",green:"#0a3",lightBlue:"#0cf",lighterLime:"#afa",lighterRed:"#f88",lighterYellow:"#ffa",lightestGray:"#ddd",lightGray:"#aaa",lightLime:"#8f8",lightOrange:"#fca",lightPastelRed:"#fa9",lightPurple:"#9ac",lightRed:"#f44",lightTeal:"#0fa",lightYellow:"#ddc275",lime:"#3f3",navyBlue:"#1a2032",orange:"#fa0",pastelRed:"#faa",red:"red",teal:"#0a9",turqoise:"aqua",white:"#fff",yellow:"#ff0",ui_allowed:"#fff",ui_background:"#1a2032",ui_disallowed:"#f88",ui_door:"#ddc275",ui_game_saved:"#0fa",ui_healed:"#8f8",ui_hp_10_percent:"#f44",ui_hp_25_percent:"#f44",ui_hp_50_percent:"#faa",ui_hp_95_percent:"#aaa",ui_hp_max:"#afa",ui_info:"#979ea1",ui_inventory_full:"red",ui_level_up:"#ff0",ui_map_background:"#1f273c",ui_menu_border:"#aaa",ui_menu_cursor:"#aaa",ui_picked_up:"#aaa",ui_tempImage:"#3f3",ui_text:"#8cb2c6",ui_version:"#495c67",ui_wall_dark:"#495c67",ui_wall:"#8cb2c6",pickup_armor_item:"#9ac",pickup_healthpotion:"#f0f",pickup_nutellabun:"#ddc275",pickup_scroll_of_confusion:"#ffa",pickup_scroll_of_fireball:"#fa0",pickup_scroll_of_lightning:"aqua",pickup_scroll_of_map:"#aa2",pickup_weapon_item:"#3f3",pickup_torch:"#fa0",actor_hero:"#fff",actor_stairs:"#fff",monster_bat:"#888",monster_ghoul:"#0a9",monster_giant_rat:"#888",monster_jackal:"#888",monster_kobold:"#a88",monster_lizard:"#0a3",monster_orc:"#0a0",monster_rat:"#888",monster_troll:"#080",log_dead_body:"#a00",log_default_text:"#aaa",log_defeat:"#a00",log_enemy_attack:"#aaa",log_hilight_text:"#fff",log_player_attack:"#ddd",log_background:"#1a1a27cc",default_item:"#f0f",default_monster:"#f0f"}},2393:(e,t,s)=>{"use strict";s.r(t)},9850:(e,t,s)=>{"use strict";s.r(t)},1830:(e,t)=>{t.encode=function(e){var t="";for(var s in e)e.hasOwnProperty(s)&&(t.length&&(t+="&"),t+=encodeURIComponent(s)+"="+encodeURIComponent(e[s]));return t},t.decode=function(e){for(var t={},s=e.split("&"),i=0,o=s.length;i<o;i++){var n=s[i].split("=");t[decodeURIComponent(n[0])]=decodeURIComponent(n[1])}return t}},4187:e=>{var t=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,s=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];e.exports=function(e){var i,o,n=e,r=e.indexOf("["),a=e.indexOf("]");-1!=r&&-1!=a&&(e=e.substring(0,r)+e.substring(r,a).replace(/:/g,";")+e.substring(a,e.length));for(var c,l,h=t.exec(e||""),d={},u=14;u--;)d[s[u]]=h[u]||"";return-1!=r&&-1!=a&&(d.source=n,d.host=d.host.substring(1,d.host.length-1).replace(/;/g,":"),d.authority=d.authority.replace("[","").replace("]","").replace(/;/g,":"),d.ipv6uri=!0),d.pathNames=(i=d.path,o=i.replace(/\/{2,9}/g,"/").split("/"),"/"!=i.substr(0,1)&&0!==i.length||o.splice(0,1),"/"==i.substr(i.length-1,1)&&o.splice(o.length-1,1),o),d.queryKey=(c=d.query,l={},c.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(e,t,s){t&&(l[t]=s)})),l),d}},886:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=[{name:"leather armor",ac:11,armorType:"light",weight:10},{name:"studded leather",ac:12,armorType:"light",weight:13},{name:"hide",ac:12,armorType:"medium",weight:12},{name:"chain shirt",ac:13,armorType:"medium",weight:20},{name:"scale mail",ac:14,armorType:"medium",weight:45},{name:"breastplate",ac:14,armorType:"medium",weight:20},{name:"half plate",ac:15,armorType:"medium",weight:40},{name:"ringmail",ac:14,armorType:"heavy",weight:40},{name:"chain mail",ac:16,armorType:"heavy",weight:55},{name:"splint",ac:17,armorType:"heavy",weight:60},{name:"plate",ac:18,armorType:"heavy",weight:65},{name:"shield",ac:2,armorType:"shield",weight:6}]},373:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=[{name:"bard",flavourText:"Whether poet, scholar, or scroundrel, a bard weaves magic through words and music to manipulate minds and heal wounds. The bard is a master of song, speech and the magic they contain.",healthAtStart:8,healthIncreasePerLevel:5,savingThrows:[{type:"dex"}],proficiencies:[{type:"light armor"},{type:"simple weapon"},{type:"hand crossbow"},{type:"longsword"},{type:"rapier"},{type:"shortsword"}]},{name:"cleric",flavourText:"Clerics are intermediaries between the mortal world and the distant of planes of the gods. As varied as the gods they serve, clerics strive to embody the handiwork of their deities and are imbued with magic.",healthAtStart:8,healthIncreasePerLevel:5,savingThrows:[{type:"wis"}],proficiencies:[{type:"light armor"},{type:"simple weapon"},{type:"medium armor"},{type:"shield"}]},{name:"fighter",flavourText:"Every fighter can pick up a weapon and wield it ably. Likewise, a fighter is adept with shields and every form of armor. Beyond that basic degree of familiarity, each fighter specializes in a certain style of combat. Some concentrate on archery, some on fighting with two weapons at once, and some on augmenting on their martial skills with magic.",healthAtStart:10,healthIncreasePerLevel:6,savingThrows:[{type:"con"},{type:"str"}],proficiencies:[{type:"light armor"},{type:"medium armor"},{type:"heavy armor"},{type:"shield"},{type:"simple weapons"},{type:"martial weapons"}]},{name:"rogue",flavourText:"Rogues rely on skill, stealth, and their foes' vulnarabilities to get the upper hand in any situation. They have a knack for finding the solution to just about any problem.",healthAtStart:8,healthIncreasePerLevel:5,savingThrows:[{type:"dex"},{type:"int"}],proficiencies:[{type:"light armor"},{type:"simple weapon"},{type:"hand crossbow"},{type:"longsword"},{type:"rapier"},{type:"shortsword"}]},{name:"wizard",flavourText:"Drawing on the subtle weave of magic that permeates the cosmos, wizards casts spells of explosive fire, arcing lightning, subtle deception and brute-force mind control.",healthAtStart:6,healthIncreasePerLevel:4,savingThrows:[{type:"wis"},{type:"int"}],proficiencies:[{type:"dagger"},{type:"dart"},{type:"sling"},{type:"quarterstaff"},{type:"light crossbow"}]}]},1391:function(e,t,s){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=i(s(8260));t.default=[{name:"health potion",message:"gulp gulp gulp...",ch:"!",color:o.default.pickup_healthpotion,weight:.1,emitLight:!1,selector:{type:"none",range:0},effect:{type:"health",amount:4}},{name:"nutella bun",message:"omnomnom...",ch:"@",color:o.default.pickup_nutellabun,weight:.1,emitLight:!1,selector:{type:"none",range:0},effect:{type:"health",amount:30}},{name:"scroll of fireball",message:"Everything burns.",ch:"#",color:o.default.pickup_scroll_of_fireball,weight:.05,emitLight:!1,selector:{type:"selected range",range:3},effect:{type:"health",amount:-12}},{name:"scroll of confusion",message:"Confused af.",ch:"#",color:o.default.pickup_scroll_of_confusion,weight:.05,emitLight:!1,selector:{type:"selected monster",range:5},effect:{type:"change ai",amount:10}},{name:"scroll of map",message:"All is clear!",ch:"#",color:o.default.pickup_scroll_of_map,weight:.05,emitLight:!1,selector:{type:"none",range:0},effect:{type:"map clear",amount:0}},{name:"scroll of lighting bolt",message:"A lighting bolt strikes!",ch:"#",color:o.default.pickup_scroll_of_lightning,weight:.05,emitLight:!1,selector:{type:"closest monster",range:5},effect:{type:"health",amount:-20}},{name:"torch",message:"A torch is a stick with combustible material at one end, which is ignited and used as a light source.",ch:"ì",color:o.default.pickup_torch,weight:.05,emitLight:!0,selector:{type:"none",range:5},effect:{type:"lighting",amount:10}}]},8047:function(e,t,s){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=i(s(8260));t.default=[{name:"bat","size:":"tiny",type:"beast",movingSpeed:2,ch:"b",color:o.default.monster_bat,hp:1,ac:12,xp:5,abilities:{str:2,dex:15,con:8,int:2,wis:12},attacks:[{name:"bite",damage:"1d1",damageType:"piercing"}]},{name:"jackal","size:":"small",type:"beast",ch:"j",color:o.default.monster_jackal,hp:3,ac:12,xp:10,movingSpeed:1,abilities:{str:8,dex:15,con:11,int:3,wis:12},attacks:[{name:"bite",damage:"1d4",damageType:"piercing"}]},{name:"lizard","size:":"tiny",type:"beast",movingSpeed:1,ch:"l",color:o.default.monster_lizard,hp:2,ac:10,xp:10,abilities:{str:2,dex:11,con:10,int:1,wis:8},attacks:[{name:"bite",damage:"1d1",damageType:"piercing"}]},{name:"kobold","size:":"small",type:"humanoid",movingSpeed:1,ch:"k",color:o.default.monster_kobold,hp:5,ac:12,xp:25,abilities:{str:7,dex:15,con:9,int:8,wis:7},attacks:[{name:"dagger",damage:"1d4",damageType:"piercing"},{name:"sling",damage:"1d4",damageType:"bludgeoning"}]},{name:"rat","size:":"tiny",type:"beast",movingSpeed:1.5,ch:"r",color:o.default.monster_rat,hp:1,ac:10,xp:5,abilities:{str:2,dex:11,con:9,int:2,wis:10},attacks:[{name:"bite",damage:"1d1",damageType:"piercing"}]},{name:"giant rat","size:":"small",type:"beast",movingSpeed:1.5,ch:"R",color:o.default.monster_giant_rat,hp:7,ac:12,xp:25,abilities:{str:7,dex:15,con:11,int:2,wis:10},attacks:[{name:"bite",damage:"1d4",damageType:"piercing"}]},{name:"ghoul",size:"medium",type:"undead",ch:"G",movingSpeed:.75,color:o.default.monster_ghoul,hp:22,ac:12,xp:200,abilities:{str:13,dex:15,con:10,int:7,wis:10},attacks:[{name:"bite",damage:"2d6",damageType:"piercing"},{name:"claws",damage:"2d4",damageType:"slashing"}]},{name:"orc",size:"medium",type:"humanoid",movingSpeed:.9,ch:"o",color:o.default.monster_orc,hp:15,ac:13,xp:100,abilities:{str:16,dex:12,con:16,int:7,wis:11},attacks:[{name:"greataxe",damage:"1d12",damageType:"slashing"},{name:"javelin",damage:"1d6",damageType:"piercing"}]},{name:"troll",size:"large",type:"giant",movingSpeed:.9,ch:"t",color:o.default.monster_troll,hp:84,ac:15,xp:1800,abilities:{str:18,dex:13,con:20,int:7,wis:9},attacks:[{name:"bite",damage:"1d6",damageType:"piercing"},{name:"claw",damage:"2d6",damageType:"slashing"}]}]},882:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=[{name:"dwarf",flavourText:"Kingdoms richs in ancient grandeur, halls carved into the roots of mountains, the echoing of picks and hammers in deep mines and blazing forges, and a commitment to clan and tradition – these common threads unite all dwarves.",toughnessIncrease:1,abilityIncrease:{str:2,dex:0,con:2,int:0,wis:0},resilience:"poison",proficiencies:[{type:"light armor"},{type:"medium armor"}]},{name:"elf",flavourText:"A people of otherworldy grace, elves dwell in places of ethereal beauty, in the midst of ancient forest or in spires glittering with fearie light, where soft music drifts through the air and gentle fragrances waft on the breeze.",toughnessIncrease:0,abilityIncrease:{str:0,dex:2,con:0,int:1,wis:1},resilience:"none",proficiencies:[{type:"longsword"},{type:"shortsword"},{type:"shortbow"},{type:"longbow"}]},{name:"halfling",flavourText:"The diminutive halflings survive in a world full of larger creatures by avoiding notice or, barring that, avoiding offense. Standing about 3 feet tall, they appear relatively harmless and so have managed to survive for centuries in the shadows of empires and on the edges of wars.",toughnessIncrease:0,abilityIncrease:{str:0,dex:2,con:1,int:0,wis:0},resilience:"poison",proficiencies:[]},{name:"human",flavourText:"Humans are the most adaptable and ambitious people among the common races. They have widely varying tastes, morals, and customs in different lands where they have settled. When they settle, though, they stay: they build cities to last for the ages.",toughnessIncrease:0,abilityIncrease:{str:1,dex:1,con:1,int:1,wis:1},resilience:"none",proficiencies:[]}]},5686:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=[{name:"acid splash",effectValues:"1d6;2d6;3d6;4d6",amount:"1",effectValue_mod:"",effectType:"acid",effectShape:"",effectSize:1,range:5,target_saving_throw_type:"dex",if_target_saving_throw_success:"half_damage",if_target_saving_throw_fail:"full_damage",toCaster:"",turns:0},{name:"blur",effectValues:"aura",amount:"1",effectValue_mod:"",effectType:"illusion",effectShape:"",effectSize:1,range:0,target_saving_throw_type:"",if_target_saving_throw_success:"",if_target_saving_throw_fail:"",toCaster:"advantages",turns:20},{name:"burning hands",effectValues:"3d6;4d6;5d6;6d6",amount:"1",effectValue_mod:"",effectType:"fire",effectShape:"cone",effectSize:3,range:3,target_saving_throw_type:"dex",if_target_saving_throw_success:"half_damage",if_target_saving_throw_fail:"full_damage",toCaster:"",turns:0},{name:"cure wounds",effectType:"heal",effectValues:"1d8;2d8;3d8;4d8",amount:"1",effectValue_mod:"int",effectShape:"",effectSize:1,range:0,target_saving_throw_type:"",if_target_saving_throw_success:"",if_target_saving_throw_fail:"",toCaster:"",turns:0},{name:"detect magic",effectType:"aura;show_magic",effectValues:"",amount:"1",effectValue_mod:"",effectShape:"cube",effectSize:3,range:0,target_saving_throw_type:"",if_target_saving_throw_success:"",if_target_saving_throw_fail:"",toCaster:"",turns:600},{name:"fear",effectType:"aura",effectValues:"",amount:"1",effectValue_mod:"",effectShape:"cone",effectSize:1,range:5,target_saving_throw_type:"wis",if_target_saving_throw_success:"",if_target_saving_throw_fail:"escape",toCaster:"",turns:20},{name:"fireball",effectType:"fire",effectValues:"8d6;9d6;10d6",amount:"1",effectValue_mod:"",effectShape:"sphere",effectSize:2,range:7,target_saving_throw_type:"dex",if_target_saving_throw_success:"full_damage",if_target_saving_throw_fail:"half_damage",toCaster:"",turns:0},{name:"fire bolt",effectType:"fire",effectValues:"1d10;2d10;3d10;4d10",amount:"1",effectValue_mod:"",effectShape:"",effectSize:1,range:10,target_saving_throw_type:"",if_target_saving_throw_success:"",if_target_saving_throw_fail:"",toCaster:"",turns:0},{name:"guiding bolt",effectType:"lightning;disadvantage_next_turn",effectValues:"4d6;5d6;6d6;7d6",amount:"1",effectValue_mod:"",effectShape:"sphere",effectSize:1,range:10,target_saving_throw_type:"",if_target_saving_throw_success:"",if_target_saving_throw_fail:"",toCaster:"",turns:0},{name:"haste",effectType:"aura",effectValues:"",amount:"1",effectValue_mod:"",effectShape:"",effectSize:1,range:0,target_saving_throw_type:"",if_target_saving_throw_success:"",if_target_saving_throw_fail:"",toCaster:"ac_add_2;speed_double;advantages",turns:20},{name:"holding person",effectType:"enchament",effectValues:"",amount:"1",effectValue_mod:"",effectShape:"",effectSize:1,range:4,target_saving_throw_type:"wis",if_target_saving_throw_success:"remove_effect",if_target_saving_throw_fail:"paralyzed",toCaster:"",turns:20},{name:"inflict wounds",effectType:"necrotic",effectValues:"3d10;4d10;5d10;6d10",amount:"1",effectValue_mod:"",effectShape:"",effectSize:1,range:1,target_saving_throw_type:"",if_target_saving_throw_success:"",if_target_saving_throw_fail:"",toCaster:"",turns:0},{name:"lightning",effectType:"lightning",effectValues:"3d10;4d10;5d10;6d10",amount:"1",effectValue_mod:"",effectShape:"line",effectSize:1,range:10,target_saving_throw_type:"dex",if_target_saving_throw_success:"half_damage",if_target_saving_throw_fail:"full_damage",toCaster:"",turns:0},{name:"magic missile",effectType:"force",effectValues:"1d4+1",amount:"3;4;5;6",effectValue_mod:"",effectShape:"",effectSize:1,range:5,target_saving_throw_type:"",if_target_saving_throw_success:"",if_target_saving_throw_fail:"",toCaster:"",turns:0},{name:"misty step",effectType:"transmutation",effectValues:"",amount:"1",effectValue_mod:"",effectShape:"",effectSize:1,range:4,target_saving_throw_type:"",if_target_saving_throw_success:"",if_target_saving_throw_fail:"",toCaster:"teleport_to_selected_location",turns:0},{name:"poison spray",effectType:"poison",effectValues:"1d12;2d12;3d12;4d12",amount:"1",effectValue_mod:"",effectShape:"",effectSize:1,range:2,target_saving_throw_type:"con",if_target_saving_throw_success:"",if_target_saving_throw_fail:"full_damage",toCaster:"",turns:0},{name:"ray of frost",effectType:"cold;reduce_speed:5",effectValues:"1d8;2d8;3d8;4d8",amount:"1",effectValue_mod:"",effectShape:"",effectSize:1,range:5,target_saving_throw_type:"",if_target_saving_throw_success:"",if_target_saving_throw_fail:"",toCaster:"",turns:0},{name:"resistance",effectType:"aura",effectValues:"1d4",amount:"1",effectValue_mod:"",effectShape:"",effectSize:1,range:0,target_saving_throw_type:"",if_target_saving_throw_success:"",if_target_saving_throw_fail:"",toCaster:"add_value_to_saving_throws",turns:20},{name:"sacred flame",effectType:"radiant",effectValues:"1d8;2d8;3d8;4d8",amount:"1",effectValue_mod:"",effectShape:"",effectSize:1,range:5,target_saving_throw_type:"dex",if_target_saving_throw_success:"",if_target_saving_throw_fail:"full_damage",toCaster:"",turns:0},{name:"shatter",effectType:"lightning",effectValues:"3d8;4d8;5d8;6d8",amount:"1",effectValue_mod:"",effectShape:"sphere",effectSize:2,range:5,target_saving_throw_type:"con",if_target_saving_throw_success:"half_damage",if_target_saving_throw_fail:"full_damage",toCaster:"",turns:0},{name:"shield of faith",effectType:"aura",effectValues:"",amount:"1",effectValue_mod:"",effectShape:"",effectSize:1,range:0,target_saving_throw_type:"",if_target_saving_throw_success:"",if_target_saving_throw_fail:"",toCaster:"ac_add_2",turns:200},{name:"shocking grasp",effectType:"lightning;disadvantages:1",effectValues:"1d8;2d8;3d8;4d8",amount:"1",effectValue_mod:"",effectShape:"",effectSize:1,range:1,target_saving_throw_type:"",if_target_saving_throw_success:"",if_target_saving_throw_fail:"",toCaster:"",turns:0},{name:"thunderwave",effectType:"lightning",effectValues:"2d8;3d8;4d8;5d8",amount:"1",effectValue_mod:"",effectShape:"cube",effectSize:2,range:1,target_saving_throw_type:"con",if_target_saving_throw_success:"half_damage",if_target_saving_throw_fail:"full_damage;pushing_away",toCaster:"",turns:0},{name:"web",effectType:"",effectValues:"",amount:"1",effectValue_mod:"",effectShape:"",effectSize:2,range:11,target_saving_throw_type:"dex",if_target_saving_throw_success:"remove_effect",if_target_saving_throw_fail:"paralyzed",toCaster:"",turns:1200}]},1204:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=[{name:"club",damage:"1d4",damageType:"bludgeoning",weight:2,rangeMax:1,wearableType:"one-handed",special:""},{name:"dagger",damage:"1d4",damageType:"piercing",weight:1,rangeMax:1,wearableType:"one-handed",special:""},{name:"greatclub",damage:"1d4",damageType:"bludgeoning",weight:10,rangeMax:1,wearableType:"two-handed",special:""},{name:"handaxe",damage:"1d6",damageType:"slashing",weight:2,rangeMax:1,wearableType:"one-handed",special:""},{name:"javelin",damage:"1d6",damageType:"piercing",weight:2,rangeMax:1,wearableType:"one-handed",special:""},{name:"light hammer",damage:"1d4",damageType:"bludgeoning",weight:2,rangeMax:1,wearableType:"one-handed",special:""},{name:"mace",damage:"1d6",damageType:"bludgeoning",weight:4,rangeMax:1,wearableType:"one-handed",special:""},{name:"quarterstaff",damage:"1d6",damageType:"bludgeoning",weight:4,rangeMax:1,wearableType:"one-handed",special:""},{name:"spear",damage:"1d6",damageType:"piercing",weight:3,rangeMax:1,wearableType:"one-handed",special:""},{name:"light crossbow",damage:"1d8",damageType:"piercing",weight:6,rangeMax:12,wearableType:"ranged",special:"loading"},{name:"dart",damage:"1d4",damageType:"piercing",weight:.25,rangeMax:6,wearableType:"ranged",special:""},{name:"shortbow",damage:"1d6",damageType:"piercing",weight:2,rangeMax:12,wearableType:"ranged",special:""},{name:"sling",damage:"1d4",damageType:"bludgeoning",weight:2,rangeMax:8,wearableType:"ranged",special:""}]},9474:function(e,t,s){"use strict";var i=this&&this.__awaiter||function(e,t,s,i){return new(s||(s=Promise))((function(o,n){function r(e){try{c(i.next(e))}catch(e){n(e)}}function a(e){try{c(i.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,a)}c((i=i.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),s(2393);const n=s(5928),r=o(s(9669)),a="https://roguelike.saunalanit.org/api",[c]=window.location.href.split("?"),l=["gist"].join(" "),h=new class{constructor(){const e=(0,n.ensure)(document.querySelector("#login")),t=(0,n.ensure)(document.querySelector("#save")),s=(0,n.ensure)(document.querySelector("#load")),i=(0,n.ensure)(document.querySelector("#logout"));e.addEventListener("click",this.loginToGitHub),t.addEventListener("click",this.saveToGists),s.addEventListener("click",this.loadFromGists),i.addEventListener("click",this.logoutFromGitHub),this.url=new URLSearchParams(window.location.search),this.parseUrl()}focusOnScreen(){(0,n.ensure)(document.querySelector("body")).focus()}setGame(e){this.game=e,this.toggleButtons()}parseUrl(){return i(this,void 0,void 0,(function*(){if(this.url.has("code")){this.code=(0,n.ensure)(this.url.get("code")),history.pushState({},"Slan Roguelike",c);const e={code:this.code},t={headers:{"Access-Control-Allow-Origin":"*","Cache-Control":"no-cache"}};(yield r.default.post(`${a}/access_token`,e,t)).data.split("&").forEach((e=>{const[t,s]=e.split("=");sessionStorage.setItem(t,s)})),this.toggleButtons(),this.fetchProfile()}}))}fetchProfile(){return i(this,void 0,void 0,(function*(){const e={headers:{"Access-Control-Allow-Origin":"*","Cache-Control":"no-cache",Authorization:`${sessionStorage.getItem("token_type")} ${sessionStorage.getItem("access_token")}`}},t=yield r.default.get(`${a}/user`,e);this.username=t.data.login,sessionStorage.setItem("username",t.data.login)}))}loginToGitHub(){console.log("Login"),window.location.href=`https://github.com/login/oauth/authorize?client_id=29d912f29a2274f9cb81&scope=${l}&redirect_uri=${c}`,h.focusOnScreen()}saveToGists(){return i(this,void 0,void 0,(function*(){console.log("Save");const e=[];for(const t in localStorage){const s=localStorage[t];"string"==typeof s&&e.push([t,s])}const t={description:"Slan Roguelike - Cloud save",public:!1,files:{"slanRl-localStorage.json":{content:JSON.stringify(e)}}};console.log("data",t);const s={headers:{Authorization:`${sessionStorage.getItem("token_type")} ${sessionStorage.getItem("access_token")}`,Accept:"application/vnd.github.v3+json","Content-type":"application/json","Cache-Control":"no-cache"}};console.log("options",s);const i=yield h.findGist(),o=(null==i?void 0:i.id)?"patch":"post",n=yield r.default[o](`${a}/gists${(null==i?void 0:i.id)?`/${null==i?void 0:i.id}`:""}`,t,s);console.log("Saved",n),h.focusOnScreen()}))}findGist(){return i(this,void 0,void 0,(function*(){const e={headers:{Authorization:`${sessionStorage.getItem("token_type")} ${sessionStorage.getItem("access_token")}`,Accept:"application/vnd.github.v3+json","Content-type":"application/json","Cache-Control":"no-cache"}},t=(yield r.default.get(`${a}/gists`,e)).data;return console.log("gists",t),t.find((({description:e})=>"Slan Roguelike - Cloud save"===e))}))}loadFromGists(){return i(this,void 0,void 0,(function*(){console.log("Load");const e={headers:{Authorization:`${sessionStorage.getItem("token_type")} ${sessionStorage.getItem("access_token")}`,Accept:"application/vnd.github.v3+json","Content-type":"application/json","Cache-Control":"no-cache"}},t=yield h.findGist();(yield r.default.get(`${a}/file?file=${t.files["slanRl-localStorage.json"].raw_url}`,e)).data.map((([e,t])=>localStorage.setItem(e,t))),window.location.reload()}))}logoutFromGitHub(){sessionStorage.clear(),h.toggleButtons(),h.focusOnScreen()}toggleButtons(){var e,t;const s=(0,n.ensure)(document.querySelector("#login")),i=(0,n.ensure)(document.querySelector("#save")),o=(0,n.ensure)(document.querySelector("#load")),r=(0,n.ensure)(document.querySelector("#logout"));(null===(e=this.game)||void 0===e?void 0:e.socket)&&(null===(t=this.game)||void 0===t?void 0:t.socket.connected)?sessionStorage.getItem("access_token")?(s.classList.add("hidden"),localStorage.getItem("version")?i.classList.remove("hidden"):i.classList.add("hidden"),o.classList.remove("hidden"),r.classList.remove("hidden")):(s.classList.remove("hidden"),i.classList.add("hidden"),o.classList.add("hidden"),r.classList.add("hidden")):(s.classList.add("hidden"),i.classList.add("hidden"),o.classList.add("hidden"),r.classList.add("hidden"))}};t.default=h},3607:function(e,t,s){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,s,i){void 0===i&&(i=s),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[s]}})}:function(e,t,s,i){void 0===i&&(i=s),e[i]=t[s]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&i(t,e,s);return o(t,e),t},r=this&&this.__awaiter||function(e,t,s,i){return new(s||(s=Promise))((function(o,n){function r(e){try{c(i.next(e))}catch(e){n(e)}}function a(e){try{c(i.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,a)}c((i=i.apply(e,t||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.game=t.Game=t.GameStatus=void 0,s(9850);const c=a(s(7801)),l=a(s(8927)),h=s(6382),d=a(s(7423)),u=s(1084),f=a(s(1135)),p=s(6557),g=a(s(7529)),m=s(6637),y=a(s(808)),v=s(792),_=n(s(7107)),w=s(5928),b=s(7409),T=a(s(3005)),E=s(5865),k=a(s(9474)),S=s(8924),x=s(5887),C=s(6935),A=s(5302);var O;!function(e){e[e.MAINMENU=0]="MAINMENU",e[e.NEWGAME=1]="NEWGAME",e[e.STARTUP=2]="STARTUP",e[e.IDLE=3]="IDLE",e[e.NEW_TURN=4]="NEW_TURN",e[e.VICTORY=5]="VICTORY",e[e.DEFEAT=6]="DEFEAT"}(O=t.GameStatus||(t.GameStatus={}));class I{constructor(){this.gameStatus=O.MAINMENU,this.fontSize=12,this.masterSeed=0,this.turns=0,this.mapx=80,this.mapy=80,this.socket=(0,A.connectSocket)(),this.canvas=(0,w.ensure)(document.querySelector("#screen")),this.ctx=(0,w.ensure)(this.canvas.getContext("2d")),this.setScale(12),this.ctx.textAlign="center",this.log=new T.default,this.lastKey="",this.depth=0,this.turns=0,this.width=80,this.height=57,this.actors=[],this.map=new d.default(this.mapx,this.mapy),this.camera=new u.Camera,this.camera.setCenter(this.width,this.height);const e=(0,w.ensure)(document.querySelector("#temp-image"));this.github=k.default,this.github.setGame(this),e.addEventListener("click",(()=>{e.classList.toggle("zoomed")})),window.addEventListener("resize",this.fitCanvasToScreen),this.socket&&this.addSocketEvents()}getStats(){return{playerName:sessionStorage.getItem("username")||"anonymous",gameStatus:this.gameStatus,depth:this.depth,turns:this.turns,seed:this.masterSeed}}addSocketEvents(){const e=(0,w.ensure)(document.querySelector("#stats"));this.socket&&this.socket.on("connect",(()=>{this.github.toggleButtons()})).on("disconnect",(()=>{this.github.toggleButtons(),e.classList.add("hidden")})).on("error",(()=>{this.github.toggleButtons(),e.classList.add("hidden")})).on("status",(()=>{var e;null===(e=this.socket)||void 0===e||e.emit("score",this.getStats())})).on("stats",(t=>{const{currentPlayers:s,live:i,top:o}=t;e.classList.remove("hidden"),e.innerHTML=`Players online: ${s}`,Object.keys(o).length>0&&(e.innerHTML=`${e.innerHTML}\n----\nTop Scores:\n`,Object.keys(o).forEach((t=>{const{playerName:s,depth:i,turns:n,seed:r}=o[t];e.innerHTML=`${e.innerHTML} - ${s}, d: ${i}, t: ${n}, seed: ${r}\n`}))),Object.keys(i).length>0&&(e.innerHTML=`${e.innerHTML}\n----\nLive Scores:\n`,Object.keys(i).forEach((t=>{const{playerName:s,depth:o,turns:n,gameStatus:r,seed:a}=i[t];e.innerHTML=`${e.innerHTML} - ${s}, d: ${o}, t: ${n}, seed: ${a}, ${O[r]}\n`})))}))}setScale(e){this.fontSize=(0,w.float2int)(e),this.ctx.canvas.width=80*e,this.ctx.canvas.height=60*e}handleZoomKeys(e){"ZOOM_IN"===e?(this.fontSize++,this.setScale(this.fontSize)):"ZOOM_OUT"===e&&(this.fontSize--,this.setScale(this.fontSize))}fitCanvasToScreen(){const{width:e,height:s}=window.visualViewport,i=80/60,o=e/s,n=(0,w.float2int)(e/960*12),r=(0,w.float2int)(s/720*12);t.game.gameStatus===O.MAINMENU?(t.game.setScale(o<i?n:r),t.game.renderStartMenu()):t.game.gameStatus===O.NEWGAME||(t.game.setScale(o<i?n:r),t.game.render())}term(){return r(this,void 0,void 0,(function*(){this.log=new T.default,this.actors=[],this.map=new d.default(this.mapx,this.mapy),this.player=void 0,this.ctx=(0,w.ensure)(this.canvas.getContext("2d")),this.ctx.textAlign="center"}))}init(e,t=!0){var s,i,o,n,a,d,u,m,T,E,k,S,x;return r(this,void 0,void 0,(function*(){if((0,w.ensure)(this.map).generate(e,this.masterSeed,this.depth),e){let e=0;if(t){e=this.actors.push(new y.default(2,2,"@","placeholder hero",b.Colors.HERO))-1,this.player=this.actors[e],this.player.destructible=new _.PlayerDestructible(30,10,"your cadaver"),this.player.attacker=new g.default("1d4","1d1"),this.player.ai=new v.PlayerAI,this.player.abilities=new p.Abilities(18,15,10,8,12),this.player.container=new c.default(26),this.player.equipments=new l.default,this.player.fov=new f.default(this.mapx,this.mapy);const t=(0,h.createItem)({name:"leather armor",x:(0,w.ensure)(this.player).x,y:(0,w.ensure)(this.player).y}),r=(0,h.createItem)({name:"hide",x:(0,w.ensure)(this.player).x,y:(0,w.ensure)(this.player).y}),x=(0,h.createItem)({name:"handaxe",x:(0,w.ensure)(this.player).x,y:(0,w.ensure)(this.player).y}),C=(0,h.createItem)({name:"light crossbow",x:(0,w.ensure)(this.player).x,y:(0,w.ensure)(this.player).y}),A=(0,h.createItem)({name:"shortbow",x:(0,w.ensure)(this.player).x,y:(0,w.ensure)(this.player).y}),O=(0,h.createItem)({name:"club",x:(0,w.ensure)(this.player).x,y:(0,w.ensure)(this.player).y});null===(i=null===(s=this.player)||void 0===s?void 0:s.container)||void 0===i||i.add(t),null===(n=null===(o=this.player)||void 0===o?void 0:o.container)||void 0===n||n.add(r),null===(d=null===(a=this.player)||void 0===a?void 0:a.container)||void 0===d||d.add(x),null===(m=null===(u=this.player)||void 0===u?void 0:u.container)||void 0===m||m.add(C),null===(E=null===(T=this.player)||void 0===T?void 0:T.container)||void 0===E||E.add(A),null===(S=null===(k=this.player)||void 0===k?void 0:k.container)||void 0===S||S.add(O)}(0,w.ensure)(this.player).x=(0,w.ensure)(this.map).startX,(0,w.ensure)(this.player).y=(0,w.ensure)(this.map).startY,null===(x=(0,w.ensure)(this.player).fov)||void 0===x||x.fullClear(),e=this.actors.push(new y.default(0,0,">","stairs",b.Colors.STAIRS))-1,this.stairs=this.actors[e],this.stairs.blocks=!1,this.stairs.fovOnly=!1,this.stairs.x=(0,w.ensure)(this.map).stairsX,this.stairs.y=(0,w.ensure)(this.map).stairsY,this.sendToBack(this.stairs),this.log.add("Welcome stranger!"),this.log.add("Need help? Press '?'",b.Colors.HILIGHT_TEXT)}else this.log.add("Welcome back stranger!"),this.log.add("Need help? Press '?'",b.Colors.HILIGHT_TEXT);this.gameStatus=O.STARTUP}))}nextLevel(){return r(this,void 0,void 0,(function*(){this.depth++,this.log.add("You take steps down."),this.map=void 0,this.stairs=void 0;const e=this.player;this.actors=Array(),this.map=new d.default(this.mapx,this.mapy),this.init(!0,!1),this.actors.push(e),this.save()}))}newGame(){return r(this,void 0,void 0,(function*(){if(t.game.gameStatus=O.NEWGAME,this.masterSeed=parseInt(void 0)||(0,w.float2int)(134217727*Math.random()),window.location.search){const e=new URLSearchParams(window.location.search);e.has("seed")&&(this.masterSeed=parseInt((0,w.ensure)(e.get("seed"))))}history.pushState({},"Slan Roguelike",`/slanRl/?seed=${this.masterSeed}`);const[e,s,i,o,n,r,a]=yield(0,m.prepareNewJourney)();this.turns=0,this.depth=1,yield this.term(),yield this.init(!0,!0);const c=(0,w.ensure)(this.player);c.abilities=(0,w.ensure)(e),c.race=(0,w.ensure)(s),c.class=(0,w.ensure)(i),c.getProfiencies(),c.name=`${a}`;const l=e.getBonus(p.ABILITIES.CON),h=(0,w.ensure)(c.destructible);h.maxHP=o+l,h.hp=h.maxHP,h.hpPerLevel=n,h.hpPerLevelBonuses=r,yield this.save()}))}continueGame(){return r(this,void 0,void 0,(function*(){if(null!==window.localStorage.getItem("seed")){null===window.localStorage.getItem("version")&&window.localStorage.setItem("version","v0.0.1.22c"),this.masterSeed=parseInt((0,w.ensure)(window.localStorage.getItem("seed"))),this.depth=parseInt((0,w.ensure)(window.localStorage.getItem("depth"))),this.turns=parseInt((0,w.ensure)(window.localStorage.getItem("turns"))),yield this.init(!1);const e=JSON.parse(window.localStorage.getItem("actors")||"[]");for(const t of e){const e=this.actors.push(new y.default(t.x,t.y,t.ch,t.name,t.color))-1;if(t.fov&&(this.actors[e].fov=new f.default(this.mapx,this.mapy),(0,w.ensure)(this.actors[e].fov).mapped=t.fov.mapped),this.actors[e].emitLight=t.emitLight,t.container){this.actors[e].container=yield new c.default(26);for(const s of t.container.inventory){const t=(0,w.ensure)(this.actors[e].container).inventory.push(new y.default(s.x,s.y,s.ch,s.name,s.color))-1;(0,w.ensure)(this.actors[e].container).inventory[t]=(0,h.createItem)({name:s.name,x:s.x,y:s.y})}}if(t.equipments){this.actors[e].equipments=new l.default;for(const s of t.equipments.items)(0,w.ensure)(this.actors[e].equipments).add((0,h.createItem)({name:s.name,x:s.x,y:s.y}))}if(t.abilities){const s=t.abilities;this.actors[e].abilities=new p.Abilities(s.str,s.dex,s.con,s.int,s.wis)}if(t.attacker&&(this.actors[e].attacker=new g.default(t.attacker.power_melee,t.attacker.power_range),(0,w.ensure)(this.actors[e].attacker).rangeAttack_range=t.attacker.rangeAttack_range),t.pickable&&(t.armor||t.weapon?this.actors[e]=(0,h.createItem)({name:t.name,x:t.x,y:t.y}):this.actors[e].create(t)),"stairs"===t.name&&(this.stairs=this.actors[e],this.stairs.fovOnly=!1),"door"===t.name&&(this.actors[e].blocks=t.blocks,this.actors[e].fovOnly=t.fovOnly),t.destructible)if("player"===t.destructible.type){this.player=this.actors[e],this.actors[e].destructible=new _.PlayerDestructible(30,10,"player corpse"),this.actors[e].ai=new v.PlayerAI;const s=(0,w.ensure)(this.actors[e].destructible);s.xp=t.destructible.xp,s.hpPerLevel=t.destructible.hpPerLevel,s.hpPerLevelBonuses=t.destructible.hpPerLevelBonuses,s.hp=t.destructible.hp,s.maxHP=t.destructible.maxHP,s.defense=t.destructible.defense,s.corpseName=t.destructible.corpseName}else if("monster"===t.destructible.type){this.actors[e].destructible=new _.MonsterDestructible(1,1,"monster corpse",0);const s=(0,w.ensure)(this.actors[e].destructible);s.xp=t.destructible.xp,s.hp=t.destructible.hp,s.maxHP=t.destructible.maxHP,s.defense=t.destructible.defense,s.corpseName=t.destructible.corpseName,t.destructible.hp<=0&&(this.actors[e].blocks=!1),this.actors[e].ai=new v.MonsterAI}else{this.actors[e].destructible=new _.default(1,1,"broken barrel","",0);const s=(0,w.ensure)(this.actors[e].destructible);s.xp=t.destructible.xp,s.hp=t.destructible.hp,s.maxHP=t.destructible.maxHP,s.defense=t.destructible.defense,s.corpseName=t.destructible.corpseName}}}}))}renderStartMenu(){if(this.clear(),this.renderVersion(),this.menu){this.drawChar(">",this.width/2-12,10+this.menu.cursor,b.Colors.MENU_CURSOR);for(let e=0;e<this.menu.items.length;e++)this.drawText(this.menu.items[e].label,this.width/2-10,10+e)}}load(){return r(this,void 0,void 0,(function*(){"v0.0.1.22c"!==window.localStorage.getItem("version")&&window.localStorage.clear(),this.menu=new E.Menu,this.menu.clear(),window.localStorage.getItem("depth")&&this.menu.addItem(E.MenuItemCode.CONTINUE,"Continue"),this.menu.addItem(E.MenuItemCode.NEW_GAME,"New Game");let e=-1;for(;;){this.renderStartMenu();const t=(0,S.keyPress)("menu",yield this.getch());if("MOVE_DOWN"===t&&this.menu.cursor++,"MOVE_UP"===t&&this.menu.cursor--,"SELECT"===t){e=this.menu.items[this.menu.cursor].code;break}this.handleZoomKeys(t),this.menu.cursor=this.menu.cursor%this.menu.items.length,this.menu.cursor<0&&(this.menu.cursor=this.menu.items.length-1)}-1!=e&&(e===E.MenuItemCode.NEW_GAME&&(yield this.newGame()),e===E.MenuItemCode.CONTINUE&&(yield this.continueGame()))}))}save(){return r(this,void 0,void 0,(function*(){const e=(0,w.ensure)(this.player);(0,w.ensure)(e.destructible).isDead()?window.localStorage.clear():((0,w.ensure)(this.map).save(),window.localStorage.setItem("playerID",this.actors.indexOf(e).toString()),window.localStorage.setItem("turns",this.turns.toString()),window.localStorage.setItem("actors",JSON.stringify(this.actors)),window.localStorage.setItem("version","v0.0.1.22c")),this.socket&&this.socket.connected&&this.github.toggleButtons()}))}clear(e=b.Colors.BACKGROUND){this.ctx.fillStyle=e,this.ctx.fillRect(0,0,this.width*this.fontSize,this.height*this.fontSize),this.ctx.fillRect(0,this.height*this.fontSize,this.width*this.fontSize,this.canvas.height-this.height*this.fontSize)}saveImage(){const e=this.width,t=this.height,s=this.camera.x,i=this.camera.y,o=this.fontSize;this.width=this.mapx,this.height=this.mapy,(0,w.ensure)(document.querySelector("#temp-image")).classList.remove("hidden");const n=(0,w.ensure)(document.querySelector("#temp-image-canvas"));this.canvas=n,this.ctx=(0,w.ensure)(this.canvas.getContext("2d")),this.setScale(12),this.ctx.canvas.width=this.mapx*this.fontSize,this.ctx.canvas.height=this.mapy*this.fontSize,this.camera.x=0,this.camera.y=0,this.clear(),(0,w.ensure)(this.map).render();for(let e=0;e<this.actors.length;e++)this.actors[e].render();this.renderLighting(),this.canvas=(0,w.ensure)(document.getElementById("screen")),this.ctx=(0,w.ensure)(this.canvas.getContext("2d")),this.width=e,this.height=t,this.camera.x=s,this.camera.y=i,this.setScale(o),this.render()}drawChar(e,t,s,i=b.Colors.BACKGROUND){t<0||s<0||t>this.width||s>this.height||(this.ctx.textAlign="center",this.ctx.fillStyle=b.Colors.BACKGROUND,this.ctx.fillRect(t*this.fontSize-this.fontSize/2,s*this.fontSize,this.fontSize,this.fontSize),this.ctx.fillStyle=i,this.ctx.fillText(e,t*this.fontSize,s*this.fontSize+this.fontSize))}drawRectangle(e,t,s=b.Colors.BACKGROUND,i){if(e<0||t<0||e>this.width||t>this.height)return;let o=i.toString(16);0===o.length&&(o="00"),o.length<2&&(o="0"+o),this.ctx.textAlign="center",this.ctx.fillStyle=s+o,this.ctx.fillRect(e*this.fontSize-this.fontSize/2,t*this.fontSize,this.fontSize,this.fontSize),this.ctx.fillStyle="#FFFFFFFF"}drawText(e,t,s,i=b.Colors.DEFAULT_TEXT,o="left"){this.ctx.textAlign=o,this.ctx.font=`${this.fontSize}px system-ui`,this.ctx.fillStyle=b.Colors.BACKGROUND,this.ctx.fillStyle=i,this.ctx.fillText(e,t*this.fontSize,s*this.fontSize+this.fontSize)}run(){return r(this,void 0,void 0,(function*(){for((0,w.debugInit)(),this.fitCanvasToScreen();;)for(yield this.load(),yield this.gameloop(),yield this.save(),this.log.add("Press Esc to restart"),this.render();"ESCAPE"!==(0,S.keyPress)("game",yield this.getch()););}))}waitingKeypress(){return new Promise((e=>{const s=i=>r(this,void 0,void 0,(function*(){let o=!1;if((window.navigator.platform.match("Mac")?i.metaKey:i.ctrlKey)&&["s","l","o","r","p"].includes(i.key)){switch(i.key){case"s":case"o":case"p":i.preventDefault(),i.stopPropagation(),"s"===i.key&&(this.log.add("Game saved.",b.Colors.GAME_SAVED),yield this.save());break;case"r":case"l":return}o=!0}i.key&&!o&&(t.game.lastKey=i.key),document.removeEventListener("keydown",s),e()}));document.addEventListener("keydown",s)}))}getch(){return r(this,void 0,void 0,(function*(){yield this.waitingKeypress();const e=this.lastKey;return this.lastKey="",(0,w.ensure)(document.querySelector("#temp-image")).classList.remove("zoomed"),e}))}render(){this.clear(),(0,w.ensure)(this.map).render();for(let e=0;e<this.actors.length;e++)this.actors[e].render();this.renderLighting(),this.renderUI()}renderLighting(){var e,t,s,i,o,n,r;for(let a=0;a<this.mapy;a++)for(let c=0;c<this.mapx;c++){const l=c+this.camera.x,h=a+this.camera.y;if(l>0&&h>0&&l<this.width&&h<this.height&&2==(null===(t=null===(e=this.player)||void 0===e?void 0:e.fov)||void 0===t?void 0:t.getMapped(c,a))){const e=(0,w.ensure)(null===(i=null===(s=this.player)||void 0===s?void 0:s.fov)||void 0===i?void 0:i.getLight(c,a)),t=(0,w.rgbToHex)((0,w.float2int)(e.r),(0,w.float2int)(e.g),(0,w.float2int)(e.b)),d=(0,w.ensure)(null===(n=null===(o=this.player)||void 0===o?void 0:o.fov)||void 0===n?void 0:n.getAmbienceLight(c,a)),u=d>255?255:(0,w.float2int)(d);this.drawRectangle(l,h,t,64),this.drawRectangle(l,h,null===(r=this.map)||void 0===r?void 0:r.ambienceColor,(0,w.float2int)(.15*u))}}}renderUI(){var e,t,s,i,o,n,r,a,c,l,h,d;const u=(0,w.ensure)(this.player),f=(0,w.ensure)(null===(e=u.destructible)||void 0===e?void 0:e.hp),g=null===(t=u.destructible)||void 0===t?void 0:t.defense,m=null===(s=u.attacker)||void 0===s?void 0:s.power_melee,y=null===(i=u.attacker)||void 0===i?void 0:i.power_range,v=null===(o=u.attacker)||void 0===o?void 0:o.rangeAttack_range,_=(0,w.ensure)(null===(n=u.destructible)||void 0===n?void 0:n.maxHP),T=(0,w.ensure)(this.map).depth,E=(0,w.ensure)(this.turns),k=null===(r=u.destructible)||void 0===r?void 0:r.xp;this.drawText(`HP: ${f}/${_}`,1,this.height+1,f<_/100*10?b.Colors.HP_10_PERCENT:f<_/100*25?b.Colors.HP_25_PERCENT:f<_/100*50?b.Colors.HP_50_PERCENT:f<_/100*95?b.Colors.HP_95_PERCENT:b.Colors.HP_MAX),this.drawText(`AC: ${g}`,7,this.height+1),this.drawText(`ATT M: ${m}`,13,this.height+1),this.drawText(`ATT R: ${y}`,13,this.height+2),this.drawText(`Range: ${v}`,19,this.height+2),this.drawText(`Depth: ${T}`,this.width-6,this.height+1),this.drawText(`Turn: ${E}`,this.width-6,this.height+2),this.drawText(`EXP: ${k} / ${null===(a=u.ai)||void 0===a?void 0:a.getNextLevelXP()}`,1,this.height+2);const S=(0,C.getRaceNameByIndex)((0,w.ensure)(null===(c=this.player)||void 0===c?void 0:c.race)),A=(0,x.getClassNameByIndex)((0,w.ensure)(null===(l=this.player)||void 0===l?void 0:l.class));this.drawText(`${(0,w.capitalize)(null===(h=(0,w.ensure)(this.player))||void 0===h?void 0:h.name)} the ${S} ${A}`,60,this.height+1);const O=null===(d=this.player)||void 0===d?void 0:d.abilities;this.drawText(`STR: ${null==O?void 0:O.str} (${null==O?void 0:O.getBonusWithSign(p.ABILITIES.STR)})`,19,this.height+1),this.drawText(`DEX: ${null==O?void 0:O.dex} (${null==O?void 0:O.getBonusWithSign(p.ABILITIES.DEX)})`,27,this.height+1),this.drawText(`CON: ${null==O?void 0:O.con} (${null==O?void 0:O.getBonusWithSign(p.ABILITIES.CON)})`,35,this.height+1),this.drawText(`INT: ${null==O?void 0:O.int} (${null==O?void 0:O.getBonusWithSign(p.ABILITIES.INT)})`,43,this.height+1),this.drawText(`WIS: ${null==O?void 0:O.wis} (${null==O?void 0:O.getBonusWithSign(p.ABILITIES.WIS)})`,51,this.height+1),this.log.render(),this.renderVersion()}renderVersion(){this.drawText("Commit ID: 63d80f6 | Version: v0.0.1.22c",78,this.ctx.canvas.height/this.fontSize-3,b.Colors.VERSION,"right")}gameloop(){var e,t,s,i,o,n,a,c,l;return r(this,void 0,void 0,(function*(){for(;;){if(this.gameStatus===O.STARTUP&&(null===(e=this.player)||void 0===e||e.computeFov(),this.camera.compute((0,w.ensure)(null===(t=this.player)||void 0===t?void 0:t.x),(0,w.ensure)(null===(s=this.player)||void 0===s?void 0:s.y)),this.render()),this.gameStatus=O.IDLE,yield null===(i=this.player)||void 0===i?void 0:i.update((0,w.ensure)(null===(o=this.player.ai)||void 0===o?void 0:o.movingSpeed)),this.gameStatus===O.NEW_TURN){for(const e of this.actors)e!==this.player&&(yield e.update((0,w.ensure)(null===(a=null===(n=this.player)||void 0===n?void 0:n.ai)||void 0===a?void 0:a.movingSpeed)));this.turns++}if(this.render(),this.gameStatus===O.DEFEAT){this.drawText("DEFEAT!",this.width/2-3,this.height/2,b.Colors.DEFEAT),this.socket&&this.socket.emit("dead",this.getStats()),this.log.add("DEFEAT",b.Colors.DEFEAT),null===(l=null===(c=this.player)||void 0===c?void 0:c.fov)||void 0===l||l.showAll(),this.saveImage(),setTimeout((()=>{(0,w.ensure)(document.querySelector("#temp-image")).classList.add("zoomed")}),1e3);break}}}))}removeActor(e){this.actors=this.actors.filter((t=>t!==e))}sendToBack(e){this.removeActor(e),this.actors.unshift(e)}getClosestMonster(e,t,s){let i=1e5;return this.actors.reduce(((o,n)=>{if(n!=this.player&&n.destructible&&!n.destructible.isDead()){const o=n.getDistance(e,t);if(o<i&&(o<=s||0==s))return i=o,n}return o}),void 0)}getActor(e,t){return this.actors.find((s=>s.x===e&&s.y===t&&s.destructible&&!s.destructible.isDead()))||null}getAnyActor(e,t){return this.actors.find((s=>s.x===e&&s.y===t))||null}getAllActors(e,t){return this.actors.filter((s=>s.x===e&&s.y===t))}getActorsInSphere(e,t,s,i){return this.actors.filter((o=>o!==i&&o.destructible&&!o.destructible.isDead()&&o.getDistance(e,t)<=s))}getActorsInCube(e,t,s,i){return this.actors.filter((o=>o!==i&&o.destructible&&!o.destructible.isDead()&&o.x>=e-s&&o.x<=e+s&&o.y>=t-s&&o.y<=t+s))}pickATile(e,t,s=0){var i,o;return r(this,void 0,void 0,(function*(){let n=e,r=t,a=!1;for(;;){this.render(),(null===(o=null===(i=this.player)||void 0===i?void 0:i.fov)||void 0===o?void 0:o.isInFov(n,r))&&(0==s||this.player.getDistance(n,r)<=s)?(this.drawChar("+",n+this.camera.x,r+this.camera.y,b.Colors.ALLOWED),a=!0):(this.drawChar("+",n+this.camera.x,r+this.camera.y,b.Colors.DISALLOWED),a=!1);const e=(0,S.keyPress)("game",yield this.getch());if("MOVE_LEFT"===e&&n--,"MOVE_RIGHT"===e&&n++,"MOVE_UP"===e&&r--,"MOVE_DOWN"===e&&r++,"MOVE_UP_LEFT"===e&&(n--,r--),"MOVE_UP_RIGHT"===e&&(n++,r--),"MOVE_DOWN_LEFT"===e&&(n--,r++),"MOVE_DOWN_RIGHT"===e&&(n++,r++),"ESCAPE"===e)break;if("SELECT"===e&&a)return[!0,n,r]}return[!1,n,r]}))}renderMenuBackground({title:e,x:t,y:s,w:i,h:o}){for(let e=0;e<o;e++)for(let n=0;n<i;n++)(0===e||e===o-1)&&n>0&&n<i-1?this.drawChar("-",n+t,e+s,b.Colors.MENU_BORDER):(0===n||n===i-1)&&e>0&&e<o-1?this.drawChar("|",n+t,e+s,b.Colors.MENU_BORDER):0===e||0===n||e===o-1||n===i-1?this.drawChar("+",n+t,e+s,b.Colors.MENU_BORDER):this.drawChar(" ",n+t,e+s,b.Colors.MENU_BORDER);for(let o=0;o<e.length;o++)this.drawChar(e.charAt(o),t+i/2-e.length/2+o,s,b.Colors.DEFAULT_TEXT)}}t.Game=I,t.game=new I,t.game.run()},7801:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=s(3607),o=s(9524),n=s(6889),r=s(4692),a=s(5928);t.default=class{constructor(e){this.size=e,this.inventory=[]}add(e){return!(this.size>0&&this.inventory.length>=this.size||(this.inventory.push(e),0))}remove(e){for(let t=0;t<this.inventory.length;t++)if(this.inventory[t]===e)return void this.inventory.splice(t,1)}render(e){var t,s,c,l;i.game.renderMenuBackground({title:e,x:15,y:4,w:45,h:30});let h="a",d=0;for(const e of this.inventory){i.game.drawText(`${h} ) ${(0,a.capitalize)(e.name)}`,16,6+d);const u=(0,a.ensure)(e.pickable).weight;i.game.drawText(`${u} lb`,54,6+d),h=String.fromCharCode(h.charCodeAt(0)+1);let f="";if(e.armor&&(e.armor.armorType===n.ArmorType.SHIELD&&(f=`AC: ${e.armor.armorClass}, shield`),e.armor.armorType===n.ArmorType.LIGHT_ARMOR&&(f=`AC: ${e.armor.armorClass}, light armor`),e.armor.armorType===n.ArmorType.MEDIUM_ARMOR&&(f=`AC: ${e.armor.armorClass}, medium armor`),e.armor.armorType===n.ArmorType.HEAVY_ARMOR&&(f=`AC: ${e.armor.armorClass}, heavy armor`)),e.weapon&&(e.weapon.damageType===r.DamageType.BLUDGEONING&&(f=`damage: ${e.weapon.damage}, bludgeoning`),e.weapon.damageType===r.DamageType.PIERCING&&(f=`damage: ${e.weapon.damage}, piercing`),e.weapon.damageType===r.DamageType.SLASHING&&(f=`damage: ${e.weapon.damage}, slashing`)),null===(t=e.pickable)||void 0===t?void 0:t.effect){let t="";"HealthEffect"===e.pickable.effectName&&(t=e.pickable.effect.amount>0?`healing: ${Math.abs(e.pickable.effect.amount)}`:`damage: ${Math.abs(e.pickable.effect.amount)}`),"AiChangeEffect"===e.pickable.effectName&&(t=`confused ${e.pickable.effect.newAi.nbTurns} turns`),"scroll of map"===e.name&&(t="Reveal current map"),f+=`${t}`,(null===(s=e.pickable)||void 0===s?void 0:s.selector)&&(f+=", ")}if(null===(c=e.pickable)||void 0===c?void 0:c.selector){let t="";const s=e.pickable.selector.range;e.pickable.selector.type===o.SelectorType.CLOSEST_MONSTER&&(t="closest enemy"),e.pickable.selector.type===o.SelectorType.SELECTED_MONSTER&&(t="selected monster"),e.pickable.selector.type===o.SelectorType.SELECTED_RANGE&&(t="selected range"),e.pickable.selector.type===o.SelectorType.WEARER_RANGE&&(t="wearer range"),f+=`${t}, range: ${s}`}(null===(l=e.pickable)||void 0===l?void 0:l.effect)&&"Wearable"===e.pickable.effectName&&(e.pickable.effect.type===o.WearableType.ONEHANDED_WEAPON&&(f+=", one-handed"),e.pickable.effect.type===o.WearableType.TWOHANDED_WEAPON&&(f+=", two-handed"),e.pickable.effect.type===o.WearableType.SHIELD&&(f+=", shield"),e.pickable.effect.type===o.WearableType.ARMOR&&(f+=", armor")),i.game.drawText(`${(0,a.capitalize)(f)}`,30,6+d),d++}}}},8927:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=s(3607),o=s(9524),n=s(5928);t.default=class{constructor(){this.items=[]}add(e){return this.items.push(e),!0}takeOff(e){var t,s;for(let i=0;i<this.items.length;i++)if((null===(t=this.items[i].pickable)||void 0===t?void 0:t.effect)&&(null===(s=this.items[i].pickable)||void 0===s?void 0:s.effect.type)===e)return this.items.splice(i,1)[0]}thisTypeIsWeared(e){var t,s;for(let i=0;i<this.items.length;i++)if((null===(t=this.items[i].pickable)||void 0===t?void 0:t.effect)&&(null===(s=this.items[i].pickable)||void 0===s?void 0:s.effect.type)===e)return this.items[i]}getRangeWeapon(){var e,t;for(let s=0;s<this.items.length;s++)if((null===(e=this.items[s].pickable)||void 0===e?void 0:e.effect)&&(null===(t=this.items[s].pickable)||void 0===t?void 0:t.effect.type)===o.WearableType.RANGED_WEAPON)return this.items[s]}getMeleeWeapon(){var e,t,s;for(let i=0;i<this.items.length;i++)if((null===(e=this.items[i].pickable)||void 0===e?void 0:e.effect)&&((null===(t=this.items[i].pickable)||void 0===t?void 0:t.effect.type)===o.WearableType.ONEHANDED_WEAPON||(null===(s=this.items[i].pickable)||void 0===s?void 0:s.effect.type)===o.WearableType.TWOHANDED_WEAPON))return this.items[i]}getAC(){let e=0;for(const t of this.items)t.armor&&(e+=t.armor.armorClass);return e}getMeleePower(){let e="1d3";for(const t of this.items)t.weapon&&t.pickable&&(t.pickable.effect.type===o.WearableType.ONEHANDED_WEAPON||t.pickable.effect.type===o.WearableType.TWOHANDED_WEAPON)&&(e=t.weapon.damage);return e}getRangePower(){let e="1d3";for(const t of this.items)t.weapon&&t.pickable&&t.pickable.effect.type===o.WearableType.RANGED_WEAPON&&(e=t.weapon.damage);return e}update(e){var t,s;e.destructible&&((0,n.ensure)(null==e?void 0:e.destructible).defense=this.getAC(),(0,n.ensure)(e.attacker).power_melee=this.getMeleePower(),(0,n.ensure)(e.attacker).power_range=this.getRangePower(),this.getRangeWeapon()&&((0,n.ensure)(e.attacker).rangeAttack_range=(0,n.ensure)(null===(s=null===(t=this.getRangeWeapon())||void 0===t?void 0:t.weapon)||void 0===s?void 0:s.rangeMax)))}render(){var e,t;i.game.renderMenuBackground({title:"EQUIPS",x:59,y:4,w:10,h:30});let s=0;if(i.game.player&&i.game.player.equipments&&(null===(e=i.game.player.equipments)||void 0===e?void 0:e.items.length)>0)for(const e of(0,n.ensure)(null===(t=i.game.player.equipments)||void 0===t?void 0:t.items))i.game.drawText((0,n.capitalize)(e.name),60,6+s),s++}}},6382:function(e,t,s){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,s,i){void 0===i&&(i=s),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[s]}})}:function(e,t,s,i){void 0===i&&(i=s),e[i]=t[s]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&i(t,e,s);return o(t,e),t},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createItem=t.items=t.weapons=t.armors=void 0;const a=r(s(8260)),c=r(s(886)),l=r(s(1391)),h=r(s(1204)),d=n(s(9524)),u=n(s(6889)),f=n(s(4692)),p=r(s(808)),g=s(792),m=s(5928),y=s(7409);t.armors=c.default,t.weapons=h.default,t.items=l.default,t.createItem=e=>{let s,i,o,n="?",r=a.default.default_item,c=!1,l=!1,h=u.ArmorType.LIGHT_ARMOR;if((e=>!!t.weapons.find((t=>t.name===e)))(e.name)){const i=(0,m.ensure)((e=>t.weapons.find((t=>t.name===e)))(e.name));let a=f.DamageType.BLUDGEONING,l=d.WearableType.ONEHANDED_WEAPON;"bludgeoning"===i.damageType&&(a=f.DamageType.BLUDGEONING),"slashing"===i.damageType&&(a=f.DamageType.SLASHING),"piercing"===i.damageType&&(a=f.DamageType.PIERCING),"one-handed"===i.wearableType&&(l=d.WearableType.ONEHANDED_WEAPON,n="f"),"two-handed"===i.wearableType&&(l=d.WearableType.TWOHANDED_WEAPON,n="F"),"ranged"===i.wearableType&&(l=d.WearableType.RANGED_WEAPON,n="€"),o=new f.default({name:e.name,damage:null==i?void 0:i.damage,damageType:a,rangeMax:i.rangeMax,needReload:"loading"===i.special}),r=y.Colors.WEAPON_ITEM,c=!1,s=new d.default({selector:void 0,effect:new d.Wearable(l),weight:i.weight})}else if((e=>!!t.armors.find((t=>t.name===e)))(e.name)){const o=(0,m.ensure)((e=>t.armors.find((t=>t.name===e)))(e.name));"light"===o.armorType&&(h=u.ArmorType.LIGHT_ARMOR),"medium"===o.armorType&&(h=u.ArmorType.MEDIUM_ARMOR),"heavy"===o.armorType&&(h=u.ArmorType.HEAVY_ARMOR),"shield"===o.armorType&&(h=u.ArmorType.SHIELD),i=new u.default({name:e.name,ac:o.ac,armorClassAbilityType:h===u.ArmorType.HEAVY_ARMOR?"str":"dex",armorType:h,requirementStrenght:0}),n="L",r=y.Colors.ARMOR_ITEM,c=!1,s=new d.default({selector:void 0,effect:new d.Wearable(h===u.ArmorType.SHIELD?d.WearableType.SHIELD:d.WearableType.ARMOR),weight:o.weight})}else if((e=>!!t.items.find((t=>t.name===e)))(e.name)){const i=(0,m.ensure)((e=>t.items.find((t=>t.name===e)))(e.name));let o,a;n=i.ch,r=i.color,l=i.emitLight,c=!1,"selected range"===i.selector.type&&(o=new d.TargetSelector(d.SelectorType.SELECTED_RANGE,i.selector.range)),"selected monster"===i.selector.type&&(o=new d.TargetSelector(d.SelectorType.SELECTED_MONSTER,i.selector.range)),"closest monster"===i.selector.type&&(o=new d.TargetSelector(d.SelectorType.CLOSEST_MONSTER,i.selector.range)),"health"===i.effect.type&&(a=new d.HealthEffect(i.effect.amount,i.message)),"map clear"===i.effect.type&&(a=new d.MapClearEffect(i.message)),"change ai"===i.effect.type&&(a=new d.AiChangeEffect(new g.ConfusedMonsterAi(i.effect.amount),i.message)),s=new d.default({selector:o,effect:a,weight:i.weight})}else console.error(`${name} not found.`);const v=new p.default(e.x,e.y,n,e.name,r);return v.blocks=c,v.pickable=s,v.armor=i,v.weapon=o,v.emitLight=l,v}},9524:function(e,t,s){"use strict";var i=this&&this.__awaiter||function(e,t,s,i){return new(s||(s=Promise))((function(o,n){function r(e){try{c(i.next(e))}catch(e){n(e)}}function a(e){try{c(i.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,a)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.AiChangeEffect=t.HealthEffect=t.Wearable=t.WearableType=t.MapClearEffect=t.TargetSelector=t.SelectorType=void 0;const o=s(3607),n=s(5928),r=s(7409);var a,c;!function(e){e[e.NONE=0]="NONE",e[e.CLOSEST_MONSTER=1]="CLOSEST_MONSTER",e[e.SELECTED_MONSTER=2]="SELECTED_MONSTER",e[e.WEARER_RANGE=3]="WEARER_RANGE",e[e.SELECTED_RANGE=4]="SELECTED_RANGE"}(a=t.SelectorType||(t.SelectorType={})),t.TargetSelector=class{constructor(e,t){this.type=e,this.range=t}selectTargets(e,t){return i(this,void 0,void 0,(function*(){const s=()=>i(this,void 0,void 0,(function*(){const[s,i,n]=yield o.game.pickATile(e.x,e.y);if(void 0===s||!1===s)return;const r=o.game.getActor(i,n);r&&r.destructible&&!r.destructible.isDead()&&r.getDistance(i,n)<=this.range&&t.push(r)})),n=()=>{const s=o.game.getClosestMonster(e.x,e.y,this.range);s&&t.push(s)},r=()=>i(this,void 0,void 0,(function*(){const[s,i,n]=yield o.game.pickATile(e.x,e.y);if(!1===s)return;const r=o.game.getActor(i,n);r&&t.push(r)})),c=()=>{for(const s of o.game.actors)s!=e&&s.destructible&&!s.destructible.isDead()&&s.getDistance(e.x,e.y)<=this.range&&t.push(s)};switch(this.type){case a.CLOSEST_MONSTER:n();break;case a.SELECTED_MONSTER:yield r();break;case a.WEARER_RANGE:c();break;case a.SELECTED_RANGE:yield s();break;default:console.error(`Error with selectorType: ${this.type}`)}0===t.length&&o.game.log.add("No enemy is close enough.")}))}},t.MapClearEffect=class{constructor(e){this.message=e}applyTo(e){var t,s,i;return(0,n.ensure)(e),null===(s=null===(t=o.game.player)||void 0===t?void 0:t.fov)||void 0===s||s.showAll(),null===(i=o.game.player)||void 0===i||i.computeFov(),!0}},(c=t.WearableType||(t.WearableType={}))[c.ARMOR=0]="ARMOR",c[c.SHIELD=1]="SHIELD",c[c.ONEHANDED_WEAPON=2]="ONEHANDED_WEAPON",c[c.TWOHANDED_WEAPON=3]="TWOHANDED_WEAPON",c[c.RANGED_WEAPON=4]="RANGED_WEAPON",t.Wearable=class{constructor(e){this.type=e}applyTo(e){return(0,n.ensure)(e),console.log("apply to:"+e.name),!1}},t.HealthEffect=class{constructor(e,t){this.amount=0,this.amount=e,this.message=t}applyTo(e){if(!e||!e.destructible)return!1;if(this.amount>0){if(e.destructible.heal(this.amount)>0)return this.message&&o.game.log.add(this.message,r.Colors.HEALED),!0}else if(this.message&&-this.amount-e.destructible.defense>0&&o.game.log.add(this.message),e.destructible.takeDamage(e,-this.amount)>0)return!0;return!1}},t.AiChangeEffect=class{constructor(e,t){this.message=t,this.newAi=e}applyTo(e){return this.newAi.applyTo(e),this.message&&o.game.log.add(this.message),!0}},t.default=class{constructor(e){this.selector=null==e?void 0:e.selector,this.effect=null==e?void 0:e.effect,this.weight=null==e?void 0:e.weight,void 0!==this.selector&&(this.selectorName=this.selector.constructor.name),void 0!==this.effect&&(this.effectName=this.effect.constructor.name)}pick(e,t){return!(!t.container||!t.container.add(e)||(o.game.removeActor(e),0))}use(e,t){var s;return i(this,void 0,void 0,(function*(){o.game.log.add(`You use a ${e.name}.`);const i=Array();this.selector?yield this.selector.selectTargets(t,i):i.push(t);let n=!1;for(const e of i)console.log("actor:",e),(null===(s=this.effect)||void 0===s?void 0:s.applyTo(e))&&(n=!0);return n&&t.container&&t.container.remove(e),n}))}drop(e,t){t.container&&(t.container.remove(e),o.game.actors.push(e),o.game.sendToBack(e),e.x=t.x,e.y=t.y,o.game.log.add(`${t.name} drops a ${e.name}.`))}wear(e,t){if((e.armor||e.weapon)&&t.container&&t.equipments&&e.pickable){t.container.remove(e);const s=t.equipments.takeOff(e.pickable.effect.type);t.container&&s&&(o.game.log.add(`${t.name} removes a ${s.name}.`),t.container.add(s)),t.equipments.add(e),o.game.log.add(`${t.name} wears a ${e.name}.`),t.equipments.update(t)}}}},8924:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.keyBindingsForHelp=t.keyPress=t.keyBindings=t.KeyBindingPhases=void 0,t.KeyBindingPhases=["menu","game"],t.keyBindings={MOVE_UP:{keys:["ArrowUp","w"],description:"Move up",showInHelp:!1,phases:"all"},MOVE_UP_RIGHT:{keys:["e"],description:"Move up right",showInHelp:!1,phases:"all"},MOVE_RIGHT:{keys:["ArrowRight","d"],description:"Move right",showInHelp:!1,phases:"all"},MOVE_DOWN_RIGHT:{keys:["c"],description:"Move down right",showInHelp:!1,phases:"all"},MOVE_DOWN:{keys:["ArrowDown","s"],description:"Move down",showInHelp:!1,phases:"all"},MOVE_DOWN_LEFT:{keys:["z"],description:"Move down left",showInHelp:!1,phases:"all"},MOVE_LEFT:{keys:["ArrowLeft","a"],description:"Move left",showInHelp:!1,phases:"all"},MOVE_UP_LEFT:{keys:["q"],description:"Move up left",showInHelp:!1,phases:"all"},AIM:{keys:["A"],description:"Aim",showInHelp:!0,phases:["game"]},SPELL:{keys:["r"],description:"Spell",showInHelp:!0,phases:["game"]},PICK:{keys:["g"],description:"Pick up an item",showInHelp:!0,phases:["game"]},INVENTORY:{keys:["i"],description:"Use item",showInHelp:!0,phases:["game"]},DROP:{keys:["D"],description:"Drop item from inventory",showInHelp:!0,phases:["game"]},GO_DOWN:{keys:[">"],description:"Go Down",showInHelp:!0,phases:["game"]},LOOK_CONTAINER:{keys:["l"],description:"Look to container",showInHelp:!0,phases:["game"]},LOOK_CONTAINERS:{keys:["L"],description:"Look to container in one direction",showInHelp:!0,phases:["game"]},OPEN_DOORS:{keys:["o"],description:"Open or close door close to you",showInHelp:!0,phases:["game"]},OPEN_DOOR:{keys:["O"],description:"Open or close door in one direction",showInHelp:!0,phases:["game"]},WEAR_EQUIP:{keys:["W"],description:"Wear/equip",showInHelp:!0,phases:["game"]},PUSH:{keys:["p"],description:"Push",showInHelp:!0,phases:["game"]},PULL:{keys:["P"],description:"Pull",showInHelp:!0,phases:["game"]},REST:{keys:[".","x"],description:"Rest / skip turn",showInHelp:!0,phases:["game"]},ESCAPE:{keys:["Escape"],description:"Escape",showInHelp:!1,phases:"all"},SELECT:{keys:["Enter"],description:"Select",showInHelp:!1,phases:"all"},BACK:{keys:["Backspace"],description:"Back",showInHelp:!1,phases:["menu"]},ZOOM_IN:{keys:["+"],description:"Zoom in",showInHelp:!1,phases:["game"]},ZOOM_OUT:{keys:["-"],description:"Zoom out",showInHelp:!1,phases:["game"]},HELP:{keys:["?"],description:"Show help",showInHelp:!1,phases:["game"]},FOV:{keys:["f"],description:"FOV",showInHelp:!1,phases:[]},SAVE:{keys:["S"],description:"Save",showInHelp:!1,phases:"all"}},t.keyPress=(e,s)=>{const i=Object.values(t.keyBindings).filter((({phases:t})=>"all"===t||t.includes(e))).find((({keys:e})=>e.includes(s))),o=Object.keys(t.keyBindings).find((e=>t.keyBindings[e]===i));return o||console.log(`phase ${e}, pressedKey ${s}, keyBinding ${o} = ${JSON.stringify(i,null,2)}`),o||s},t.keyBindingsForHelp=()=>Object.values(t.keyBindings).filter((({showInHelp:e})=>!!e))},10:function(e,t,s){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=i(s(9705)),n=s(5928),r=i(s(9451)),a=i(s(6357)),c=new r.default;t.default=class{constructor(e,t,s,i,o=5){this.maxLevel=o,this.rootContainer=new a.default(e+1,t+1,s-2,i-2),this.rows=i,this.cols=s,this.map=[],this.doorPlaces=[],this.tempRooms=[];for(let e=0;e<this.rows;e++)for(let t=0;t<this.cols;t++){const s=this.cols*e+t;this.map[s]=1}this.tree=this.Devide(this.rootContainer,0),this.rooms=this.tree.GetLeafs(),this.CreateRooms(),this.ConnectRooms(this.tree)}RandomSplit(e){let t,s,i=!c.getInt(0,1);if(i=e.w>e.h&&e.w/e.h>=.05,i){const i=c.getInt(.3*e.w,.6*e.w);t=new a.default(e.x,e.y,i,e.h),s=new a.default(e.x+i,e.y,e.w-i,e.h)}else{const i=c.getInt(.3*e.h,.6*e.h);t=new a.default(e.x,e.y,e.w,i),s=new a.default(e.x,e.y+i,e.w,e.h-i)}return[t,s]}Devide(e,t){const s=new o.default(e);if(t<this.maxLevel){const i=this.RandomSplit(e);s.A=this.Devide(i[0],t+1),s.B=this.Devide(i[1],t+1)}return s}CreateRooms(){for(const e of this.rooms){const t=c.getInt(.5*e.w,.9*e.w),s=c.getInt(.5*e.h,.9*e.h),i=c.getInt(e.x,e.x+e.w-t),o=c.getInt(e.y,e.y+e.h-s),n=new a.default(i,o,i+t,o+s);this.tempRooms.push(n);for(let e=o;e<o+s;e++)for(let s=i;s<i+t;s++){const t=this.cols*e+s;this.map[t]=0}}}IsThereRoom(e,t){for(const s of this.tempRooms)if(e>=s.x&&t>=s.y&&e<=s.w&&t<=s.h)return!0;return!1}ConnectRooms(e){if(!e.A||!e.B)return!1;const t=(0,n.float2int)(e.A.leaf.GetCenterX()),s=(0,n.float2int)(e.A.leaf.GetCenterY()),i=(0,n.float2int)(e.B.leaf.GetCenterX()),o=(0,n.float2int)(e.B.leaf.GetCenterY());let r=!1,c=!1;for(let e=Math.min(t,i);e<=Math.max(t,i);e++){const t=this.cols*Math.max(s,o)+e;if(this.map[t]=0,r||!0!==this.IsThereRoom(e,Math.max(s,o))){if(!r&&!1===this.IsThereRoom(e,Math.max(s,o))&&!0===c){r=!0;const t=new a.default(e,Math.max(s,o),0,0);this.doorPlaces.push(t)}}else c=!0}r=!1;for(let e=Math.min(s,o);e<=Math.max(s,o);e++){const s=this.cols*e+Math.max(t,i);if(this.map[s]=0,r||!0!==this.IsThereRoom(Math.max(t,i),e)){if(!r&&!1===this.IsThereRoom(Math.max(t,i),e)&&!0===c){r=!0;const s=new a.default(Math.max(t,i),e,0,0);this.doorPlaces.push(s)}}else c=!0}this.ConnectRooms((0,n.ensure)(e.A)),this.ConnectRooms((0,n.ensure)(e.B))}}},9705:function(e,t,s){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=i(s(6357));class n extends o.default{constructor(e){super(e.x,e.y,e.w,e.h),this.A=void 0,this.B=void 0,this.leaf=e}GetLeafs(){return this.A&&this.B?[...this.A.GetLeafs(),...this.B.GetLeafs()]:[this.leaf]}}t.default=n},1084:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Camera=void 0,t.Camera=class{constructor(){this.centerX=0,this.centerY=0,this.x=0,this.y=0}setCenter(e,t){this.centerX=e/2,this.centerY=t/2}compute(e,t){this.x=this.centerX-e,this.y=this.centerY-t}}},1135:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LightingColor=void 0;const i=s(3607),o=s(5928);class n{constructor(e,t,s){this.r=0,this.g=0,this.b=0,this.r=e,this.g=t,this.b=s}}t.LightingColor=n,t.default=class{constructor(e,t){this.lightColor=[],this.width=e,this.height=t,this.mapped=new Array(this.width*this.height).fill(0),this.light=new Array(this.width*this.height).fill(0);for(let e=0;e<this.width*this.height;e++)this.lightColor.push(new n(0,0,0));this.lightPositions=[]}clear(){for(let e=0;e<this.width*this.height;e++)2===this.mapped[e]&&(this.mapped[e]=1,this.light[e]=128)}fullClear(){this.mapped=new Array(this.width*this.height).fill(0),this.light=new Array(this.width*this.height).fill(0)}showAll(){var e,t,s,n,r,a,c,l,h;this.mapped=new Array(this.width*this.height).fill(2);for(let d=1;d<this.height-1;d++)for(let u=1;u<this.width-1;u++)if(1==(null===(e=i.game.map)||void 0===e?void 0:e.isWall(u,d))){let e=0;if((null===(t=i.game.map)||void 0===t?void 0:t.isWall(u-1,d))&&e++,(null===(s=i.game.map)||void 0===s?void 0:s.isWall(u+1,d))&&e++,(null===(n=i.game.map)||void 0===n?void 0:n.isWall(u,d-1))&&e++,(null===(r=i.game.map)||void 0===r?void 0:r.isWall(u,d+1))&&e++,(null===(a=i.game.map)||void 0===a?void 0:a.isWall(u-1,d+1))&&e++,(null===(c=i.game.map)||void 0===c?void 0:c.isWall(u+1,d+1))&&e++,(null===(l=i.game.map)||void 0===l?void 0:l.isWall(u-1,d-1))&&e++,(null===(h=i.game.map)||void 0===h?void 0:h.isWall(u+1,d-1))&&e++,e>=8){const e=(0,o.float2int)(u)+(0,o.float2int)(d)*this.width;this.mapped[e]=0}}}computeLightSource(e){var t;let s=0,n=0,r=0,a=0;if(this.lightColor)for(let c=0;c<360;c++){s=Math.sin(c/3.1415*180),n=Math.cos(c/3.1415*180),r=e.x+.5,a=e.y+.5;const l=e.size;for(let c=1;c<l&&!(r<=0||r>=this.width||a<=0||a>=this.height);c++){const l=(0,o.float2int)((0,o.float2int)(r)+(0,o.float2int)(a)*this.width),h=1/(c+1);if(this.lightColor[l].r+=e.colorR*h*.02,this.lightColor[l].g+=e.colorG*h*.02,this.lightColor[l].b+=e.colorB*h*.02,this.lightColor[l].r>255&&(this.lightColor[l].r=255),this.lightColor[l].g>255&&(this.lightColor[l].g=255),this.lightColor[l].b>255&&(this.lightColor[l].b=255),this.lightColor[l].r>255&&(this.lightColor[l].r=255),this.lightColor[l].g>255&&(this.lightColor[l].g=255),this.lightColor[l].b>255&&(this.lightColor[l].b=255),null===(t=i.game.map)||void 0===t?void 0:t.isWall((0,o.float2int)(r),(0,o.float2int)(a))){this.lightColor[l].r=0,this.lightColor[l].g=0,this.lightColor[l].b=0;break}r+=s,a+=n}}}computeLights(){var e;let t=0;for(const e of i.game.actors)!0===e.emitLight&&t++;let s=!1;if(t!==this.lightPositions.length){this.lightPositions=[],s=!0;for(const e of i.game.actors){const[t,s,i]=(0,o.hexToRGB)(e.color);if(!0===e.emitLight){const o={x:e.x,y:e.y,colorR:t,colorG:s,colorB:i,size:e.fovLen};this.lightPositions.push(o)}}}let n=0;for(let e=0;e<i.game.actors.length;e++)if(!0===i.game.actors[e].emitLight){if(i.game.actors[e].x!==this.lightPositions[n].x||i.game.actors[e].y!==this.lightPositions[n].y){s=!0;break}n++}if(s){const[t,s,n]=(0,o.hexToRGB)((0,o.ensure)(null===(e=i.game.map)||void 0===e?void 0:e.ambienceColor));for(const e of this.lightColor)e.r=(0,o.float2int)(.1*t),e.g=(0,o.float2int)(.1*s),e.b=(0,o.float2int)(.1*n);for(const e of this.lightPositions)this.computeLightSource(e)}}compute(e,t,s){var n;this.clear();let r=0,a=0,c=0,l=0;this.mapped[e+t*this.width]=2,this.light[e+t*this.width]=0;for(let h=0;h<360;h++){r=Math.sin(h/3.1415*180),a=Math.cos(h/3.1415*180),c=e+.5,l=t+.5;let d=s/2;for(let e=0;e<s&&(c+=r,l+=a,!(c<=0||c>=this.width||l<=0||l>=this.height));e++){const t=(0,o.float2int)(c)+(0,o.float2int)(l)*this.width;if(this.mapped[t]=2,this.light[t]=(0,o.float2int)(e*(128/s)),this.light[t]<0&&(this.light[t]=0),this.light[t]>512&&(this.light[t]=512),!(null===(n=i.game.map)||void 0===n?void 0:n.canWalk((0,o.float2int)(c),(0,o.float2int)(l))))break;d=this.getLightValue((0,o.float2int)(c),(0,o.float2int)(l))/255,d<.1&&e>s/2&&(this.mapped[t]=0)}}}getMapped(e,t){return e>=0&&t>=0&&e<this.width&&t<this.height?this.mapped[e+t*this.width]:2}getAmbienceLight(e,t){return e>=0&&t>=0&&e<this.width&&t<this.height?this.light[e+t*this.width]:0}getLight(e,t){return e>=0&&t>=0&&e<this.width&&t<this.height?this.lightColor[e+t*this.width]:{r:0,g:0,b:0}}getLightValue(e,t){if(e>=0&&t>=0&&e<this.width&&t<this.height){const s=this.lightColor[e+t*this.width].r,i=this.lightColor[e+t*this.width].g,n=this.lightColor[e+t*this.width].b;return(0,o.float2int)((s+i+n)/3)}return 0}isInFov(e,t){return e>=0&&t>=0&&e<this.width&&t<this.height&&this.mapped[e+t*this.width]>1}}},7423:function(e,t,s){"use strict";var i=this&&this.__awaiter||function(e,t,s,i){return new(s||(s=Promise))((function(o,n){function r(e){try{c(i.next(e))}catch(e){n(e)}}function a(e){try{c(i.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,a)}c((i=i.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Directions=t.random=void 0;const n=s(3607),r=o(s(7801)),a=s(6382),c=o(s(10)),l=s(6557),h=s(6127),d=o(s(808)),u=o(s(7107)),f=s(5928),p=s(7409),g=o(s(9451)),m=o(s(6357));t.random=new g.default,t.Directions=["UP","UP_RIGHT","RIGHT","DOWN_RIGHT","DOWN","DOWN_LEFT","LEFT","UP_LEFT"];class y{constructor(){this.canWalk=!1,this.explored=!1,this.color="#000000",this.character="?"}}t.default=class{constructor(e,t){this.startX=0,this.startY=0,this.stairsX=0,this.stairsY=0,this.levelSeed=0,this.depth=0,this.ROOM_MAX_SIZE=5,this.ROOM_MIN_SIZE=4,this.MAX_ROOM_MONSTERS=3,this.MAX_ROOM_ITEMS=2,this.width=e,this.height=t,this.templateDoors=[],this.monsterRooms=[],this.noisemap=new Array(this.width*this.height).fill(0),this.tiles=new Array(this.width*this.height).fill(!1),this.ambienceColor="#AAAAAA"}save(){window.localStorage.setItem("seed",this.levelSeed.toString()),window.localStorage.setItem("depth",this.depth.toString())}isWall(e,t){if(e>=0&&e<=this.width&&t>=0&&t<=this.height){const s=e+t*this.width;return!this.tiles[s].canWalk}return!1}setWall(e,t){this.tiles[e+t*this.width].canWalk=!1}canWalk(e,t){if(this.isWall(e,t))return!1;for(const s of n.game.actors)if(s.x===e&&s.y===t&&s.blocks)return!1;return!0}addMonster(e,s){if(1===this.depth){const i=["bat","rat","jackal","lizard","kobold","giant rat"],o=["giant rat","orc","ghoul"];if(t.random.getInt(0,100)>5){const o=t.random.getInt(0,i.length);n.game.actors.push((0,h.createMonster)(i[o],e,s))}else{const i=t.random.getInt(0,o.length);n.game.actors.push((0,h.createMonster)(o[i],e,s))}}else if(2===this.depth){const i=["rat","jackal","lizard","kobold","kobold","giant rat"],o=["giant rat","orc","ghoul","troll"];if(t.random.getInt(0,100)>5){const o=t.random.getInt(0,i.length);n.game.actors.push((0,h.createMonster)(i[o],e,s))}else{const i=t.random.getInt(0,o.length);n.game.actors.push((0,h.createMonster)(o[i],e,s))}}else if(this.depth>=3){const i=["giant rat","jackal","kobold"],o=["giant rat","orc","ghoul","troll"];if(t.random.getInt(0,100)>15){const o=t.random.getInt(0,i.length);n.game.actors.push((0,h.createMonster)(i[o],e,s))}else{const i=t.random.getInt(0,o.length);n.game.actors.push((0,h.createMonster)(o[i],e,s))}}}pushTo(e,t,s,i){const o=[];for(const s of n.game.actors)s.x===e&&s.y===t&&(s.container||s.pickable||s.destructible&&s.destructible.isDead())&&o.push(s);for(const e of o){if(!this.canWalk(e.x+s,e.y+i)){n.game.log.add("Can't push");break}e.x+=s,e.y+=i}return o.length>0}pullTo(e,t,s,i){if(!this.canWalk(e+s,t+i))return n.game.log.add("Can't pull"),!1;const o=[];for(const r of n.game.actors)r.x===e-s&&r.y===t-i&&(r.container||r.pickable||r.destructible&&r.destructible.isDead())&&o.push(r);for(const e of o)e.x+=s,e.y+=i;return o.length,!0}actorsAroundPosition({x:e,y:t}){return{UP:n.game.getAllActors(e,t-1),UP_RIGHT:n.game.getAllActors(e+1,t-1),RIGHT:n.game.getAllActors(e+1,t),DOWN_RIGHT:n.game.getAllActors(e+1,t+1),DOWN:n.game.getAllActors(e,t+1),DOWN_LEFT:n.game.getAllActors(e-1,t+1),LEFT:n.game.getAllActors(e-1,t),UP_LEFT:n.game.getAllActors(e-1,t-1)}}filterActorsAroundPosition({x:e,y:t},{property:s,value:i}){const o=this.actorsAroundPosition({x:e,y:t});return Object.keys(o).map((e=>{var t;return null===(t=o[e])||void 0===t?void 0:t.filter((e=>s in e&&e[s]===i))})).flat().filter(f.isDefined)}filterClassesAroundPosition({x:e,y:t},s){const i=this.actorsAroundPosition({x:e,y:t});return Object.keys(i).map((e=>{var t;return null===(t=i[e])||void 0===t?void 0:t.filter((e=>e instanceof s))})).flat().filter(f.isDefined)}findDoor(e,t){const s=n.game.getAllActors(e,t),i=null==s?void 0:s.find((({name:e})=>"door"===e));if(!(((null==s?void 0:s.filter((({name:e})=>"door"!==e)))||[]).length>0))return i;n.game.log.add("There's something and it's blocking!")}findContainer(e,t){var s;return null===(s=n.game.getAllActors(e,t))||void 0===s?void 0:s.find((({attacker:e,container:t})=>!!t&&!e))}openContainer(e,t,s){return i(this,void 0,void 0,(function*(){const i=this.findContainer(t,s);return!!i&&(yield i.openAsContainer(e),!0)}))}openCloseDoor(e,t){const s=this.findDoor(e,t);return!!s&&(s.doorOpenOrClose(),!0)}isThereSecretDoor(e){return!!n.game.actors.find((t=>t.x>=e.x&&t.x<=e.x+e.w+2&&t.y>=e.y&&t.y<=e.y+e.h+2&&"#"===t.ch&&"door"===t.name))}addDoor(e,s,i){const o=new d.default(e,s,i?"D":"+","door",p.Colors.DOOR);o.blocks=!0,o.fovOnly=!1;let r=!1;1==this.isWall(e-1,s)&&1==this.isWall(e+1,s)&&(r=!0),1==this.isWall(e,s-1)&&1==this.isWall(e,s+1)&&(r=!0),r&&(n.game.actors.push(o),n.game.sendToBack(o),t.random.getInt(0,100)<20&&(o.ch="#",o.color=p.Colors.WALL))}addItemWithName(e,t,s){const i=(0,a.createItem)({name:e,x:t,y:s});if(i)return n.game.actors.push(i),i}additem(e,s){const i=t.random.getInt(0,100);let o;i<70?t.random.getInt(0,100)<95?o=(0,a.createItem)({name:"health potion",x:e,y:s}):(o=(0,a.createItem)({name:"nutella bun",x:e,y:s}),console.log("There is a faint smell of nutella in the air!")):o=i<80?(0,a.createItem)({name:"scroll of lighting bolt",x:e,y:s}):i<90?(0,a.createItem)({name:"scroll of fireball",x:e,y:s}):i<95?(0,a.createItem)({name:"scroll of confusion",x:e,y:s}):(0,a.createItem)({name:"scroll of map",x:e,y:s}),o&&(n.game.actors.push(o),n.game.sendToBack(o))}dig(e,s,i,o,n){if(e=(0,f.float2int)(e),i=(0,f.float2int)(i),s=(0,f.float2int)(s),i<e){const t=i;i=e,e=t}if((o=(0,f.float2int)(o))<s){const e=o;o=s,s=e}let r=!1;for(let a=e;a<=i;a++)for(let c=s;c<=o;c++){const l=a+c*this.width;if(0!=this.tiles[l].canWalk||!0!==r||e!==i&&s!==o||n&&a!==this.stairsX&&c!==this.stairsY&&this.templateDoors.push(new m.default(a,c,0,0)),r=this.tiles[l].canWalk,this.tiles[l].canWalk=!0,!r){const e=t.random.getInt(0,200);this.tiles[l].character=e<10?"'":e<15?"`":e<20?"´":".",this.tiles[l].color=p.Colors.WALL}}}addActors(e){let s=t.random.getInt(0,this.MAX_ROOM_MONSTERS);const i=e.x,o=e.x+e.w,n=e.y,r=e.y+e.h;for(;s>0;){const e=t.random.getInt(i,o),a=t.random.getInt(n,r);this.canWalk(e,a)&&this.addMonster(e,a),s--}}makeHugeRooms(e,t,s){const i=new m.default(e.x+1,e.y+1,e.w,e.h);i.w<=0&&(i.w=1),i.h<=0&&(i.h=1),i.x<=0&&(i.x=1),i.y<=0&&(i.y=1),this.createRoom(i.x,i.y,i.x+i.w-2,i.y+i.h-2,t),s||this.monsterRooms.push(new m.default(i.x,i.y,i.w-2,i.h-2))}makeRoomsWithCorridors(e,t,s){const i=e;i.w<=0&&(i.w=1),i.h<=0&&(i.h=1),i.x<=0&&(i.x=1),i.y<=0&&(i.y=1),this.createRoom(i.x,i.y,i.x+i.w-2,i.y+i.h-2,t),s||this.monsterRooms.push(new m.default(i.x,i.y,i.w-2,i.h-2))}createRoom(e,s,i,o,c){this.dig(e,s,i,o,c);const h=t.random.getInt(0,4);if(0===h){console.log("storage room");for(let h=s;h<=o;h++)for(let f=e;f<=i;f++)if((h===s||h===o||f===e||f===i)&&t.random.getInt(0,100)>95){const e=new d.default(f,h,"O","barrel","#ffaa00");e.container=new r.default(10),e.abilities=new l.Abilities(1,1,1,1,1),t.random.getInt(0,10)>5&&e.container.add((0,a.createItem)({name:"health potion",x:f,y:h})),t.random.getInt(0,10)>8&&e.container.add((0,a.createItem)({name:"nutella bun",x:f,y:h})),t.random.getInt(0,10)>7&&e.container.add((0,a.createItem)({name:"scroll of fireball",x:f,y:h})),t.random.getInt(0,10)>8&&e.container.add((0,a.createItem)({name:"scroll of confusion",x:f,y:h})),t.random.getInt(0,10)>8&&e.container.add((0,a.createItem)({name:"scroll of map",x:f,y:h})),t.random.getInt(0,10)>7&&e.container.add((0,a.createItem)({name:"scroll of lighting bolt",x:f,y:h})),e.destructible=new u.default(10,1,"broken barrel","",0),e.blocks=!0,c&&n.game.sendToBack(e)}}if(1===h&&i-e>6&&o-s>6){console.log("graveyard/tomb");for(let r=s;r<=o;r++)for(let a=e;a<=i;a++){const l=a+r*this.width;if(r>=s+1&&r<=o-1&&a>=e+1&&a<=i-1&&t.random.getInt(0,100)>20&&a%2==0&&r%3==0){if(c){const e=new d.default(a,r,"t","tombstone","#BBBBBB");e.blocks=!1,n.game.sendToBack(e)}t.random.getInt(0,100)>50&&(this.tiles[l+this.width].color=p.Colors.SCROLL_OF_MAP,this.tiles[l+this.width].character="U")}}}if(2===h&&i-e>4&&o-s>4){console.log("altar");for(let t=0;t<10;t+=2)for(let n=s+t;n<=o-t;n++)for(let r=e+t;r<=i-t;r++){const a=r+n*this.width;n!==s+t&&n!==o-t&&r!==e+t&&r!==i-t||(this.tiles[a].character=n===s+t||n===o-t?"-":r===e+t||r===i-t?"|":"+",this.tiles[a].color=p.Colors.WALL,(r===e+2&&n==s+2||r===i-2&&n==s+2||r===e+2&&n==o-2||r===i-2&&n==o-2)&&(this.tiles[a].character="#",this.tiles[a].canWalk=!1))}}}howManyWalls(e,t){if(e>0&&t>0&&e<this.width-1&&t<this.height-1){let s=0;return this.isWall(e-1,t)&&s++,this.isWall(e+1,t)&&s++,this.isWall(e,t-1)&&s++,this.isWall(e,t+1)&&s++,s}return 0}howManyWalls2(e,t){if(e>0&&t>0&&e<this.width-1&&t<this.height-1){let s=0;for(let i=e-1;i<=e+1;i++)for(let e=t-1;e<=t+1;e++)1===this.noisemap[i+e*this.width]&&s++;return s}return 0}fillWithWalls(){for(let e=0;e<this.height;e++)for(let t=0;t<this.width;t++){const s=t+e*this.width;this.tiles[s].canWalk=!1,this.tiles[s].color=p.Colors.WALL,this.tiles[s].character="#"}}generate(e,s,i){this.levelSeed=s,this.depth=i,t.random.setSeed(this.levelSeed+25*i);const o=t.random.getInt(4,8);console.log("seed: "+this.levelSeed),console.log("depth: "+this.depth),console.log("split level:"+o);const n=[];this.ambienceColor=p.Colors.AMBIENCE_COLOR[t.random.getInt(0,p.Colors.AMBIENCE_COLOR.length)],this.tiles=new Array(this.width*this.height).fill(!1);for(let e=0;e<this.width*this.height;e++)this.tiles[e]=new y;const r=new c.default(0,0,this.width,this.height,o),a=t.random.getInt(0,100)>70?1:2;console.log("option: "+a);let l=0,h=0;const d=t.random.getInt(0,r.rooms.length-1);let u=t.random.getInt(0,r.rooms.length-1);for(;u===d;)u=t.random.getInt(0,r.rooms.length-1);this.fillWithWalls();for(let s=0;s<r.rooms.length;s++){const i=r.rooms[s],o=s===d;1===a&&this.makeHugeRooms(i,e,o),2===a&&(i.w=t.random.getInt(this.ROOM_MIN_SIZE,i.w-2),i.h=t.random.getInt(this.ROOM_MIN_SIZE,i.h-2),i.x=t.random.getInt(i.x,i.x+i.w-i.w)+1,i.y=t.random.getInt(i.y,i.y+i.h-i.h)+1,this.makeRoomsWithCorridors(i,e,o)),s===d&&(this.startX=i.x+(0,f.float2int)(i.w/2),this.startY=i.y+(0,f.float2int)(i.h/2)),s===u&&(this.stairsX=(0,f.float2int)(i.x+i.w/2),this.stairsY=(0,f.float2int)(i.y+i.h/2)),1!==a&&2!==a||(s>0&&(n.push(new m.default(l,h,i.x+i.w/2,h)),n.push(new m.default(i.x+i.w/2,h,i.x+i.w/2,i.y+i.h/2))),l=i.x+i.w/2,h=i.y+i.h/2)}(o>5||1!==a)&&t.random.getInt(0,100)>30&&this.makeCaverns();for(let t=0;t<n.length;t++)this.dig(n[t].x,n[t].y,n[t].w,n[t].h,e);if(e){for(const e of this.monsterRooms)this.addActors(e);for(const e of this.templateDoors)this.addDoor(e.x,e.y,!0);for(const e of this.monsterRooms)this.createTorches(e)}}placeWallLogic(e,t){const s=this.howManyWalls2(e,t);if(this.isWall(e,t)){if(s>=4)return 1;if(s<2)return 0}else if(s>=5)return 1;return 0}makeCaverns(){const e=new Array(this.width*this.height).fill(0);if(t.random.getInt(0,100)>50){console.log("1");for(let e=0;e<this.height;e++)for(let s=0;s<this.width;s++)this.noisemap[s+e*this.width]=t.random.getInt(0,100)<40?1:0}else for(let e=0;e<this.height;e++)for(let t=0;t<this.width;t++)this.noisemap[t+e*this.width]=this.isWall(t,e)?1:0;const s=t.random.getInt(1,6);console.log("cavern iters: ",s);for(let t=0;t<s;t++){for(let t=1;t<this.height-1;t++)for(let s=1;s<this.width-1;s++)e[s+t*this.width]=this.placeWallLogic(s,t);for(let t=0;t<this.width*this.height;t++)this.noisemap[t]=e[t]}const i=t.random.getInt(0,100)>50;for(let e=1;e<this.height-1;e++)for(let t=1;t<this.width-1;t++)if(this.isWall(t,e)||i){const s=t+e*this.width;0===this.noisemap[s]?(this.tiles[s].canWalk=!0,this.tiles[s].character="."):(this.tiles[s].canWalk=!1,this.tiles[s].character="#")}}createTorches(e){if(e.w>=3||e.h>=3){const s=[];this.howManyWalls(e.x,e.y)>1&&s.push(this.addItemWithName("torch",e.x,e.y)),this.howManyWalls(e.x+e.w,e.y)>1&&s.push(this.addItemWithName("torch",e.x+e.w,e.y)),this.howManyWalls(e.x,e.y+e.h)>1&&s.push(this.addItemWithName("torch",e.x,e.y+e.h)),this.howManyWalls(e.x+e.w,e.y+e.h)>1&&s.push(this.addItemWithName("torch",e.x+e.w,e.y+e.h)),s.length>0&&this.isThereSecretDoor(e)&&((0,f.ensure)(s[t.random.getInt(0,s.length-1)]).ch="í")}}render(){var e,t;for(let s=0;s<this.height;s++)for(let i=0;i<this.width;i++){const o=i+n.game.camera.x,r=s+n.game.camera.y;if(o>0&&r>0&&o<n.game.width&&r<n.game.height){const a=this.tiles[i+s*this.width].character,c=this.tiles[i+s*this.width].color,l=null===(t=null===(e=n.game.player)||void 0===e?void 0:e.fov)||void 0===t?void 0:t.getMapped(i,s);2!==l&&1!==l||(2===l?n.game.drawChar(a,o,r,c):n.game.drawChar(a,o,r,p.Colors.WALL_DARK))}}}}},6557:(e,t)=>{"use strict";var s;Object.defineProperty(t,"__esModule",{value:!0}),t.Abilities=t.ABILITIES=void 0,function(e){e[e.STR=0]="STR",e[e.DEX=1]="DEX",e[e.CON=2]="CON",e[e.INT=3]="INT",e[e.WIS=4]="WIS"}(s=t.ABILITIES||(t.ABILITIES={})),t.Abilities=class{constructor(e,t,s,i,o){this.str=0,this.dex=0,this.con=0,this.int=0,this.wis=0,this.str=e,this.dex=t,this.con=s,this.int=i,this.wis=o}getBonus(e){let t=0;switch(e){case s.STR:t=this.str;break;case s.DEX:t=this.dex;break;case s.CON:t=this.con;break;case s.INT:t=this.int;break;case s.WIS:t=this.wis}return Math.floor((t-10)/2)}getBonusWithSign(e){const t=this.getBonus(e);return(t>=0?"+":"")+t.toString()}inRange(e){return e>0&&e<=18}}},6889:(e,t)=>{"use strict";var s;Object.defineProperty(t,"__esModule",{value:!0}),t.ArmorType=void 0,(s=t.ArmorType||(t.ArmorType={}))[s.LIGHT_ARMOR=0]="LIGHT_ARMOR",s[s.MEDIUM_ARMOR=1]="MEDIUM_ARMOR",s[s.HEAVY_ARMOR=2]="HEAVY_ARMOR",s[s.SHIELD=3]="SHIELD",t.default=class{constructor(e){this.name=e.name,this.armorClass=e.ac,this.armorClassAbilityType=e.armorClassAbilityType,this.armorType=e.armorType,this.armorRequirementStrenght=null==e?void 0:e.requirementStrenght}}},7529:function(e,t,s){"use strict";var i=this&&this.__awaiter||function(e,t,s,i){return new(s||(s=Promise))((function(o,n){function r(e){try{c(i.next(e))}catch(e){n(e)}}function a(e){try{c(i.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,a)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const o=s(3607),n=s(6557),r=s(4692),a=s(792),c=s(5928),l=s(7409);t.default=class{constructor(e,t){this.power_melee=e,this.power_range=t,this.rangeAttack_range=0}attack(e,t){return i(this,void 0,void 0,(function*(){this.meleeAttack(e,t)}))}attackPhase(e,t,s,i,n){var h;if(t.destructible&&!t.destructible.isDead()){const d=a.random.dice(1,20,0),u=(0,c.ensure)(e.abilities).getBonus(s);let f=!1;if(1===d)return void o.game.log.add(`${e.name} attacks ${t.name} and misses.`);if(20===d&&(f=!0,o.game.log.add(`${e.name} makes critical attack to ${t.name}!`,l.Colors.HILIGHT_TEXT)),d>=t.destructible.defense){const[s,d]=i.split("d");let p=1;const g=a.random.dice(p=!0===f?2*parseInt(s):parseInt(s),parseInt(d),0),m=d;o.game.log.add(`${e.name} attacks ${t.name} for ${g} hit points (${p}d${m}${u>0?"+":"-"}${Math.abs(u)}).`,e===o.game.player?l.Colors.PLAYER_ATTACK:l.Colors.ENEMY_ATTACK);let y=g+u;if(y<1&&(y=1),t.destructible.takeDamage(t,y),n===r.DamageType.BLUDGEONING&&!0===f){const s=e.getDistance(t.x,t.y),i=(0,c.float2int)((t.x-e.x)/s),n=(0,c.float2int)((t.y-e.y)/s);(null===(h=o.game.map)||void 0===h?void 0:h.canWalk(t.x+i,t.y+n))&&(t.x+=i,t.y+=n)}}else o.game.log.add(`${e.name} attacks ${t.name} and misses.`)}}rangeAttack(e,t,s){var r,a,h,d,u;return i(this,void 0,void 0,(function*(){const i=o.game.getActor(t,s),f=(0,c.float2int)(e.getDistance(t,s)),p=(t-e.x)/f,g=(s-e.y)/f;let m=e.x,y=e.y,v="-";Math.abs(p)<Math.abs(g)&&(v="|");for(let e=0;e<f+1;e++)yield(0,c.sleep)(100),m+=p,y+=g,o.game.render(),o.game.drawChar(v,(0,c.float2int)(m)+o.game.camera.x,(0,c.float2int)(y)+o.game.camera.y,l.Colors.HILIGHT_TEXT);o.game.render();const _=null===(h=null===(a=null===(r=e.equipments)||void 0===r?void 0:r.getRangeWeapon())||void 0===a?void 0:a.weapon)||void 0===h?void 0:h.damageType;i&&(null===(u=null===(d=o.game.player)||void 0===d?void 0:d.fov)||void 0===u?void 0:u.isInFov(t,s))&&this.attackPhase(e,i,n.ABILITIES.DEX,this.power_range,_)}))}meleeAttack(e,t){var s,i,o;if(t.destructible&&!t.destructible.isDead()){const a=null===(o=null===(i=null===(s=e.equipments)||void 0===s?void 0:s.getMeleeWeapon())||void 0===i?void 0:i.weapon)||void 0===o?void 0:o.damageType;this.attackPhase(e,t,n.ABILITIES.STR,this.power_melee,void 0===a?r.DamageType.BLUDGEONING:a)}}}},6637:function(e,t,s){"use strict";var i=this&&this.__awaiter||function(e,t,s,i){return new(s||(s=Promise))((function(o,n){function r(e){try{c(i.next(e))}catch(e){n(e)}}function a(e){try{c(i.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,a)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.prepareNewJourney=void 0;const o=s(3607),n=s(8924),r=s(6557),a=s(5887),c=s(6935),l=s(5928),h=s(7409);var d;!function(e){e[e.choose_name=0]="choose_name",e[e.choose_race=1]="choose_race",e[e.choose_class=2]="choose_class",e[e.choose_abilities=3]="choose_abilities",e[e.phases_max=4]="phases_max"}(d||(d={})),t.prepareNewJourney=()=>i(void 0,void 0,void 0,(function*(){var e,t,s,i,u,f,p;let g,m=d.choose_name,y="my hero",v=0,_=0,w=0,b=0,T=14,E=0,k=0,S=0;const x=(0,c.createListOfRaces)(),C=(0,a.createListOfClasses)(),A=new r.Abilities(10,10,10,10,10),O=new r.Abilities(10,10,10,10,10),I=(e,t,s)=>{o.game.clear(),o.game.renderVersion(),o.game.drawText("New game",10,1,h.Colors.HILIGHT_TEXT);for(let e=0;e<4;e++){const t=m===e?h.Colors.HILIGHT_TEXT:h.Colors.DEFAULT_TEXT;0==e&&o.game.drawText(`name: ${y}`,10,5,t),1==e&&o.game.drawText("Choose race",10,10,t),2==e&&o.game.drawText("Choose class",20,10,t),3==e&&o.game.drawText("Set abilities",30,10,t)}o.game.drawText("Enter) Next   Backspace) Back   Use arrow keys (or WASD) to navigate",11,o.game.height,h.Colors.DEFAULT_TEXT),o.game.drawChar(">",8,12+v,h.Colors.DEFAULT_TEXT);for(let e=0;e<x.length;e++)o.game.drawText(x[e],10,12+e);o.game.drawChar(">",18,12+_,h.Colors.DEFAULT_TEXT);for(let e=0;e<C.length;e++)o.game.drawText(C[e],20,12+e);o.game.drawText(S>0?`Hp increase: ${S} per level`:"",10,18,h.Colors.DEFAULT_TEXT),o.game.drawText("none"!==e?`Resiliences: ${e}`:"",10,19,h.Colors.DEFAULT_TEXT),m===d.choose_abilities&&(g=[],g.push("Use left and right arrows to change ability scores."),g.push(""),0===w&&g.push("Strength: Measuring physical power."),1===w&&g.push("Dexterity: Measuring agility."),2===w&&g.push("Constitution: Measuring endurance."),3===w&&g.push("Intelligence: Measuring reasoning and memory."),4===w&&g.push("Wisdom: Measuring perception and insight.")),o.game.drawChar(">",28,12+w,h.Colors.DEFAULT_TEXT),o.game.drawText("Strength",30,12),o.game.drawText("Dexterity",30,13),o.game.drawText("Constitution",30,14),o.game.drawText("Intelligence",30,15),o.game.drawText("Wisdom",30,16),o.game.drawText("Unused points",30,17),o.game.drawText(`${A.str}`,37,12),o.game.drawText(`${A.dex}`,37,13),o.game.drawText(`${A.con}`,37,14),o.game.drawText(`${A.int}`,37,15),o.game.drawText(`${A.wis}`,37,16),o.game.drawText(`${T}`,37,17),o.game.drawText(0!==s.str?`+${s.str.toString()}`:"",39,12),o.game.drawText(0!==s.dex?`+${s.dex.toString()}`:"",39,13),o.game.drawText(0!==s.con?`+${s.con.toString()}`:"",39,14),o.game.drawText(0!==s.int?`+${s.int.toString()}`:"",39,15),o.game.drawText(0!==s.wis?`+${s.wis.toString()}`:"",39,16),o.game.drawText(`= ${O.str.toString()} (${O.getBonusWithSign(r.ABILITIES.STR)})`,41,12),o.game.drawText(`= ${O.dex.toString()} (${O.getBonusWithSign(r.ABILITIES.DEX)})`,41,13),o.game.drawText(`= ${O.con.toString()} (${O.getBonusWithSign(r.ABILITIES.CON)})`,41,14),o.game.drawText(`= ${O.int.toString()} (${O.getBonusWithSign(r.ABILITIES.INT)})`,41,15),o.game.drawText(`= ${O.wis.toString()} (${O.getBonusWithSign(r.ABILITIES.WIS)})`,41,16);for(let e=0;e<g.length;e++)o.game.drawText(g[e],10,21+e,h.Colors.DEFAULT_TEXT);if(o.game.drawText("Profiencies: ",55,20),t.length>0)for(let e=0;e<t.length;e++)o.game.drawText(t[e],55,22+e);const i=O.getBonus(r.ABILITIES.CON),n=E+i,a=k+i;o.game.drawText(`Health at start: ${E} + ${i} (CON) = ${n}`,50,12),o.game.drawText(`Health increase per level +${k} + ${i} (CON) = ${a}`,50,13)},R=e=>{T-e>=0&&(0===w&&(A.inRange(A.str+e)?A.str+=e:e=0),1===w&&(A.inRange(A.dex+e)?A.dex+=e:e=0),2===w&&(A.inRange(A.con+e)?A.con+=e:e=0),3===w&&(A.inRange(A.int+e)?A.int+=e:e=0),4===w&&(A.inRange(A.wis+e)?A.wis+=e:e=0),T-=e)};for(;;){S=(0,l.ensure)(null===(e=(0,c.getRace)(x[v]))||void 0===e?void 0:e.toughnessIncrease);const r=(0,l.ensure)(null===(t=(0,c.getRace)(x[v]))||void 0===t?void 0:t.resilience),h=(0,l.createListOfProficiencies)(x[v],C[_]);if(m===d.choose_race){const e=(0,l.ensure)(null===(s=(0,c.getRace)(x[v]))||void 0===s?void 0:s.flavourText);g=(0,l.ensure)((0,l.wordWrap)(e,48))}else if(m===d.choose_class){const e=(0,l.ensure)(null===(i=(0,a.getClass)(C[_]))||void 0===i?void 0:i.flavourText);g=(0,l.ensure)((0,l.wordWrap)(e,48))}else g=[];const T=(0,l.ensure)(null===(u=(0,c.getRace)(x[v]))||void 0===u?void 0:u.abilityIncrease);O.str=A.str+T.str,O.dex=A.dex+T.dex,O.con=A.con+T.con,O.int=A.int+T.int,O.wis=A.wis+T.wis,E=(0,l.ensure)(null===(f=(0,a.getClass)(C[_]))||void 0===f?void 0:f.healthAtStart),k=(0,l.ensure)(null===(p=(0,a.getClass)(C[_]))||void 0===p?void 0:p.healthIncreasePerLevel),I(r,h,T),b=0;const N=yield o.game.getch();let P=!1;const M=(0,n.keyPress)("menu",N);switch(M){case"SELECT":m++,m>=d.phases_max&&(P=!0);break;case"BACK":m--,m<0&&(m=0);break;case"MOVE_UP":b=-1;break;case"MOVE_DOWN":b=1;break;case"MOVE_LEFT":m===d.choose_abilities&&R(-1);break;case"MOVE_RIGHT":m===d.choose_abilities&&R(1)}if(o.game.handleZoomKeys(N),P)break;m===d.choose_name&&("BACK"===M&&y.length>0?y=y.substr(0,y.length-1):/^[a-z0-9]+$/i.test(N)&&1===N.length&&y.length<16&&(y+=N)),m===d.choose_race&&(v+=b,v<0&&(v=x.length-1),v>x.length-1&&(v=0)),m===d.choose_class&&(_+=b,_<0&&(_=C.length-1),_>C.length-1&&(_=0)),m===d.choose_abilities&&(w+=b,w<0&&(w=4),w>4&&(w=0))}return""===y&&(y="Unnamed"),[O,v,_,E,k,S,y]}))},5887:function(e,t,s){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getClassNameByIndex=t.createListOfProficiencies_byClass=t.createListOfClasses=t.getClass=void 0;const o=i(s(373)),n=s(5928),r=o.default,a=e=>r.find((t=>t.name===e));t.getClass=e=>{if((e=>{for(const t of r)if(t.name===e)return!0;return!1})(e))return(0,n.ensure)(a(e))},t.createListOfClasses=()=>{const e=[];for(const t of o.default)e.push(t.name);return e},t.createListOfProficiencies_byClass=e=>{const t=(0,n.ensure)(a(e)),s=[];for(const e of t.proficiencies)s.push(e.type);return s},t.getClassNameByIndex=e=>r[e].name},6127:function(e,t,s){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createMonster=t.monsters=void 0;const o=i(s(8260)),n=i(s(8047)),r=s(6557),a=i(s(7529)),c=i(s(808)),l=s(792),h=s(7107),d=s(5928);t.monsters=n.default,t.createMonster=(e,s,i)=>{let n="1d4",u=0,f=1,p=0,g="?",m=o.default.default_monster,y=1,v=new r.Abilities(2,2,2,2,2);if((e=>{for(const s of t.monsters)if(s.name===e)return!0;return!1})(e)){const s=(0,d.ensure)((e=>t.monsters.find((t=>t.name===e)))(e));g=s.ch,m=s.color,n=s.attacks[0].damage,p=s.ac,f=s.hp,u=s.xp,v=new r.Abilities(s.abilities.str,s.abilities.dex,s.abilities.con,s.abilities.int,s.abilities.wis),y=s.movingSpeed}const _=new c.default(s,i,g,e,m);return _.destructible=new h.MonsterDestructible(f,p,`dead ${e}`,u),_.attacker=new a.default(n,"1d1"),_.ai=new l.MonsterAI,_.abilities=v,_.ai.movingSpeed=y,_}},6935:function(e,t,s){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getRaceNameByIndex=t.createListOfProficiencies_byRace=t.createListOfRaces=t.getRace=void 0;const o=i(s(882)),n=s(5928),r=o.default,a=e=>r.find((t=>t.name===e));t.getRace=e=>{if((e=>{for(const t of r)if(t.name===e)return!0;return!1})(e))return(0,n.ensure)(a(e))},t.createListOfRaces=()=>{const e=[];for(const t of o.default)e.push(t.name);return e},t.createListOfProficiencies_byRace=e=>{const t=(0,n.ensure)(a(e)),s=[];for(const e of t.proficiencies)s.push(e.type);return s},t.getRaceNameByIndex=e=>r[e].name},3190:function(e,t,s){"use strict";var i=this&&this.__awaiter||function(e,t,s,i){return new(s||(s=Promise))((function(o,n){function r(e){try{c(i.next(e))}catch(e){n(e)}}function a(e){try{c(i.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,a)}c((i=i.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createSpell=t.createSpellParticles=t.getSpell=t.spells=void 0;const n=o(s(5686)),r=s(3607),a=s(6557),c=o(s(808)),l=s(792),h=o(s(6325)),d=s(5928),u=s(7409);t.spells=n.default,t.getSpell=e=>{if((e=>!!t.spells.find((t=>t.name===e)))(e)){const s=(0,d.ensure)((e=>t.spells.find((t=>t.name===e)))(e));return r.game.gameStatus=r.GameStatus.NEW_TURN,s}console.error(`There is no spell called ${e}`)};const f=(e,t,s,i,o)=>{const n=new c.default(s,i,e,"",t);n.lifetime=new h.default(o),n.emitLight=!0,n.blocks=!1,n.fovLen=o+1,n.color=t,r.game.sendToBack(n)};t.createSpellParticles=(e,t,s,i,o,n,a)=>{var c,h;if("cube"===i)for(let i=e-s;i<e+s;i++)for(let e=t-s;e<t+s;e++)f(n.charAt(l.random.getInt(0,n.length-1)),o,i,e,a);else if("sphere"===i)for(let i=0;i<360;i++){const h=Math.sin(i/180*3.1415),u=Math.cos(i/180*3.1415);let p=e,g=t;for(let e=0;e<s;e++){p+=h,g+=u;let e=!1;if((null===(c=r.game.map)||void 0===c?void 0:c.isWall((0,d.float2int)(p),(0,d.float2int)(g)))&&(e=!0),!e){const t=r.game.getAllActors((0,d.float2int)(p),(0,d.float2int)(g));if(t)for(const s of t)if(s.emitLight){e=!0;break}}e||f(n.charAt(l.random.getInt(0,n.length-1)),o,(0,d.float2int)(p),(0,d.float2int)(g),a)}}else f(n.charAt(l.random.getInt(0,n.length-1)),o,e,t,a);null===(h=r.game.player)||void 0===h||h.computeFov()},t.createSpell=(e,s,o)=>i(void 0,void 0,void 0,(function*(){var i,n;console.log("caster",s),console.log(`spell level: ${o}`),console.log(JSON.stringify(e,null,2));const a=e.amount.split(";"),c=parseInt(a[o-1]);let l=0,h=0;for(let a=0;a<c;a++){let a=[];if(e.range>0){const[t,i,o]=yield r.game.pickATile(s.x,s.y,e.range);if(l=i,h=o,t)if("cube"===e.effectShape){const t=r.game.getActorsInCube(i,o,e.effectSize,s);t&&(a=t)}else if("cone"===e.effectShape);else if("sphere"===e.effectShape){const t=r.game.getActorsInSphere(i,o,e.effectSize,s);t&&(a=t)}else{const e=r.game.getActor(i,o);e&&a.push(e)}}else l=s.x,h=s.y,a.push(s);for(const t of a)m(t,s,e,o,l,h),null===(i=r.game.player)||void 0===i||i.computeFov(),r.game.render();0===a.length&&(m(void 0,s,e,o,l,h),null===(n=r.game.player)||void 0===n||n.computeFov(),r.game.render());let c="#000000",d="?";"acid"===e.effectType?(c="#AAFFAA",d="*oOUGB?"):"force"===e.effectType?(c="#FFAAFF",d="*"):"lightning"===e.effectType?(c="#AAFFFF",d='*/\\,.!"={}'):"fire"===e.effectType?(c="#FFAA40",d="~/-\\|Ss"):"cold"===e.effectType?(c="#FFFFFF",d="*/\\-|Xx"):"radiant"===e.effectType?(c="#FFFFAA",d="/\\-|"):"nectoric"===e.effectType?(c="#AA00AA",d="*.,;:oO"):"poison"===e.effectType?(c="#00FF00",d="oO~s%"):"heal"===e.effectType&&(c="#FFAAAA",d="<>oO~s%"),console.log(e.effectType),(0,t.createSpellParticles)(l,h,e.effectSize,e.effectShape,c,d,2)}}));const p=(e,t)=>{var s,i,o,n,r;if(e.length>0){if("str"===e)return(0,d.ensure)(null===(s=t.abilities)||void 0===s?void 0:s.getBonus(a.ABILITIES.STR));if("dex"===e)return(0,d.ensure)(null===(i=t.abilities)||void 0===i?void 0:i.getBonus(a.ABILITIES.DEX));if("con"===e)return(0,d.ensure)(null===(o=t.abilities)||void 0===o?void 0:o.getBonus(a.ABILITIES.CON));if("int"===e)return(0,d.ensure)(null===(n=t.abilities)||void 0===n?void 0:n.getBonus(a.ABILITIES.INT));if("win"===e)return(0,d.ensure)(null===(r=t.abilities)||void 0===r?void 0:r.getBonus(a.ABILITIES.WIS))}return 0},g=e=>"force"===e||"acid"===e||"lightning"===e||"fire"===e||"cold"===e||"radiant"===e||"necrotic"===e||"poison"===e,m=(e,t,s,i,o,n)=>{var c,h,f,m,y,v,_,w,b,T,E,k,S,x,C;const A=s.effectValues.split(";")[i-1];if(e){const i=s.effectType.split(";");for(const k of i){const[i,S,x]=l.random.parseDice(A),C=p(s.effectValue_mod,t);let O=!1,I=0;"str"===s.target_saving_throw_type&&(I=(0,d.ensure)(null===(c=e.abilities)||void 0===c?void 0:c.getBonus(a.ABILITIES.STR))),"dex"===s.target_saving_throw_type&&(I=(0,d.ensure)(null===(h=e.abilities)||void 0===h?void 0:h.getBonus(a.ABILITIES.DEX))),"con"===s.target_saving_throw_type&&(I=(0,d.ensure)(null===(f=e.abilities)||void 0===f?void 0:f.getBonus(a.ABILITIES.CON))),"int"===s.target_saving_throw_type&&(I=(0,d.ensure)(null===(m=e.abilities)||void 0===m?void 0:m.getBonus(a.ABILITIES.INT))),"wis"===s.target_saving_throw_type&&(I=(0,d.ensure)(null===(y=e.abilities)||void 0===y?void 0:y.getBonus(a.ABILITIES.WIS)));const R=l.random.dice(1,20,I),N=l.random.dice(1,20,null===(v=t.abilities)||void 0===v?void 0:v.getBonus(a.ABILITIES.INT));""!==s.target_saving_throw_type&&(r.game.log.add(`Attack roll ${N} (1d20 ${null===(_=t.abilities)||void 0===_?void 0:_.getBonusWithSign(a.ABILITIES.INT)}) against ${R} (${s.target_saving_throw_type} 1d20 ${I>0?"+"+I:I})`),R>=N&&(O=!0));const P=l.random.dice(i,S,x)+C,M=C>0?`+${C}`:`${C}`,L=A+(s.effectValue_mod.length>0?` with ${s.effectValue_mod.toUpperCase()} ${M}`:"");if("heal"===k)r.game.log.add(`${t.name} cast a ${s.name} and heals for ${P<1?1:P} hit points (${L}).`),null===(w=e.destructible)||void 0===w||w.heal(P<1?1:P);else if(g(k))if(""!==s.target_saving_throw_type){const i=s.if_target_saving_throw_success.split(";");if(!0===O)for(const o of i)"half_damage"===o?(r.game.log.add(`${t.name} cast a ${s.name} to ${e.name} for ${(0,d.float2int)(P/2)} hit points (${L} / 2).`),null===(b=e.destructible)||void 0===b||b.takeDamage(e,(0,d.float2int)(P/2))):""===o&&r.game.log.add(`${e.name} dodged the spell!`);else{const i=s.if_target_saving_throw_fail.split(";");for(const a of i)"full_damage"===a&&(r.game.log.add(`${t.name} cast a ${s.name} to ${e.name} for ${(0,d.float2int)(P)} hit points (${L}).`),null===(T=e.destructible)||void 0===T||T.takeDamage(e,(0,d.float2int)(P))),"pushing_away"===a&&e.pushAwayFrom(o,n,2)}}else r.game.log.add(`${t.name} cast a ${s.name} to ${e.name} for ${P} hit points (${L}).`),null===(E=e.destructible)||void 0===E||E.takeDamage(e,P);else r.game.log.add(`unkow effect type ${k}`,u.Colors.DISALLOWED)}}else{const e=s.effectType.split(";");for(const i of e)if("transmutation"===i){const e=s.toCaster.split(";");for(const s of e)"teleport_to_selected_location"===s&&((null===(k=r.game.map)||void 0===k?void 0:k.canWalk(o,n))?(t.x=o,t.y=n,r.game.log.add(`${t.name} teleported!`),null===(S=r.game.player)||void 0===S||S.computeFov(),r.game.camera.compute((0,d.ensure)(null===(x=r.game.player)||void 0===x?void 0:x.x),(0,d.ensure)(null===(C=r.game.player)||void 0===C?void 0:C.y))):r.game.log.add("Can't teleport there."))}}}},4692:(e,t)=>{"use strict";var s;Object.defineProperty(t,"__esModule",{value:!0}),t.DamageType=void 0,(s=t.DamageType||(t.DamageType={}))[s.BLUDGEONING=0]="BLUDGEONING",s[s.PIERCING=1]="PIERCING",s[s.SLASHING=2]="SLASHING",t.default=class{constructor(e){this.name=e.name,this.damage=e.damage,this.damageType=e.damageType,this.rangeMax=e.rangeMax,this.needReload=e.needReload,this.isReloaded=!1}}},5302:function(e,t,s){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.connectSocket=void 0;const o=i(s(7046));t.connectSocket=()=>(0,o.default)("https://roguelike.saunalanit.org",{reconnectionAttempts:0,transports:["websocket"]})},808:function(e,t,s){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,s,i){void 0===i&&(i=s),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[s]}})}:function(e,t,s,i){void 0===i&&(i=s),e[i]=t[s]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&i(t,e,s);return o(t,e),t},r=this&&this.__awaiter||function(e,t,s,i){return new(s||(s=Promise))((function(o,n){function r(e){try{c(i.next(e))}catch(e){n(e)}}function a(e){try{c(i.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,a)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const a=s(3607),c=n(s(9524)),l=s(5887),h=s(6935),d=s(792),u=s(5928),f=s(7409);t.default=class{constructor(e,t,s,i,o){this.fovOnly=!0,this.blocks=!0,this.emitLight=!1,this.x=(0,u.float2int)(e),this.y=(0,u.float2int)(t),this.ch=s,this.color=o,this.name=i,this.race=0,this.class=0,this.fovLen=10}create(e){var t,s,i,o,n,r,a;let l;this.blocks=!1,"Wearable"===(null===(t=e.pickable)||void 0===t?void 0:t.effectName)&&(l=new c.Wearable(e.pickable.effect.type)),"AiChangeEffect"===(null===(s=e.pickable)||void 0===s?void 0:s.effectName)&&(l=new c.AiChangeEffect(new d.ConfusedMonsterAi(parseInt(e.pickable.effect.newAi.nbTurns)),e.pickable.effect.message)),"MapClearEffect"===(null===(i=e.pickable)||void 0===i?void 0:i.effectName)&&(l=new c.MapClearEffect(e.pickable.effect.message)),"HealthEffect"===(null===(o=null==e?void 0:e.pickable)||void 0===o?void 0:o.effectName)&&(l=new c.HealthEffect(null===(n=e.pickable)||void 0===n?void 0:n.effect.amount,void 0)),(null===(r=null==e?void 0:e.pickable)||void 0===r?void 0:r.selectorName)?this.pickable=new c.default({selector:new c.TargetSelector((0,u.ensure)(e.pickable.selector).type,(0,u.ensure)(e.pickable.selector).range),effect:l,weight:e.pickable.weight}):this.pickable=new c.default({selector:void 0,effect:l,weight:(0,u.ensure)(null===(a=e.pickable)||void 0===a?void 0:a.weight)})}render(){var e,t;const s=null===(t=null===(e=a.game.player)||void 0===e?void 0:e.fov)||void 0===t?void 0:t.getMapped(this.x,this.y);(2===s||!this.fovOnly&&0!==s)&&a.game.drawChar(this.ch,this.x+a.game.camera.x,this.y+a.game.camera.y,2===s?this.color:f.Colors.WALL_DARK)}update(e){return r(this,void 0,void 0,(function*(){this.ai&&(yield this.ai.update(this,e)),this.lifetime&&(this.lifetime.update(),this.lifetime.turns<=0&&a.game.removeActor(this))}))}computeFov(){this.fov&&(this.fov.compute(this.x,this.y,10),this.fov.computeLights())}getDistance(e,t){const s=this.x-e,i=this.y-t;return Math.sqrt(s*s+i*i)}getProfiencies(){const e=(0,h.createListOfRaces)(),t=(0,l.createListOfClasses)();this.proficiencies=(0,u.createListOfProficiencies)(e[this.race],t[this.class])}pushAwayFrom(e,t,s){var i;const o=this.getDistance(e,t),n=(0,u.float2int)((this.x-e)/o),r=(0,u.float2int)((this.y-t)/o);for(let e=0;e<s;e++)(null===(i=a.game.map)||void 0===i?void 0:i.canWalk(this.x+n,this.y+r))&&(this.x+=n,this.y+=r)}doorOpenOrClose(){this.blocks=!this.blocks,this.blocks?(this.ch="D",a.game.log.add("A door is closed.")):"#"===this.ch?(this.color=f.Colors.DOOR,this.ch="+",a.game.log.add("A secret door is opened!",f.Colors.HILIGHT_TEXT)):(this.ch="+",a.game.log.add("A door is opened."))}openAsContainer(e){var t;return r(this,void 0,void 0,(function*(){if(this.container){this.container.render(this.name.toUpperCase());const s=(yield a.game.getch()).charCodeAt(0)-97;if(s>=0&&s<(0,u.ensure)(this.container).inventory.length){const i=(0,u.ensure)(this.container).inventory[s];(null===(t=e.container)||void 0===t?void 0:t.add(i))&&(a.game.log.add(`You pick up the ${i.name}`),this.container.remove(i))}}}))}}},792:function(e,t,s){"use strict";var i=this&&this.__awaiter||function(e,t,s,i){return new(s||(s=Promise))((function(o,n){function r(e){try{c(i.next(e))}catch(e){n(e)}}function a(e){try{c(i.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,a)}c((i=i.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ConfusedMonsterAi=t.TemporaryAI=t.ConfusedAI=t.MonsterAI=t.PlayerAI=t.random=void 0;const n=s(3607),r=s(8924),a=s(3190),c=o(s(808)),l=s(5928),h=s(7409),d=o(s(9451));t.random=new d.default;class u{constructor(){this.movingSpeed=1}}t.default=u,t.PlayerAI=class extends u{constructor(){super(),this.xpLevel=1,super.movingSpeed=1}getNextLevelXP(){return 200+150*this.xpLevel}pickDirection(){return i(this,void 0,void 0,(function*(){const e=(0,r.keyPress)("game",yield n.game.getch());return"MOVE_LEFT"===e?[-1,0]:"MOVE_RIGHT"===e?[1,0]:"MOVE_UP"===e?[0,-1]:"MOVE_DOWN"===e?[0,1]:"MOVE_UP_LEFT"===e?[-1,-1]:"MOVE_UP_RIGHT"===e?[1,-1]:"MOVE_DOWN_LEFT"===e?[-1,1]:"MOVE_DOWN_RIGHT"===e?[1,1]:[0,0]}))}update(e){var t,s,o;return i(this,void 0,void 0,(function*(){const i=this.getNextLevelXP();if((0,l.ensure)(e.destructible).xp>=i&&(this.xpLevel++,(0,l.ensure)(e.destructible).xp-=i,n.game.log.add(`Your battle skills grow stronger! You reached level ${this.xpLevel}`,h.Colors.LEVEL_UP),n.game.render()),e.destructible&&e.destructible.isDead())return;let a=0,c=0;const d=(0,r.keyPress)("game",yield n.game.getch());switch(d){case"MOVE_LEFT":a--;break;case"MOVE_RIGHT":a++;break;case"MOVE_UP":c--;break;case"MOVE_DOWN":c++;break;case"MOVE_UP_LEFT":a--,c--;break;case"MOVE_UP_RIGHT":a++,c--;break;case"MOVE_DOWN_LEFT":a--,c++;break;case"MOVE_DOWN_RIGHT":a++,c++;break;default:yield this.handleActionKey(e,d)}0===a&&0===c||(n.game.gameStatus=n.GameStatus.NEW_TURN,(yield this.moveOrAttack(e,e.x+a,e.y+c))&&(null===(t=n.game.player)||void 0===t||t.computeFov(),n.game.camera.compute((0,l.ensure)(null===(s=n.game.player)||void 0===s?void 0:s.x),(0,l.ensure)(null===(o=n.game.player)||void 0===o?void 0:o.y))))}))}handleActionKey(e,t){return i(this,void 0,void 0,(function*(){const s=(e,t)=>i(this,void 0,void 0,(function*(){var s;const i=(0,l.ensure)(n.game.map).filterActorsAroundPosition(e,{property:"name",value:"door"});if(1===i.length&&!1===t)i[0].doorOpenOrClose();else if(i.length>0){n.game.log.add("Which direction?"),n.game.render();const[t,i]=yield this.pickDirection();(null===(s=null===n.game||void 0===n.game?void 0:n.game.map)||void 0===s?void 0:s.openCloseDoor(e.x+t,e.y+i))||n.game.log.add("There is no any door.")}})),o=(e,t)=>i(this,void 0,void 0,(function*(){var s;const i=(0,l.ensure)(n.game.map).filterClassesAroundPosition(e,c.default).filter((({container:e})=>!!e));if(i&&1===i.length&&!1===t)yield i[0].openAsContainer(e);else if(i&&i.length>0){n.game.log.add("Which direction?"),n.game.render();const[t,i]=yield this.pickDirection();(yield null===(s=null===n.game||void 0===n.game?void 0:n.game.map)||void 0===s?void 0:s.openContainer(e,e.x+t,e.y+i))||n.game.log.add("There is no any container.")}})),d=t=>i(this,void 0,void 0,(function*(){var i;yield s(e,t),null===(i=n.game.player)||void 0===i||i.computeFov(),n.game.gameStatus=n.GameStatus.NEW_TURN})),u=t=>i(this,void 0,void 0,(function*(){var s;yield o(e,t),null===(s=n.game.player)||void 0===s||s.computeFov(),n.game.gameStatus=n.GameStatus.NEW_TURN})),f=()=>i(this,void 0,void 0,(function*(){n.game.save(),n.game.log.add("Game saved.",h.Colors.GAME_SAVED)})),p=()=>i(this,void 0,void 0,(function*(){n.game.log.add("Use item");const t=yield this.choseFromInventory(e);t?(yield(0,l.ensure)(t.pickable).use(t,e),n.game.gameStatus=n.GameStatus.NEW_TURN):n.game.log.add("Nevermind...")})),g=()=>i(this,void 0,void 0,(function*(){const t=yield this.choseFromInventory(e);t?(yield(0,l.ensure)(t.pickable).drop(t,e),n.game.gameStatus=n.GameStatus.NEW_TURN):n.game.log.add("Nevermind...")})),m=()=>i(this,void 0,void 0,(function*(){const t=yield this.choseFromInventory(e);t?(yield(0,l.ensure)(t.pickable).wear(t,e),n.game.gameStatus=n.GameStatus.NEW_TURN):n.game.log.add("Nevermind...")})),y=()=>i(this,void 0,void 0,(function*(){var t,s,i,o;if(n.game.getClosestMonster(e.x,e.y,2))return void n.game.log.add("Can't shoot in melee combat.");const r=null===(t=e.equipments)||void 0===t?void 0:t.getRangeWeapon();if(r){if((null===(s=r.weapon)||void 0===s?void 0:s.needReload)&&!r.weapon.isReloaded)return r.weapon.isReloaded=!0,n.game.log.add(`Reloading ${r.name}...`),void(n.game.gameStatus=n.GameStatus.NEW_TURN);const[t,a,c]=yield n.game.pickATile(e.x,e.y,null===(i=r.weapon)||void 0===i?void 0:i.rangeMax);(0,l.ensure)(r.weapon).isReloaded=!1,t&&(yield null===(o=e.attacker)||void 0===o?void 0:o.rangeAttack(e,a,c),n.game.gameStatus=n.GameStatus.NEW_TURN)}else n.game.log.add("Shooting requires a ranged weapon.")})),v=()=>i(this,void 0,void 0,(function*(){n.game.renderMenuBackground({title:"HELP",x:15,y:4,w:45,h:30}),n.game.drawText("WASD+QEZC keys to move and attack",17,6,h.Colors.DEFAULT_TEXT);const e=(0,r.keyBindingsForHelp)();for(let t=0;t<e.length;t++){const{keys:s,description:i}=e[t];n.game.drawText(s.join(" / "),17,7+t,h.Colors.DEFAULT_TEXT),n.game.drawText(`: ${i}`,19,7+t,h.Colors.DEFAULT_TEXT)}yield n.game.getch()})),_=()=>i(this,void 0,void 0,(function*(){var t,s,i,o;n.game.log.add("Which direction to push?"),n.game.render();const[r,a]=yield this.pickDirection();(null===(t=null===n.game||void 0===n.game?void 0:n.game.map)||void 0===t?void 0:t.pushTo(e.x+r,e.y+a,r,a))||n.game.log.add("There's nothing to push."),null===(s=n.game.player)||void 0===s||s.computeFov(),n.game.camera.compute((0,l.ensure)(null===(i=n.game.player)||void 0===i?void 0:i.x),(0,l.ensure)(null===(o=n.game.player)||void 0===o?void 0:o.y)),n.game.gameStatus=n.GameStatus.NEW_TURN})),w=()=>i(this,void 0,void 0,(function*(){var t,s,i,o;n.game.log.add("Which direction to pull?"),n.game.render();const[r,a]=yield this.pickDirection();(null===(t=null===n.game||void 0===n.game?void 0:n.game.map)||void 0===t?void 0:t.pullTo(e.x,e.y,r,a))?(e.x+=r,e.y+=a):n.game.log.add("There's nothing to pull."),null===(s=n.game.player)||void 0===s||s.computeFov(),n.game.camera.compute((0,l.ensure)(null===(i=n.game.player)||void 0===i?void 0:i.x),(0,l.ensure)(null===(o=n.game.player)||void 0===o?void 0:o.y)),n.game.gameStatus=n.GameStatus.NEW_TURN})),b=()=>i(this,void 0,void 0,(function*(){const t=["acid splash","cure wounds","magic missile","fire bolt","poison spray","thunderwave","fireball","sacred flame","shatter","misty step"];n.game.renderMenuBackground({title:"test spells",x:20,y:4,w:20,h:4+t.length});let s="a";for(let e=0;e<t.length;e++)n.game.drawText(`${s}) ${t[e]}`,22,6+e,h.Colors.DEFAULT_TEXT),s=String.fromCharCode(s.charCodeAt(0)+1);const i=(yield n.game.getch()).charCodeAt(0)-97;if(i<0||i>=t.length)n.game.log.add("Nevermind");else{n.game.log.add(`Selected spell: ${t[i]}`);const s=(0,a.getSpell)(t[i]);s&&(yield(0,a.createSpell)(s,e,1))}})),T=e=>{const t=n.game.fontSize+e;t>5&&(n.game.setScale(t),n.game.render())};switch(t){case"SAVE":f();break;case"GO_DOWN":(null===(E=n.game.stairs)||void 0===E?void 0:E.x)===e.x&&(null===(k=n.game.stairs)||void 0===k?void 0:k.y)===e.y?n.game.nextLevel():n.game.log.add("There are no stairs here.");break;case"PICK":(()=>{n.game.gameStatus=n.GameStatus.NEW_TURN;let t=!1;for(const s of n.game.actors)if(s.pickable&&s.x===e.x&&s.y===e.y){if(s.pickable.pick(s,e)){t=!0,n.game.log.add(`You pick up the ${s.name}`,h.Colors.PICKED_UP);break}t||(t=!0,n.game.log.add("Your inventory is full.",h.Colors.INVENTORY_FULL))}t||n.game.log.add("There's nothing here that you can pick up.")})();break;case"INVENTORY":yield p();break;case"DROP":yield g();break;case"OPEN_DOORS":yield d(!1);break;case"OPEN_DOOR":yield d(!0);break;case"LOOK_CONTAINER":yield u(!1);break;case"LOOK_CONTAINERS":yield u(!0);break;case"WEAR_EQUIP":yield m();break;case"AIM":yield y();break;case"HELP":yield v();break;case"PUSH":yield _();break;case"PULL":yield w();break;case"SPELL":yield b();break;case"ZOOM_OUT":T(-1);break;case"ZOOM_IN":T(1);break;case"REST":n.game.gameStatus=n.GameStatus.NEW_TURN}var E,k}))}moveOrAttack(e,t,s){var o;return i(this,void 0,void 0,(function*(){if(null===(o=n.game.map)||void 0===o?void 0:o.isWall(t,s))return!1;let i=!1;for(const i of n.game.actors)if(i.destructible&&!i.destructible.isDead()&&i.x===t&&i.y===s)return yield(0,l.ensure)(e.attacker).attack(e,i),!1;for(const e of n.game.actors)(e.destructible&&e.destructible.isDead||e.pickable||"door"===e.name&&"D"===e.ch)&&e.x===t&&e.y===s&&n.game.log.add(`There is a ${e.name} here`),"door"===e.name&&e.blocks&&e.x===t&&e.y===s&&(i=!0);return!i&&(e.x=t,e.y=s,!0)}))}choseFromInventory(e){var t;return i(this,void 0,void 0,(function*(){n.game.clear(),n.game.render(),e.container&&e.equipments&&(e.container.render("INVENTORY"),null===(t=e.equipments)||void 0===t||t.render());const s=(yield n.game.getch()).charCodeAt(0)-97;return s>=0&&s<(0,l.ensure)(e.container).inventory.length?(0,l.ensure)(e.container).inventory[s]:null}))}},t.MonsterAI=class extends u{constructor(){super(),this.TRACKING_TURNS=3,this.moveCount=0,this.actionPoints=0,this.movingSpeed=1.5}update(e,t){var s,o;return i(this,void 0,void 0,(function*(){for(this.actionPoints+=1/t*this.movingSpeed;this.actionPoints>=1;){const t=n.game.player;if(e.destructible&&e.destructible.isDead()||!t)return;(null===(o=null===(s=n.game.player)||void 0===s?void 0:s.fov)||void 0===o?void 0:o.isInFov(e.x,e.y))?this.moveCount=this.TRACKING_TURNS:this.moveCount--,this.moveCount>0&&this.moveOrAttack(e,t.x,t.y),this.actionPoints-=1}}))}moveOrAttack(e,t,s){var i,o,r,a;let c=t-e.x,h=s-e.y;const d=c>0?1:-1,u=h>0?1:-1,f=Math.sqrt(c*c+h*h);f>=2?(c=Math.round(c/f),h=Math.round(h/f),(null===(i=n.game.map)||void 0===i?void 0:i.canWalk(e.x+c,e.y+h))?(e.x+=(0,l.float2int)(c),e.y+=(0,l.float2int)(h)):(null===(o=n.game.map)||void 0===o?void 0:o.canWalk(e.x+d,e.y))?e.x+=(0,l.float2int)(d):(null===(r=n.game.map)||void 0===r?void 0:r.canWalk(e.x,e.y+u))&&(e.y+=(0,l.float2int)(u))):null===(a=null==e?void 0:e.attacker)||void 0===a||a.attack(e,(0,l.ensure)(n.game.player))}},t.ConfusedAI=class extends u{constructor(e,t){super(),this.nbTurns=e,this.oldAi=t}update(e){var s,o;return i(this,void 0,void 0,(function*(){const i=t.random.getInt(-1,1),r=t.random.getInt(-1,1);if(0!==i||0!==r){const t=e.x+i,a=e.y+r;if(null===(s=n.game.map)||void 0===s?void 0:s.canWalk(t,a))e.x=t,e.y=a;else{const s=n.game.getActor(t,a);s&&(null===(o=null==e?void 0:e.attacker)||void 0===o||o.attack(e,s))}}this.nbTurns--,this.nbTurns<=0&&(e.ai=this.oldAi)}))}};class f extends u{constructor(e){super(),this.nbTurns=e}update(e){return i(this,void 0,void 0,(function*(){this.nbTurns--,0===this.nbTurns&&(e.ai=this.oldAi)}))}applyTo(e){this.oldAi=e.ai,e.ai=this}}t.TemporaryAI=f,t.ConfusedMonsterAi=class extends f{constructor(e){super(e)}update(e){const s=Object.create(null,{update:{get:()=>super.update}});var o,r;return i(this,void 0,void 0,(function*(){const i=t.random.getInt(-1,1),a=t.random.getInt(-1,1);if(0!=i||0!=a){const t=e.x+i,s=e.y+a;if(null===(o=n.game.map)||void 0===o?void 0:o.canWalk(t,s))e.x=t,e.y=s;else{const i=n.game.getActor(t,s);i&&(null===(r=null==e?void 0:e.attacker)||void 0===r||r.attack(e,i))}}s.update.call(this,e)}))}}},7107:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PlayerDestructible=t.MonsterDestructible=void 0;const i=s(3607),o=s(5928),n=s(7409);class r{constructor(e,t,s,i,o){this.maxHP=e,this.hp=this.maxHP,this.defense=t,this.corpseName=s,this.type=i,this.xp=o,this.hpPerLevel=0,this.hpPerLevelBonuses=0}isDead(){return this.hp<=0}heal(e){return this.hp+=e,this.hp>this.maxHP&&(e-=this.hp-this.maxHP,this.hp=this.maxHP),e}takeDamage(e,t){return this.hp-=t,this.hp<=0&&this.die(e),t}die(e){if(e.color=n.Colors.DEAD_BODY,e.name=this.corpseName,e.blocks=!1,e.container)for(;e.container.inventory.length>0;){const t=e.container.inventory[0];t.x=e.x,t.y=e.y,e.container.remove(t),i.game.actors.push(t),i.game.sendToBack(t)}i.game.sendToBack(e)}}t.default=r,t.MonsterDestructible=class extends r{constructor(e,t,s,i){super(e,t,s,"monster",i),this.xp=i}die(e){var t;i.game.log.add(`${e.name} is dead. You gain ${this.xp} xp.`),(0,o.ensure)(null===(t=i.game.player)||void 0===t?void 0:t.destructible).xp+=this.xp,super.die(e)}},t.PlayerDestructible=class extends r{constructor(e,t,s){super(e,t,s,"player",0)}die(e){i.game.log.add("You died.",n.Colors.DEFEAT),super.die(e),i.game.gameStatus=i.GameStatus.DEFEAT}}},6325:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e){this.turns=0,this.turns=e}update(){this.turns--}}},7409:function(e,t,s){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Colors=void 0;const o=i(s(8260));t.Colors={BACKGROUND:o.default.ui_map_background,WALL:o.default.ui_wall,WALL_DARK:o.default.ui_wall_dark,DOOR:o.default.ui_door,HEALTHPOTION:o.default.pickup_healthpotion,NUTELLABUN:o.default.pickup_nutellabun,SCROLL_OF_LIGHTING:o.default.pickup_scroll_of_lightning,SCROLL_OF_FIREBALL:o.default.pickup_scroll_of_fireball,SCROLL_OF_CONFUSION:o.default.pickup_scroll_of_confusion,SCROLL_OF_MAP:o.default.pickup_scroll_of_map,TORCH:o.default.pickup_torch,ARMOR_ITEM:o.default.pickup_armor_item,WEAPON_ITEM:o.default.pickup_weapon_item,LEVEL_UP:o.default.ui_level_up,HEALED:o.default.ui_healed,MENU_CURSOR:o.default.ui_menu_cursor,GAME_SAVED:o.default.ui_game_saved,PICKED_UP:o.default.ui_picked_up,INVENTORY_FULL:o.default.ui_inventory_full,MENU_BORDER:o.default.ui_menu_border,ALLOWED:o.default.ui_allowed,DISALLOWED:o.default.ui_disallowed,HP_10_PERCENT:o.default.ui_hp_10_percent,HP_25_PERCENT:o.default.ui_hp_25_percent,HP_50_PERCENT:o.default.ui_hp_50_percent,HP_95_PERCENT:o.default.ui_hp_95_percent,HP_MAX:o.default.ui_hp_max,HERO:o.default.actor_hero,STAIRS:o.default.actor_stairs,PLAYER_ATTACK:o.default.log_player_attack,ENEMY_ATTACK:o.default.log_enemy_attack,DEAD_BODY:o.default.log_dead_body,DEFAULT_TEXT:o.default.log_default_text,HILIGHT_TEXT:o.default.log_hilight_text,LOG_BACKGROUND:o.default.log_background,DEFEAT:o.default.log_defeat,AMBIENCE_COLOR:["#0088FF","#CCAAFF","#000000","#CCCCCC","#33AA33","#AAFFAA","#CC00CC","#FFFF00","#33AACC","#FF0000"],VERSION:o.default.ui_version}},5928:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isFilled=t.isDefined=t.isPresent=t.capitalize=t.sleep=t.createListOfProficiencies=t.wordWrap=t.dimmerColor=t.rgbToHex=t.hexToRGB=t.ensure=t.float2int=t.debugInit=t.printVersionContainer=t.populateVersion=t.paddedLogObject=void 0;const i=s(5887),o=s(6935);t.paddedLogObject=e=>{const t=Object.keys(e).reduce(((e,t)=>t.length+3>e?t.length+3:e),0);console.log(Object.keys(e).map((s=>`${s.padEnd(t," ")}: ${e[s]}`)).join("\n"))},t.populateVersion=()=>"Commit ID: <span>63d80f6</span> | Version: <span>v0.0.1.22c</span>",t.printVersionContainer=()=>{(0,t.ensure)(document.querySelector("#version")).innerHTML=(0,t.populateVersion)()},t.debugInit=()=>{(0,t.paddedLogObject)({BUILD_DATE:"2021-11-24",BUILD_TIME:"22:06:06",BUILD_DATETIME:"2021-11-24T22:06:06.740Z",COMMIT_HASH:"63d80f6",VERSION:"v0.0.1.22c"})},t.float2int=e=>e>>0,t.ensure=(e,t="This value was promised to be there.")=>{if(null==e)throw new TypeError(t);return e},t.hexToRGB=e=>{let t=0,s=0,i=0;return 4==e.length?(t=parseInt(`0x${e[1]}${e[1]}`,16),s=parseInt(`0x${e[2]}${e[2]}`,16),i=parseInt(`0x${e[3]}${e[3]}`,16)):7==e.length&&(t=parseInt(`0x${e[1]}${e[2]}`,16),s=parseInt(`0x${e[3]}${e[4]}`,16),i=parseInt(`0x${e[5]}${e[6]}`,16)),[t,s,i]},t.rgbToHex=(e,t,s)=>"#"+((1<<24)+(e<<16)+(t<<8)+s).toString(16).slice(1),t.dimmerColor=(e,s)=>{let[i,o,n]=(0,t.hexToRGB)(e);return i*=s,o*=s,n*=s,i<0&&(i=0),o<0&&(o=0),n<0&&(n=0),i>255&&(i=255),o>255&&(o=255),n>255&&(n=255),i=(0,t.float2int)(i),o=(0,t.float2int)(o),n=(0,t.float2int)(n),(0,t.rgbToHex)(i,o,n)},t.wordWrap=(e,t)=>{let s=0;const i=[];let o=0,n=0;for(let r=0;r<e.length;r++)" "===e.charAt(r)&&(s=r),o++,o>=t&&(i.push(e.substring(n,s)),o=0,n=s+1);return i.push(e.substring(n,e.length)),i},t.createListOfProficiencies=(e,t)=>{const s=(0,o.createListOfProficiencies_byRace)(e),n=(0,i.createListOfProficiencies_byClass)(t),r=new Set,a=[];for(const e of s)r.add(e);for(const e of n)r.add(e);for(const e of r)a.push(e);return a},t.sleep=e=>new Promise((t=>setTimeout(t,e))),t.capitalize=e=>e.charAt(0).toUpperCase()+e.slice(1),t.isPresent=e=>!!e,t.isDefined=e=>!!e,t.isFilled=e=>!!e},3005:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=s(3607),o=s(5928),n=s(7409);class r{constructor(e,t){this.text=e,this.color=t}}t.default=class{constructor(){this.SIZE_OF_LOG=100,this.texts=[]}render(){let e=this.texts.length;e>10&&(e=10),i.game.ctx.fillStyle=n.Colors.LOG_BACKGROUND;let t=this.texts.length;t>10&&(t=10),i.game.ctx.fillRect(.5*i.game.fontSize,(i.game.height-t)*i.game.fontSize,28*i.game.fontSize,(.5+t)*i.game.fontSize);for(let t=this.texts.length-10;t<this.texts.length;t++)t>=0&&(i.game.drawText(this.texts[t].text,1,i.game.height-e,(0,o.dimmerColor)(this.texts[t].color,.05*(20-e))),e--)}add(e,t=n.Colors.DEFAULT_TEXT){const s=(0,o.wordWrap)(e,64);for(const e of s)this.texts.push(new r((0,o.capitalize)(e),t)),this.texts.length>this.SIZE_OF_LOG&&this.texts.splice(0,1)}}},5865:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Menu=t.MenuItemCode=t.MenuItem=void 0;class s{constructor(){this.code=0,this.label=""}}var i;t.MenuItem=s,(i=t.MenuItemCode||(t.MenuItemCode={}))[i.NONE=0]="NONE",i[i.NEW_GAME=1]="NEW_GAME",i[i.CONTINUE=2]="CONTINUE",i[i.EXIT=3]="EXIT",i[i.CONSTITUTION=4]="CONSTITUTION",i[i.STRENGTH=5]="STRENGTH",i[i.AGILITY=6]="AGILITY",t.Menu=class{constructor(){this.items=[],this.cursor=0}clear(){this.items&&this.items.length>0&&(this.items=[])}addItem(e,t){const i=new s;i.code=e,i.label=t,this.items.push(i)}}},9451:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=s(5928);let o=0;t.default=class{constructor(){this.rnd=0}setSeed(e){o=e}calc(){o=(9301*o+49297)%233280,this.rnd=o/233280}getInt(e,t){return t=t||1,e=e||0,this.calc(),Math.floor(e+this.rnd*(t-e))}dice(e,t,s=0){let i=0;t++;for(let s=0;s<e;s++)i+=Number(this.getInt(1,t));return i+=+s,i<e&&(i=e),i}parseDice(e){const t=e.includes("+")?parseInt((0,i.ensure)(e.split("+").at(1))):0,[s,o]=e.split("d");return[parseInt(s),parseInt(o),t]}}},6357:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e,t,s,i){this.x=e,this.y=t,this.w=s,this.h=i}GetHalfDimensionX(){return this.w/2}GetHalfDimensionY(){return this.h/2}GetCenterX(){return this.x+this.GetHalfDimensionX()}GetCenterY(){return this.y+this.GetHalfDimensionY()}}},2281:e=>{"use strict";var t,s="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),i={},o=0,n=0;function r(e){var t="";do{t=s[e%64]+t,e=Math.floor(e/64)}while(e>0);return t}function a(){var e=r(+new Date);return e!==t?(o=0,t=e):e+"."+r(o++)}for(;n<64;n++)i[s[n]]=n;a.encode=r,a.decode=function(e){var t=0;for(n=0;n<e.length;n++)t=64*t+i[e.charAt(n)];return t},e.exports=a},6242:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")()},4679:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.installTimerFunctions=t.transports=t.Transport=t.protocol=t.Socket=void 0;const i=s(3481);Object.defineProperty(t,"Socket",{enumerable:!0,get:function(){return i.Socket}}),t.protocol=i.Socket.protocol;var o=s(9870);Object.defineProperty(t,"Transport",{enumerable:!0,get:function(){return o.Transport}});var n=s(7385);Object.defineProperty(t,"transports",{enumerable:!0,get:function(){return n.transports}});var r=s(9622);Object.defineProperty(t,"installTimerFunctions",{enumerable:!0,get:function(){return r.installTimerFunctions}})},3481:function(e,t,s){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Socket=void 0;const o=s(7385),n=s(9622),r=i(s(1830)),a=i(s(4187)),c=i(s(1227)),l=s(3063),h=s(1373),d=(0,c.default)("engine.io-client:socket");class u extends l.Emitter{constructor(e,t={}){super(),e&&"object"==typeof e&&(t=e,e=null),e?(e=(0,a.default)(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=(0,a.default)(t.host).host),(0,n.installTimerFunctions)(this,t),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},t),this.opts.path=this.opts.path.replace(/\/$/,"")+"/","string"==typeof this.opts.query&&(this.opts.query=r.default.decode(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&addEventListener("beforeunload",(()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())}),!1),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close")},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){d('creating transport "%s"',e);const t=function(e){const t={};for(let s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);return t}(this.opts.query);t.EIO=h.protocol,t.transport=e,this.id&&(t.sid=this.id);const s=Object.assign({},this.opts.transportOptions[e],this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return d("options: %j",s),new o.transports[e](s)}open(){let e;if(this.opts.rememberUpgrade&&u.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn((()=>{this.emitReserved("error","No transports available")}),0);e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return d("error while creating transport: %s",e),this.transports.shift(),void this.open()}e.open(),this.setTransport(e)}setTransport(e){d("setting transport %s",e.name),this.transport&&(d("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",(()=>{this.onClose("transport close")}))}probe(e){d('probing transport "%s"',e);let t=this.createTransport(e),s=!1;u.priorWebsocketSuccess=!1;const i=()=>{s||(d('probe transport "%s" opened',e),t.send([{type:"ping",data:"probe"}]),t.once("packet",(i=>{if(!s)if("pong"===i.type&&"probe"===i.data){if(d('probe transport "%s" pong',e),this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;u.priorWebsocketSuccess="websocket"===t.name,d('pausing current transport "%s"',this.transport.name),this.transport.pause((()=>{s||"closed"!==this.readyState&&(d("changing transport and sending upgrade packet"),l(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())}))}else{d('probe transport "%s" failed',e);const s=new Error("probe error");s.transport=t.name,this.emitReserved("upgradeError",s)}})))};function o(){s||(s=!0,l(),t.close(),t=null)}const n=s=>{const i=new Error("probe error: "+s);i.transport=t.name,o(),d('probe transport "%s" failed because of error: %s',e,s),this.emitReserved("upgradeError",i)};function r(){n("transport closed")}function a(){n("socket closed")}function c(e){t&&e.name!==t.name&&(d('"%s" works - aborting "%s"',e.name,t.name),o())}const l=()=>{t.removeListener("open",i),t.removeListener("error",n),t.removeListener("close",r),this.off("close",a),this.off("upgrading",c)};t.once("open",i),t.once("error",n),t.once("close",r),this.once("close",a),this.once("upgrading",c),t.open()}onOpen(){if(d("socket open"),this.readyState="open",u.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade&&this.transport.pause){d("starting upgrade probes");let e=0;const t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(d('socket receive: type "%s", data "%s"',e.type,e.data),this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}else d('packet received with socket readyState "%s"',this.readyState)}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn((()=>{this.onClose("ping timeout")}),this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(d("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emitReserved("flush"))}write(e,t,s){return this.sendPacket("message",e,t,s),this}send(e,t,s){return this.sendPacket("message",e,t,s),this}sendPacket(e,t,s,i){if("function"==typeof t&&(i=t,t=void 0),"function"==typeof s&&(i=s,s=null),"closing"===this.readyState||"closed"===this.readyState)return;(s=s||{}).compress=!1!==s.compress;const o={type:e,data:t,options:s};this.emitReserved("packetCreate",o),this.writeBuffer.push(o),i&&this.once("flush",i),this.flush()}close(){const e=()=>{this.onClose("forced close"),d("socket closing - telling transport to close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},s=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(()=>{this.upgrading?s():e()})):this.upgrading?s():e()),this}onError(e){d("socket error %j",e),u.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(d('socket close with reason: "%s"',e),this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&removeEventListener("offline",this.offlineEventListener,!1),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const t=[];let s=0;const i=e.length;for(;s<i;s++)~this.transports.indexOf(e[s])&&t.push(e[s]);return t}}t.Socket=u,u.protocol=h.protocol},9870:function(e,t,s){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Transport=void 0;const o=s(1373),n=s(3063),r=s(9622),a=(0,i(s(1227)).default)("engine.io-client:transport");class c extends n.Emitter{constructor(e){super(),this.writable=!1,(0,r.installTimerFunctions)(this,e),this.opts=e,this.query=e.query,this.readyState="",this.socket=e.socket}onError(e,t){const s=new Error(e);return s.type="TransportError",s.description=t,super.emit("error",s),this}open(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(e){"open"===this.readyState?this.write(e):a("transport is not open, discarding packets")}onOpen(){this.readyState="open",this.writable=!0,super.emit("open")}onData(e){const t=(0,o.decodePacket)(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emit("packet",e)}onClose(){this.readyState="closed",super.emit("close")}}t.Transport=c},7385:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.transports=void 0;const i=s(715),o=s(1308);t.transports={websocket:o.WS,polling:i.XHR}},715:function(e,t,s){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Request=t.XHR=void 0;const o=i(s(6666)),n=i(s(1227)),r=i(s(6242)),a=s(9622),c=s(3063),l=s(484),h=(0,n.default)("engine.io-client:polling-xhr");function d(){}const u=null!=new o.default({xdomain:!1}).responseType;class f extends l.Polling{constructor(e){if(super(e),"undefined"!=typeof location){const t="https:"===location.protocol;let s=location.port;s||(s=t?"443":"80"),this.xd="undefined"!=typeof location&&e.hostname!==location.hostname||s!==e.port,this.xs=e.secure!==t}const t=e&&e.forceBase64;this.supportsBinary=u&&!t}request(e={}){return Object.assign(e,{xd:this.xd,xs:this.xs},this.opts),new p(this.uri(),e)}doWrite(e,t){const s=this.request({method:"POST",data:e});s.on("success",t),s.on("error",(e=>{this.onError("xhr post error",e)}))}doPoll(){h("xhr poll");const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(e=>{this.onError("xhr poll error",e)})),this.pollXhr=e}}t.XHR=f;class p extends c.Emitter{constructor(e,t){super(),(0,a.installTimerFunctions)(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.async=!1!==t.async,this.data=void 0!==t.data?t.data:null,this.create()}create(){const e=(0,a.pick)(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this.opts.xd,e.xscheme=!!this.opts.xs;const t=this.xhr=new o.default(e);try{h("xhr open %s: %s",this.method,this.uri),t.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0);for(let e in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(e)&&t.setRequestHeader(e,this.opts.extraHeaders[e])}}catch(e){}if("POST"===this.method)try{t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{t.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in t&&(t.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(t.timeout=this.opts.requestTimeout),t.onreadystatechange=()=>{4===t.readyState&&(200===t.status||1223===t.status?this.onLoad():this.setTimeoutFn((()=>{this.onError("number"==typeof t.status?t.status:0)}),0))},h("xhr data %s",this.data),t.send(this.data)}catch(e){return void this.setTimeoutFn((()=>{this.onError(e)}),0)}"undefined"!=typeof document&&(this.index=p.requestsCount++,p.requests[this.index]=this)}onSuccess(){this.emit("success"),this.cleanup()}onData(e){this.emit("data",e),this.onSuccess()}onError(e){this.emit("error",e),this.cleanup(!0)}cleanup(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=d,e)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete p.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;null!==e&&this.onData(e)}abort(){this.cleanup()}}if(t.Request=p,p.requestsCount=0,p.requests={},"undefined"!=typeof document)if("function"==typeof attachEvent)attachEvent("onunload",g);else if("function"==typeof addEventListener){const e="onpagehide"in r.default?"pagehide":"unload";addEventListener(e,g,!1)}function g(){for(let e in p.requests)p.requests.hasOwnProperty(e)&&p.requests[e].abort()}},484:function(e,t,s){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Polling=void 0;const o=s(9870),n=i(s(1227)),r=i(s(2281)),a=i(s(1830)),c=s(1373),l=(0,n.default)("engine.io-client:polling");class h extends o.Transport{constructor(){super(...arguments),this.polling=!1}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{l("paused"),this.readyState="paused",e()};if(this.polling||!this.writable){let e=0;this.polling&&(l("we are currently polling - waiting to pause"),e++,this.once("pollComplete",(function(){l("pre-pause polling complete"),--e||t()}))),this.writable||(l("we are currently writing - waiting to pause"),e++,this.once("drain",(function(){l("pre-pause writing complete"),--e||t()})))}else t()}poll(){l("polling"),this.polling=!0,this.doPoll(),this.emit("poll")}onData(e){l("polling got data %s",e),(0,c.decodePayload)(e,this.socket.binaryType).forEach((e=>{if("opening"===this.readyState&&"open"===e.type&&this.onOpen(),"close"===e.type)return this.onClose(),!1;this.onPacket(e)})),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():l('ignoring poll - transport state "%s"',this.readyState))}doClose(){const e=()=>{l("writing close packet"),this.write([{type:"close"}])};"open"===this.readyState?(l("transport open - closing"),e()):(l("transport not open - deferring close"),this.once("open",e))}write(e){this.writable=!1,(0,c.encodePayload)(e,(e=>{this.doWrite(e,(()=>{this.writable=!0,this.emit("drain")}))}))}uri(){let e=this.query||{};const t=this.opts.secure?"https":"http";let s="";!1!==this.opts.timestampRequests&&(e[this.opts.timestampParam]=(0,r.default)()),this.supportsBinary||e.sid||(e.b64=1),this.opts.port&&("https"===t&&443!==Number(this.opts.port)||"http"===t&&80!==Number(this.opts.port))&&(s=":"+this.opts.port);const i=a.default.encode(e);return t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+s+this.opts.path+(i.length?"?"+i:"")}}t.Polling=h},5552:function(e,t,s){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.defaultBinaryType=t.usingBrowserWebSocket=t.WebSocket=t.nextTick=void 0;const o=i(s(6242));t.nextTick="function"==typeof Promise&&"function"==typeof Promise.resolve?e=>Promise.resolve().then(e):(e,t)=>t(e,0),t.WebSocket=o.default.WebSocket||o.default.MozWebSocket,t.usingBrowserWebSocket=!0,t.defaultBinaryType="arraybuffer"},1308:function(e,t,s){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.WS=void 0;const o=s(9870),n=i(s(1830)),r=i(s(2281)),a=s(9622),c=s(5552),l=i(s(1227)),h=s(1373),d=(0,l.default)("engine.io-client:websocket"),u="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();class f extends o.Transport{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols,s=u?{}:(0,a.pick)(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(s.headers=this.opts.extraHeaders);try{this.ws=c.usingBrowserWebSocket&&!u?t?new c.WebSocket(e,t):new c.WebSocket(e):new c.WebSocket(e,t,s)}catch(e){return this.emit("error",e)}this.ws.binaryType=this.socket.binaryType||c.defaultBinaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=this.onClose.bind(this),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const s=e[t],i=t===e.length-1;(0,h.encodePacket)(s,this.supportsBinary,(e=>{const t={};!c.usingBrowserWebSocket&&(s.options&&(t.compress=s.options.compress),this.opts.perMessageDeflate)&&("string"==typeof e?Buffer.byteLength(e):e.length)<this.opts.perMessageDeflate.threshold&&(t.compress=!1);try{c.usingBrowserWebSocket?this.ws.send(e):this.ws.send(e,t)}catch(e){d("websocket closed before onclose event")}i&&(0,c.nextTick)((()=>{this.writable=!0,this.emit("drain")}),this.setTimeoutFn)}))}}doClose(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}uri(){let e=this.query||{};const t=this.opts.secure?"wss":"ws";let s="";this.opts.port&&("wss"===t&&443!==Number(this.opts.port)||"ws"===t&&80!==Number(this.opts.port))&&(s=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=(0,r.default)()),this.supportsBinary||(e.b64=1);const i=n.default.encode(e);return t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+s+this.opts.path+(i.length?"?"+i:"")}check(){return!(!c.WebSocket||"__initialize"in c.WebSocket&&this.name===f.prototype.name)}}t.WS=f},6666:function(e,t,s){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=i(s(8058)),n=i(s(6242));t.default=function(e){const t=e.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!t||o.default))return new XMLHttpRequest}catch(e){}if(!t)try{return new(n.default[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}},9622:function(e,t,s){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.installTimerFunctions=t.pick=void 0;const o=i(s(6242));t.pick=function(e,...t){return t.reduce(((t,s)=>(e.hasOwnProperty(s)&&(t[s]=e[s]),t)),{})};const n=setTimeout,r=clearTimeout;t.installTimerFunctions=function(e,t){t.useNativeTimers?(e.setTimeoutFn=n.bind(o.default),e.clearTimeoutFn=r.bind(o.default)):(e.setTimeoutFn=setTimeout.bind(o.default),e.clearTimeoutFn=clearTimeout.bind(o.default))}},3087:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ERROR_PACKET=t.PACKET_TYPES_REVERSE=t.PACKET_TYPES=void 0;const s=Object.create(null);t.PACKET_TYPES=s,s.open="0",s.close="1",s.ping="2",s.pong="3",s.message="4",s.upgrade="5",s.noop="6";const i=Object.create(null);t.PACKET_TYPES_REVERSE=i,Object.keys(s).forEach((e=>{i[s[e]]=e})),t.ERROR_PACKET={type:"error",data:"parser error"}},7572:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=s(3087),o=s(8247),n="function"==typeof ArrayBuffer,r=(e,t)=>{if(n){const s=(0,o.decode)(e);return a(s,t)}return{base64:!0,data:e}},a=(e,t)=>"blob"===t&&e instanceof ArrayBuffer?new Blob([e]):e;t.default=(e,t)=>{if("string"!=typeof e)return{type:"message",data:a(e,t)};const s=e.charAt(0);return"b"===s?{type:"message",data:r(e.substring(1),t)}:i.PACKET_TYPES_REVERSE[s]?e.length>1?{type:i.PACKET_TYPES_REVERSE[s],data:e.substring(1)}:{type:i.PACKET_TYPES_REVERSE[s]}:i.ERROR_PACKET}},3908:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=s(3087),o="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),n="function"==typeof ArrayBuffer,r=(e,t)=>{const s=new FileReader;return s.onload=function(){const e=s.result.split(",")[1];t("b"+e)},s.readAsDataURL(e)};t.default=({type:e,data:t},s,a)=>{return o&&t instanceof Blob?s?a(t):r(t,a):n&&(t instanceof ArrayBuffer||(c=t,"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(c):c&&c.buffer instanceof ArrayBuffer))?s?a(t):r(new Blob([t]),a):a(i.PACKET_TYPES[e]+(t||""));var c}},1373:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.decodePayload=t.decodePacket=t.encodePayload=t.encodePacket=t.protocol=void 0;const i=s(3908);t.encodePacket=i.default;const o=s(7572);t.decodePacket=o.default;const n=String.fromCharCode(30);t.encodePayload=(e,t)=>{const s=e.length,o=new Array(s);let r=0;e.forEach(((e,a)=>{(0,i.default)(e,!1,(e=>{o[a]=e,++r===s&&t(o.join(n))}))}))},t.decodePayload=(e,t)=>{const s=e.split(n),i=[];for(let e=0;e<s.length;e++){const n=(0,o.default)(s[e],t);if(i.push(n),"error"===n.type)break}return i},t.protocol=4},7046:function(e,t,s){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.connect=t.io=t.Socket=t.Manager=t.protocol=void 0;const o=s(3084),n=s(4168);Object.defineProperty(t,"Manager",{enumerable:!0,get:function(){return n.Manager}});const r=s(8312);Object.defineProperty(t,"Socket",{enumerable:!0,get:function(){return r.Socket}});const a=i(s(1227)).default("socket.io-client"),c={};function l(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};const s=o.url(e,t.path||"/socket.io"),i=s.source,r=s.id,l=s.path,h=c[r]&&l in c[r].nsps;let d;return t.forceNew||t["force new connection"]||!1===t.multiplex||h?(a("ignoring socket cache for %s",i),d=new n.Manager(i,t)):(c[r]||(a("new io instance for %s",i),c[r]=new n.Manager(i,t)),d=c[r]),s.query&&!t.query&&(t.query=s.queryKey),d.socket(s.path,t)}t.io=l,t.connect=l,t.default=l,Object.assign(l,{Manager:n.Manager,Socket:r.Socket,io:l,connect:l});var h=s(4514);Object.defineProperty(t,"protocol",{enumerable:!0,get:function(){return h.protocol}}),e.exports=l},4168:function(e,t,s){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,s,i){void 0===i&&(i=s),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[s]}})}:function(e,t,s,i){void 0===i&&(i=s),e[i]=t[s]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&i(t,e,s);return o(t,e),t},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Manager=void 0;const a=s(4679),c=s(8312),l=n(s(4514)),h=s(7149),d=r(s(3010)),u=s(3063),f=r(s(1227)).default("socket.io-client:manager");class p extends u.Emitter{constructor(e,t){var s;super(),this.nsps={},this.subs=[],e&&"object"==typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.opts=t,a.installTimerFunctions(this,t),this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(s=t.randomizationFactor)&&void 0!==s?s:.5),this.backoff=new d.default({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this._readyState="closed",this.uri=e;const i=t.parser||l;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=!1!==t.autoConnect,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}randomizationFactor(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(e){if(f("readyState %s",this._readyState),~this._readyState.indexOf("open"))return this;f("opening %s",this.uri),this.engine=new a.Socket(this.uri,this.opts);const t=this.engine,s=this;this._readyState="opening",this.skipReconnect=!1;const i=h.on(t,"open",(function(){s.onopen(),e&&e()})),o=h.on(t,"error",(t=>{f("error"),s.cleanup(),s._readyState="closed",this.emitReserved("error",t),e?e(t):s.maybeReconnectOnOpen()}));if(!1!==this._timeout){const e=this._timeout;f("connect attempt will timeout after %d",e),0===e&&i();const s=this.setTimeoutFn((()=>{f("connect attempt timed out after %d",e),i(),t.close(),t.emit("error",new Error("timeout"))}),e);this.opts.autoUnref&&s.unref(),this.subs.push((function(){clearTimeout(s)}))}return this.subs.push(i),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){f("open"),this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(h.on(e,"ping",this.onping.bind(this)),h.on(e,"data",this.ondata.bind(this)),h.on(e,"error",this.onerror.bind(this)),h.on(e,"close",this.onclose.bind(this)),h.on(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){this.decoder.add(e)}ondecoded(e){this.emitReserved("packet",e)}onerror(e){f("error",e),this.emitReserved("error",e)}socket(e,t){let s=this.nsps[e];return s||(s=new c.Socket(this,e,t),this.nsps[e]=s),s}_destroy(e){const t=Object.keys(this.nsps);for(const e of t)if(this.nsps[e].active)return void f("socket %s is still active, skipping close",e);this._close()}_packet(e){f("writing packet %j",e);const t=this.encoder.encode(e);for(let s=0;s<t.length;s++)this.engine.write(t[s],e.options)}cleanup(){f("cleanup"),this.subs.forEach((e=>e())),this.subs.length=0,this.decoder.destroy()}_close(){f("disconnect"),this.skipReconnect=!0,this._reconnecting=!1,"opening"===this._readyState&&this.cleanup(),this.backoff.reset(),this._readyState="closed",this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e){f("onclose"),this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)f("reconnect failed"),this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();f("will wait %dms before reconnect attempt",t),this._reconnecting=!0;const s=this.setTimeoutFn((()=>{e.skipReconnect||(f("attempting reconnect"),this.emitReserved("reconnect_attempt",e.backoff.attempts),e.skipReconnect||e.open((t=>{t?(f("reconnect attempt error"),e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",t)):(f("reconnect success"),e.onreconnect())})))}),t);this.opts.autoUnref&&s.unref(),this.subs.push((function(){clearTimeout(s)}))}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}t.Manager=p},7149:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.on=void 0,t.on=function(e,t,s){return e.on(t,s),function(){e.off(t,s)}}},8312:function(e,t,s){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Socket=void 0;const o=s(4514),n=s(7149),r=s(3063),a=i(s(1227)).default("socket.io-client:socket"),c=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class l extends r.Emitter{constructor(e,t,s){super(),this.connected=!1,this.disconnected=!0,this.receiveBuffer=[],this.sendBuffer=[],this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,s&&s.auth&&(this.auth=s.auth),this.io._autoConnect&&this.open()}subEvents(){if(this.subs)return;const e=this.io;this.subs=[n.on(e,"open",this.onopen.bind(this)),n.on(e,"packet",this.onpacket.bind(this)),n.on(e,"error",this.onerror.bind(this)),n.on(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(c.hasOwnProperty(e))throw new Error('"'+e+'" is a reserved event name');t.unshift(e);const s={type:o.PacketType.EVENT,data:t,options:{}};s.options.compress=!1!==this.flags.compress,"function"==typeof t[t.length-1]&&(a("emitting packet with ack id %d",this.ids),this.acks[this.ids]=t.pop(),s.id=this.ids++);const i=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return!this.flags.volatile||i&&this.connected?this.connected?this.packet(s):this.sendBuffer.push(s):a("discard packet as the transport is not currently writable"),this.flags={},this}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){a("transport is open - connecting"),"function"==typeof this.auth?this.auth((e=>{this.packet({type:o.PacketType.CONNECT,data:e})})):this.packet({type:o.PacketType.CONNECT,data:this.auth})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e){a("close (%s)",e),this.connected=!1,this.disconnected=!0,delete this.id,this.emitReserved("disconnect",e)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case o.PacketType.CONNECT:if(e.data&&e.data.sid){const t=e.data.sid;this.onconnect(t)}else this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case o.PacketType.EVENT:case o.PacketType.BINARY_EVENT:this.onevent(e);break;case o.PacketType.ACK:case o.PacketType.BINARY_ACK:this.onack(e);break;case o.PacketType.DISCONNECT:this.ondisconnect();break;case o.PacketType.CONNECT_ERROR:const t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t)}}onevent(e){const t=e.data||[];a("emitting event %j",t),null!=e.id&&(a("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const s of t)s.apply(this,e)}super.emit.apply(this,e)}ack(e){const t=this;let s=!1;return function(...i){s||(s=!0,a("sending ack %j",i),t.packet({type:o.PacketType.ACK,id:e,data:i}))}}onack(e){const t=this.acks[e.id];"function"==typeof t?(a("calling ack %s with %j",e.id,e.data),t.apply(this,e.data),delete this.acks[e.id]):a("bad ack %s",e.id)}onconnect(e){a("socket connected with id %s",e),this.id=e,this.connected=!0,this.disconnected=!1,this.emitBuffered(),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach((e=>this.emitEvent(e))),this.receiveBuffer=[],this.sendBuffer.forEach((e=>this.packet(e))),this.sendBuffer=[]}ondisconnect(){a("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach((e=>e())),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&(a("performing disconnect (%s)",this.nsp),this.packet({type:o.PacketType.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let s=0;s<t.length;s++)if(e===t[s])return t.splice(s,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}}t.Socket=l},3084:function(e,t,s){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.url=void 0;const o=i(s(4187)),n=i(s(1227)).default("socket.io-client:url");t.url=function(e,t="",s){let i=e;s=s||"undefined"!=typeof location&&location,null==e&&(e=s.protocol+"//"+s.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?s.protocol+e:s.host+e),/^(https?|wss?):\/\//.test(e)||(n("protocol-less url %s",e),e=void 0!==s?s.protocol+"//"+e:"https://"+e),n("parse %s",e),i=o.default(e)),i.port||(/^(http|ws)$/.test(i.protocol)?i.port="80":/^(http|ws)s$/.test(i.protocol)&&(i.port="443")),i.path=i.path||"/";const r=-1!==i.host.indexOf(":")?"["+i.host+"]":i.host;return i.id=i.protocol+"://"+r+":"+i.port+t,i.href=i.protocol+"://"+r+(s&&s.port===i.port?"":":"+i.port),i}},4880:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.reconstructPacket=t.deconstructPacket=void 0;const i=s(665);function o(e,t){if(!e)return e;if(i.isBinary(e)){const s={_placeholder:!0,num:t.length};return t.push(e),s}if(Array.isArray(e)){const s=new Array(e.length);for(let i=0;i<e.length;i++)s[i]=o(e[i],t);return s}if("object"==typeof e&&!(e instanceof Date)){const s={};for(const i in e)e.hasOwnProperty(i)&&(s[i]=o(e[i],t));return s}return e}function n(e,t){if(!e)return e;if(e&&e._placeholder)return t[e.num];if(Array.isArray(e))for(let s=0;s<e.length;s++)e[s]=n(e[s],t);else if("object"==typeof e)for(const s in e)e.hasOwnProperty(s)&&(e[s]=n(e[s],t));return e}t.deconstructPacket=function(e){const t=[],s=e.data,i=e;return i.data=o(s,t),i.attachments=t.length,{packet:i,buffers:t}},t.reconstructPacket=function(e,t){return e.data=n(e.data,t),e.attachments=void 0,e}},4514:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Decoder=t.Encoder=t.PacketType=t.protocol=void 0;const i=s(3063),o=s(4880),n=s(665),r=s(1227).default("socket.io-parser");var a;t.protocol=5,function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"}(a=t.PacketType||(t.PacketType={})),t.Encoder=class{encode(e){return r("encoding packet %j",e),e.type!==a.EVENT&&e.type!==a.ACK||!n.hasBinary(e)?[this.encodeAsString(e)]:(e.type=e.type===a.EVENT?a.BINARY_EVENT:a.BINARY_ACK,this.encodeAsBinary(e))}encodeAsString(e){let t=""+e.type;return e.type!==a.BINARY_EVENT&&e.type!==a.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data)),r("encoded %j as %s",e,t),t}encodeAsBinary(e){const t=o.deconstructPacket(e),s=this.encodeAsString(t.packet),i=t.buffers;return i.unshift(s),i}};class c extends i.Emitter{constructor(){super()}add(e){let t;if("string"==typeof e)t=this.decodeString(e),t.type===a.BINARY_EVENT||t.type===a.BINARY_ACK?(this.reconstructor=new l(t),0===t.attachments&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t);else{if(!n.isBinary(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t))}}decodeString(e){let t=0;const s={type:Number(e.charAt(0))};if(void 0===a[s.type])throw new Error("unknown packet type "+s.type);if(s.type===a.BINARY_EVENT||s.type===a.BINARY_ACK){const i=t+1;for(;"-"!==e.charAt(++t)&&t!=e.length;);const o=e.substring(i,t);if(o!=Number(o)||"-"!==e.charAt(t))throw new Error("Illegal attachments");s.attachments=Number(o)}if("/"===e.charAt(t+1)){const i=t+1;for(;++t&&","!==e.charAt(t)&&t!==e.length;);s.nsp=e.substring(i,t)}else s.nsp="/";const i=e.charAt(t+1);if(""!==i&&Number(i)==i){const i=t+1;for(;++t;){const s=e.charAt(t);if(null==s||Number(s)!=s){--t;break}if(t===e.length)break}s.id=Number(e.substring(i,t+1))}if(e.charAt(++t)){const i=function(e){try{return JSON.parse(e)}catch(e){return!1}}(e.substr(t));if(!c.isPayloadValid(s.type,i))throw new Error("invalid payload");s.data=i}return r("decoded %s as %j",e,s),s}static isPayloadValid(e,t){switch(e){case a.CONNECT:return"object"==typeof t;case a.DISCONNECT:return void 0===t;case a.CONNECT_ERROR:return"string"==typeof t||"object"==typeof t;case a.EVENT:case a.BINARY_EVENT:return Array.isArray(t)&&t.length>0;case a.ACK:case a.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&this.reconstructor.finishedReconstruction()}}t.Decoder=c;class l{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const e=o.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}},665:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hasBinary=t.isBinary=void 0;const s="function"==typeof ArrayBuffer,i=Object.prototype.toString,o="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===i.call(Blob),n="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===i.call(File);function r(e){return s&&(e instanceof ArrayBuffer||(e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer)(e))||o&&e instanceof Blob||n&&e instanceof File}t.isBinary=r,t.hasBinary=function e(t,s){if(!t||"object"!=typeof t)return!1;if(Array.isArray(t)){for(let s=0,i=t.length;s<i;s++)if(e(t[s]))return!0;return!1}if(r(t))return!0;if(t.toJSON&&"function"==typeof t.toJSON&&1===arguments.length)return e(t.toJSON(),!0);for(const s in t)if(Object.prototype.hasOwnProperty.call(t,s)&&e(t[s]))return!0;return!1}}},t={};function s(i){var o=t[i];if(void 0!==o)return o.exports;var n=t[i]={exports:{}};return e[i].call(n.exports,n,n.exports,s),n.exports}s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s(3607)})();